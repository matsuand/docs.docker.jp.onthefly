<!-- Page generated 2020-04-30 22:53:40 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        @charset "UTF-8";
        [ng\:cloak],
        [ng-cloak],
        [data-ng-cloak],
        [x-ng-cloak],
        .ng-cloak,
        .x-ng-cloak,
        .ng-hide:not(.ng-hide-animate) {
            display: none !important;
        }

        ng\:form {
            display: block;
        }
    </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
    <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
    <!-- metadata -->
    <meta property="og:type" content="website"/>
    <meta property="og:updated_time" itemprop="dateUpdated" content="2020-04-30T22:53:40+09:00"/>
    <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.docker.com"/>
    <meta name="twitter:site" content="@docker_docs"/>
    <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
    <meta name="twitter:title" itemprop="title name" content="Use the BTRFS storage driver"/>
    <meta name="twitter:description" property="og:description" itemprop="description" content="Btrfs is a next generation copy-on-write filesystem that supports many advanced storage technologies that make it a good fit for Docker. Btrfs is included in the mainline Linux kernel. Docker’s..." />
    <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:image:alt" content="Docker ドキュメント"/>
    <meta property="article:published_time" itemprop="datePublished" content="2020-04-30T22:53:40+09:00"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="container, storage, driver, Btrfs ">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
    <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
    <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

    <!-- Go get "Open Sans" font from Google -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- SEO stuff -->
    <title>Use the BTRFS storage driver | Docker ドキュメント</title>
    <meta property="og:title" content="Use the BTRFS storage driver" />
    <meta property="og:locale" content="ja_JP" />
    <meta name="description" content="Learn how to optimize your use of Btrfs driver." />
    <meta property="og:description" content="Learn how to optimize your use of Btrfs driver." />
    <link rel="canonical" href="/docs.docker.jp.onthefly/storage/storagedriver/btrfs-driver/" />
    <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/storage/storagedriver/btrfs-driver/" />
    <meta property="og:site_name" content="Docker ドキュメント" />
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Use the BTRFS storage driver","description":"Learn how to optimize your use of Btrfs driver.","url":"https://docs.docker.com/storage/storagedriver/btrfs-driver/"}</script>
    <!-- END SEO STUFF -->
    
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    </script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        
            <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

        
    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                                
                            <h1>Use the BTRFS storage driver</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    11 分
  
</span>

                            
                            
                            <p>Btrfs is a next generation copy-on-write filesystem that supports many advanced
storage technologies that make it a good fit for Docker. Btrfs is included in
the mainline Linux kernel.</p>

<p>Docker’s <code class="highlighter-rouge">btrfs</code> storage driver leverages many Btrfs features for image and
container management. Among these features are block-level operations, thin
provisioning, copy-on-write snapshots, and ease of administration. You can
easily combine multiple physical block devices into a single Btrfs filesystem.</p>

<p>This article refers to Docker’s Btrfs storage driver as <code class="highlighter-rouge">btrfs</code> and the overall
Btrfs Filesystem as Btrfs.</p>

<blockquote>
  <p><strong>Note</strong>: The <code class="highlighter-rouge">btrfs</code> storage driver is only supported on Docker Engine - Community on Ubuntu
or Debian, and Docker EE / CS Engine on SLES.</p>
</blockquote>

<h2 id="prerequisites">Prerequisites</h2>

<p><code class="highlighter-rouge">btrfs</code> is supported if you meet the following prerequisites:</p>

<ul>
  <li>
    <p><strong>Docker Engine - Community</strong>: For Docker Engine - Community, <code class="highlighter-rouge">btrfs</code> is only recommended on Ubuntu or Debian.</p>
  </li>
  <li>
    <p><strong>Docker EE</strong>: For Docker EE and CS-Engine, <code class="highlighter-rouge">btrfs</code> is only supported on SLES.
See the
<a href="https://success.docker.com/Policies/Compatibility_Matrix">Product compatibility matrix</a>
for all supported configurations for commercially-supported Docker.</p>
  </li>
  <li>
    <p>Changing the storage driver makes any containers you have already
created inaccessible on the local system. Use <code class="highlighter-rouge">docker save</code> to save containers,
and push existing images to Docker Hub or a private repository, so that you
not need to re-create them later.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">btrfs</code> requires a dedicated block storage device such as a physical disk. This
block device must be formatted for Btrfs and mounted into <code class="highlighter-rouge">/var/lib/docker/</code>.
The configuration instructions below walk you through this procedure. By
default, the SLES <code class="highlighter-rouge">/</code> filesystem is formatted with BTRFS, so for SLES, you do
not need to use a separate block device, but you can choose to do so for
performance reasons.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">btrfs</code> support must exist in your kernel. To check this, run the following
command:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo cat</span> /proc/filesystems | <span class="nb">grep </span>btrfs

btrfs
</code></pre></div>    </div>
  </li>
  <li>
    <p>To manage BTRFS filesystems at the level of the operating system, you need the
<code class="highlighter-rouge">btrfs</code> command. If you do not have this command, install the <code class="highlighter-rouge">btrfsprogs</code>
package (SLES) or <code class="highlighter-rouge">btrfs-tools</code> package (Ubuntu).</p>
  </li>
</ul>

<h2 id="configure-docker-to-use-the-btrfs-storage-driver">Configure Docker to use the btrfs storage driver</h2>

<p>This procedure is essentially identical on SLES and Ubuntu.</p>

<ol>
  <li>
    <p>Stop Docker.</p>
  </li>
  <li>
    <p>Copy the contents of <code class="highlighter-rouge">/var/lib/docker/</code> to a backup location, then empty
the contents of <code class="highlighter-rouge">/var/lib/docker/</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>cp <span class="nt">-au</span> /var/lib/docker /var/lib/docker.bk
<span class="nv">$ </span><span class="nb">sudo </span>rm <span class="nt">-rf</span> /var/lib/docker/<span class="k">*</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Format your dedicated block device or devices as a Btrfs filesystem. This
example assumes that you are using two block devices called <code class="highlighter-rouge">/dev/xvdf</code> and
<code class="highlighter-rouge">/dev/xvdg</code>. Double-check the block device names because this is a
destructive operation.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>mkfs.btrfs <span class="nt">-f</span> /dev/xvdf /dev/xvdg
</code></pre></div>    </div>

    <p>There are many more options for Btrfs, including striping and RAID. See the
<a href="https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices">Btrfs documentation</a>.</p>
  </li>
  <li>
    <p>Mount the new Btrfs filesystem on the <code class="highlighter-rouge">/var/lib/docker/</code> mount point. You
can specify any of the block devices used to create the Btrfs filesystem.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>mount <span class="nt">-t</span> btrfs /dev/xvdf /var/lib/docker
</code></pre></div>    </div>

    <p>Don’t forget to make the change permanent across reboots by adding an
entry to <code class="highlighter-rouge">/etc/fstab</code>.</p>
  </li>
  <li>
    <p>Copy the contents of <code class="highlighter-rouge">/var/lib/docker.bk</code> to <code class="highlighter-rouge">/var/lib/docker/</code>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>cp <span class="nt">-au</span> /var/lib/docker.bk/<span class="k">*</span> /var/lib/docker/
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configure Docker to use the <code class="highlighter-rouge">btrfs</code> storage driver. This is required even
though <code class="highlighter-rouge">/var/lib/docker/</code> is now using a Btrfs filesystem.
Edit or create the file <code class="highlighter-rouge">/etc/docker/daemon.json</code>. If it is a new file, add
the following contents. If it is an existing file, add the key and value
only, being careful to end the line with a comma if it is not the final
line before an ending curly bracket (<code class="highlighter-rouge">}</code>).</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"storage-driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btrfs"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <p>See all storage options for each storage driver in the
<a href="/engine/reference/commandline/dockerd/#storage-driver-options">daemon reference documentation</a></p>
  </li>
  <li>
    <p>Start Docker. After it is running, verify that <code class="highlighter-rouge">btrfs</code> is being used as the
storage driver.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker info

Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 17.03.1-ce
Storage Driver: btrfs
 Build Version: Btrfs v4.4
 Library Version: 101
&lt;output truncated&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>When you are ready, remove the <code class="highlighter-rouge">/var/lib/docker.bk</code> directory.</p>
  </li>
</ol>

<h2 id="manage-a-btrfs-volume">Manage a Btrfs volume</h2>

<p>One of the benefits of Btrfs is the ease of managing Btrfs filesystems without
the need to unmount the filesystem or restart Docker.</p>

<p>When space gets low, Btrfs automatically expands the volume in <em>chunks</em> of
roughly 1 GB.</p>

<p>To add a block device to a Btrfs volume, use the <code class="highlighter-rouge">btrfs device add</code> and
<code class="highlighter-rouge">btrfs filesystem balance</code> commands.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>btrfs device add /dev/svdh /var/lib/docker

<span class="nv">$ </span><span class="nb">sudo </span>btrfs filesystem balance /var/lib/docker
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: While you can do these operations with Docker running, performance
suffers. It might be best to plan an outage window to balance the Btrfs
filesystem.</p>
</blockquote>

<h2 id="how-the-btrfs-storage-driver-works">How the <code class="highlighter-rouge">btrfs</code> storage driver works</h2>

<p>The <code class="highlighter-rouge">btrfs</code> storage driver works differently from <code class="highlighter-rouge">devicemapper</code> or other
storage drivers in that your entire <code class="highlighter-rouge">/var/lib/docker/</code> directory is stored on a
Btrfs volume.</p>

<h3 id="image-and-container-layers-on-disk">Image and container layers on-disk</h3>

<p>Information about image layers and writable container layers is stored in
<code class="highlighter-rouge">/var/lib/docker/btrfs/subvolumes/</code>. This subdirectory contains one directory
per image or container layer, with the unified filesystem built from a layer
plus all its parent layers. Subvolumes are natively copy-on-write and have space
allocated to them on-demand from an underlying storage pool. They can also be
nested and snapshotted. The diagram below shows 4 subvolumes. ‘Subvolume 2’ and
‘Subvolume 3’ are nested, whereas ‘Subvolume 4’ shows its own internal directory
tree.</p>

<p><img src="/docs.docker.jp.onthefly/storage/storagedriver/images/btfs_subvolume.jpg" alt="subvolume example" /></p>

<p>Only the base layer of an image is stored as a true subvolume. All the other
layers are stored as snapshots, which only contain the differences introduced
in that layer. You can create snapshots of snapshots as shown in the diagram
below.</p>

<p><img src="/docs.docker.jp.onthefly/storage/storagedriver/images/btfs_snapshots.jpg" alt="snapshots diagram" /></p>

<p>On disk, snapshots look and feel just like subvolumes, but in reality they are
much smaller and more space-efficient. Copy-on-write is used to maximize storage
efficiency and minimize layer size, and writes in the container’s writable layer
are managed at the block level. The following image shows a subvolume and its
snapshot sharing data.</p>

<p><img src="/docs.docker.jp.onthefly/storage/storagedriver/images/btfs_pool.jpg" alt="snapshot and subvolume sharing data" /></p>

<p>For maximum efficiency, when a container needs more space, it is allocated in
<em>chunks</em> of roughly 1 GB in size.</p>

<p>Docker’s <code class="highlighter-rouge">btrfs</code> storage driver stores every image layer and container in its
own Btrfs subvolume or snapshot. The base layer of an image is stored as a
subvolume whereas child image layers and containers are stored as snapshots.
This is shown in the diagram below.</p>

<p><img src="/docs.docker.jp.onthefly/storage/storagedriver/images/btfs_container_layer.jpg" alt="Btrfs container layers" /></p>

<p>The high level process for creating images and containers on Docker hosts
running the <code class="highlighter-rouge">btrfs</code> driver is as follows:</p>

<ol>
  <li>
    <p>The image’s base layer is stored in a Btrfs <em>subvolume</em> under
<code class="highlighter-rouge">/var/lib/docker/btrfs/subvolumes</code>.</p>
  </li>
  <li>
    <p>Subsequent image layers are stored as a Btrfs <em>snapshot</em> of the parent
layer’s subvolume or snapshot, but with the changes introduced by this
layer. These differences are stored at the block level.</p>
  </li>
  <li>
    <p>The container’s writable layer is a Btrfs snapshot of the final image layer,
with the differences introduced by the running container. These differences
are stored at the block level.</p>
  </li>
</ol>

<h2 id="how-container-reads-and-writes-work-with-btrfs">How container reads and writes work with <code class="highlighter-rouge">btrfs</code></h2>

<h3 id="reading-files">Reading files</h3>

<p>A container is a space-efficient snapshot of an image. Metadata in the snapshot
points to the actual data blocks in the storage pool. This is the same as with
a subvolume. Therefore, reads performed against a snapshot are essentially the
same as reads performed against a subvolume.</p>

<h3 id="writing-files">Writing files</h3>

<ul>
  <li>
    <p><strong>Writing new files</strong>: Writing a new file to a container invokes an allocate-on-demand
operation to allocate new data block to the container’s snapshot. The file is
then written to this new space. The allocate-on-demand operation is native to
all writes with Btrfs and is the same as writing new data to a subvolume. As a
result, writing new files to a container’s snapshot operates at native Btrfs
speeds.</p>
  </li>
  <li>
    <p><strong>Modifying existing files</strong>: Updating an existing file in a container is a copy-on-write
operation (<em>redirect-on-write</em> is the Btrfs terminology). The original data is
read from the layer where the file currently exists, and only the modified
blocks are written into the container’s writable layer. Next, the Btrfs driver
updates the filesystem metadata in the snapshot to point to this new data.
This behavior incurs very little overhead.</p>
  </li>
  <li>
    <p><strong>Deleting files or directories</strong>: If a container deletes a file or directory
that exists in a lower layer, Btrfs masks the existence of the file or
directory in the lower layer. If a container creates a file and then deletes
it, this operation is performed in the Btrfs filesystem itself and the space
is reclaimed.</p>
  </li>
</ul>

<p>With Btrfs, writing and updating lots of small files can result in slow
performance.</p>

<h2 id="btrfs-and-docker-performance">Btrfs and Docker performance</h2>

<p>There are several factors that influence Docker’s performance under the <code class="highlighter-rouge">btrfs</code>
storage driver.</p>

<blockquote>
  <p><strong>Note</strong>: Many of these factors are mitigated by using Docker volumes for
write-heavy workloads, rather than relying on storing data in the container’s
writable layer. However, in the case of Btrfs, Docker volumes still suffer
from these draw-backs unless <code class="highlighter-rouge">/var/lib/docker/volumes/</code> is <strong>not</strong> backed by
Btrfs.</p>
</blockquote>

<ul>
  <li>
    <p><strong>Page caching</strong>. Btrfs does not support page cache sharing. This means that
each process accessing the same file copies the file into the Docker hosts’s
memory. As a result, the <code class="highlighter-rouge">btrfs</code> driver may not be the best choice
high-density use cases such as PaaS.</p>
  </li>
  <li>
    <p><strong>Small writes</strong>. Containers performing lots of small writes (this usage
pattern matches what happens when you start and stop many containers in a short
period of time, as well) can lead to poor use of Btrfs chunks. This can
prematurely fill the Btrfs filesystem and lead to out-of-space conditions on
your Docker host. Use <code class="highlighter-rouge">btrfs filesys show</code> to closely monitor the amount of
free space on your Btrfs device.</p>
  </li>
  <li>
    <p><strong>Sequential writes</strong>. Btrfs uses a journaling technique when writing to disk.
This can impact the performance of sequential writes, reducing performance by
up to 50%.</p>
  </li>
  <li>
    <p><strong>Fragmentation</strong>. Fragmentation is a natural byproduct of copy-on-write
filesystems like Btrfs. Many small random writes can compound this issue.
Fragmentation can manifest as CPU spikes when using SSDs or head thrashing
when using spinning disks. Either of these issues can harm performance.</p>

    <p>If your Linux kernel version is 3.9 or higher, you can enable the <code class="highlighter-rouge">autodefrag</code>
feature when mounting a Btrfs volume. Test this feature on your own workloads
before deploying it into production, as some tests have shown a negative
impact on performance.</p>
  </li>
  <li>
    <p><strong>SSD performance</strong>: Btrfs includes native optimizations for SSD media.
To enable these features, mount the Btrfs filesystem with the <code class="highlighter-rouge">-o ssd</code> mount
option. These optimizations include enhanced SSD write performance by avoiding
optimization such as <em>seek optimizations</em> which do not apply to solid-state
media.</p>
  </li>
  <li>
    <p><strong>Balance Btrfs filesystems often</strong>: Use operating system utilities such as a
<code class="highlighter-rouge">cron</code> job to balance the Btrfs filesystem regularly, during non-peak hours.
This reclaims unallocated blocks and helps to prevent the filesystem from
filling up unnecessarily. You cannot rebalance a totally full Btrfs
filesystem unless you add additional physical block devices to the filesystem.
See the
<a href="https://btrfs.wiki.kernel.org/index.php/Balance_Filters#Balancing_to_fix_filesystem_full_errors">BTRFS Wiki</a>.</p>
  </li>
  <li>
    <p><strong>Use fast storage</strong>: Solid-state drives (SSDs) provide faster reads and
writes than spinning disks.</p>
  </li>
  <li>
    <p><strong>Use volumes for write-heavy workloads</strong>: Volumes provide the best and most
predictable performance for write-heavy workloads. This is because they bypass
the storage driver and do not incur any of the potential overheads introduced
by thin provisioning and copy-on-write. Volumes have other benefits, such as
allowing you to share data among containers and persisting even when no
running container is using them.</p>
  </li>
</ul>

<h2 id="related-information">Related Information</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/storage/volumes/">Volumes</a></li>
  <li><a href="/docs.docker.jp.onthefly/storage/storagedriver/">Understand images, containers, and storage drivers</a></li>
  <li><a href="/docs.docker.jp.onthefly/storage/storagedriver/select-storage-driver/">Select a storage driver</a></li>
</ul>

                            <!-- tags -->
                            
                                <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=container">container</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=storage">storage</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=driver">driver</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=Btrfs">Btrfs</a></span>
                                
                            
                            <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "storage/storagedriver/btrfs-driver.md",
                                        "title": "Use the BTRFS storage driver",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/storage/storagedriver/btrfs-driver.md"
                                    };
                                    (function(d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                        <div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/storage/storagedriver/btrfs-driver.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
                                        <li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [storage/storagedriver/btrfs-driver.md](https://docs.docker.com/storage/storagedriver/btrfs-driver/)"
                                                            class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                   
                                <div id="side-toc-title">本ページ内:</div>
                                    
<ul id="my_toc" class="inline_toc">
  <li><a href="#prerequisites" class="nomunge">Prerequisites</a></li>
  <li><a href="#configure-docker-to-use-the-btrfs-storage-driver" class="nomunge">Configure Docker to use the btrfs storage driver</a></li>
  <li><a href="#manage-a-btrfs-volume" class="nomunge">Manage a Btrfs volume</a></li>
  <li><a href="#how-the-btrfs-storage-driver-works" class="nomunge">How the btrfs storage driver works</a>
    <ul>
      <li><a href="#image-and-container-layers-on-disk" class="nomunge">Image and container layers on-disk</a></li>
    </ul>
  </li>
  <li><a href="#how-container-reads-and-writes-work-with-btrfs" class="nomunge">How container reads and writes work with btrfs</a>
    <ul>
      <li><a href="#reading-files" class="nomunge">Reading files</a></li>
      <li><a href="#writing-files" class="nomunge">Writing files</a></li>
    </ul>
  </li>
  <li><a href="#btrfs-and-docker-performance" class="nomunge">Btrfs and Docker performance</a></li>
  <li><a href="#related-information" class="nomunge">Related Information</a></li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
    var jekyllEnv = 'development';
    // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
    if (jekyllEnv === 'development') {
        jekyllEnv = '';
    }
    var pageURL = jekyllEnv + '/storage/storagedriver/btrfs-driver/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script>
    jQuery(document).ready(function(){hookupTOCEvents();});
    </script>
</body>
</html>
