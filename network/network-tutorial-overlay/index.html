<!-- Page generated 2019-05-10 16:39:30 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/network/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-05-10T16:39:30+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Networking with overlay networks"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="This series of tutorials deals with networking for swarm services. For networking with standalone containers, see Networking with standalone containers. If you need to learn more about Docker networking in..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-05-10T16:39:30+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="networking, bridge, routing, ports, swarm, overlay">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Networking with overlay networks | Docker Documentation</title>
<meta property="og:title" content="Networking with overlay networks" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Tutorials for networking with swarm services and standalone containers on multiple Docker daemons" />
<meta property="og:description" content="Tutorials for networking with swarm services and standalone containers on multiple Docker daemons" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Networking with overlay networks","description":"Tutorials for networking with swarm services and standalone containers on multiple Docker daemons","url":"https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" /id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Networking with overlay networks</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    21 分
  
</span>

							
							
							<p>This series of tutorials deals with networking for swarm services.
For networking with standalone containers, see
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-standalone/">Networking with standalone containers</a>. If you need to
learn more about Docker networking in general, see the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/">overview</a>.</p>

<p>This topic includes four different tutorials. You can run each of them on
Linux, Windows, or a Mac, but for the last two, you need a second Docker
host running elsewhere.</p>

<ul>
  <li>
    <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-the-default-overlay-network">Use the default overlay network</a> demonstrates
how to use the default overlay network that Docker sets up for you
automatically when you initialize or join a swarm. This network is not the
best choice for production systems.</p>
  </li>
  <li>
    <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-a-user-defined-overlay-network">Use user-defined overlay networks</a> shows
how to create and use your own custom overlay networks, to connect services.
This is recommended for services running in production.</p>
  </li>
  <li>
    <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-an-overlay-network-for-standalone-containers">Use an overlay network for standalone containers</a>
shows how to communicate between standalone containers on different Docker
daemons using an overlay network.</p>
  </li>
  <li>
    <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#communicate-between-a-container-and-a-swarm-service">Communicate between a container and a swarm service</a>
sets up communication between a standalone container and a swarm service,
using an attachable overlay network. This is supported in Docker 17.06 and
higher.</p>
  </li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<p>These requires you to have at least a single-node swarm, which means that
you have started Docker and run <code class="highlighter-rouge">docker swarm init</code> on the host. You can run
the examples on a multi-node swarm as well.</p>

<p>The last example requires Docker 17.06 or higher.</p>

<h2 id="use-the-default-overlay-network">Use the default overlay network</h2>

<p>In this example, you start an <code class="highlighter-rouge">alpine</code> service and examine the characteristics
of the network from the point of view of the individual service containers.</p>

<p>This tutorial does not go into operation-system-specific details about how
overlay networks are implemented, but focuses on how the overlay functions from
the point of view of a service.</p>

<h3 id="prerequisites-1">Prerequisites</h3>

<p>This tutorial requires three physical or virtual Docker hosts which can all
communicate with one another, all running new installations of Docker 17.03 or
higher. This tutorial assumes that the three hosts are running on the same
network with no firewall involved.</p>

<p>These hosts will be referred to as <code class="highlighter-rouge">manager</code>, <code class="highlighter-rouge">worker-1</code>, and <code class="highlighter-rouge">worker-2</code>. The
<code class="highlighter-rouge">manager</code> host will function as both a manager and a worker, which means it can
both run service tasks and manage the swarm. <code class="highlighter-rouge">worker-1</code> and <code class="highlighter-rouge">worker-2</code> will
function as workers only,</p>

<p>If you don’t have three hosts handy, an easy solution is to set up three
Ubuntu hosts on a cloud provider such as Amazon EC2, all on the same network
with all communications allowed to all hosts on that network (using a mechanism
such as EC2 security groups), and then to follow the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/installation/linux/docker-ce/ubuntu.md">installation instructions for Docker CE on Ubuntu</a>.</p>

<h3 id="walkthrough">Walkthrough</h3>

<h4 id="create-the-swarm">Create the swarm</h4>

<p>At the end of this procedure, all three Docker hosts will be joined to the swarm
and will be connected together using an overlay network called <code class="highlighter-rouge">ingress</code>.</p>

<ol>
  <li>
    <p>On <code class="highlighter-rouge">manager</code>. initialize the swarm. If the host only has one network
interface, the <code class="highlighter-rouge">--advertise-addr</code> flag is optional.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker swarm init <span class="nt">--advertise-addr</span><span class="o">=</span>&lt;IP-ADDRESS-OF-MANAGER&gt;
</code></pre></div>    </div>

    <p>Make a note of the text that is printed, as this contains the token that
you will use to join <code class="highlighter-rouge">worker-1</code> and <code class="highlighter-rouge">worker-2</code> to the swarm. It is a good
idea to store the token in a password manager.</p>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">worker-1</code>, join the swarm. If the host only has one network interface,
the <code class="highlighter-rouge">--advertise-addr</code> flag is optional.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker swarm join <span class="nt">--token</span> &lt;TOKEN&gt; <span class="se">\</span>
  <span class="nt">--advertise-addr</span> &lt;IP-ADDRESS-OF-WORKER-1&gt; <span class="se">\</span>
  &lt;IP-ADDRESS-OF-MANAGER&gt;:2377
</code></pre></div>    </div>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">worker-2</code>, join the swarm. If the host only has one network interface,
the <code class="highlighter-rouge">--advertise-addr</code> flag is optional.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker swarm join <span class="nt">--token</span> &lt;TOKEN&gt; <span class="se">\</span>
  <span class="nt">--advertise-addr</span> &lt;IP-ADDRESS-OF-WORKER-2&gt; <span class="se">\</span>
  &lt;IP-ADDRESS-OF-MANAGER&gt;:2377
</code></pre></div>    </div>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">manager</code>, list all the nodes. This command can only be done from a
manager.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker node <span class="nb">ls

</span>ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS
d68ace5iraw6whp7llvgjpu48 <span class="k">*</span>   ip-172-31-34-146    Ready               Active              Leader
nvp5rwavvb8lhdggo8fcf7plg     ip-172-31-35-151    Ready               Active
ouvx2l7qfcxisoyms8mtkgahw     ip-172-31-36-89     Ready               Active
</code></pre></div>    </div>

    <p>You can also use the <code class="highlighter-rouge">--filter</code> flag to filter by role:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker node <span class="nb">ls</span> <span class="nt">--filter</span> <span class="nv">role</span><span class="o">=</span>manager

ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS
d68ace5iraw6whp7llvgjpu48 <span class="k">*</span>   ip-172-31-34-146    Ready               Active              Leader

<span class="nv">$ </span>docker node <span class="nb">ls</span> <span class="nt">--filter</span> <span class="nv">role</span><span class="o">=</span>worker

ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS
nvp5rwavvb8lhdggo8fcf7plg     ip-172-31-35-151    Ready               Active
ouvx2l7qfcxisoyms8mtkgahw     ip-172-31-36-89     Ready               Active
</code></pre></div>    </div>
  </li>
  <li>
    <p>List the Docker networks on <code class="highlighter-rouge">manager</code>, <code class="highlighter-rouge">worker-1</code>, and <code class="highlighter-rouge">worker-2</code> and notice
that each of them now has an overlay network called <code class="highlighter-rouge">ingress</code> and a bridge
network called <code class="highlighter-rouge">docker_gwbridge</code>. Only the listing for <code class="highlighter-rouge">manager</code> is shown
here:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER              SCOPE
495c570066be        bridge              bridge              <span class="nb">local
</span>961c6cae9945        docker_gwbridge     bridge              <span class="nb">local
</span>ff35ceda3643        host                host                <span class="nb">local
</span>trtnl4tqnc3n        ingress             overlay             swarm
c8357deec9cb        none                null                <span class="nb">local</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>The <code class="highlighter-rouge">docker_gwbridge</code> connects the <code class="highlighter-rouge">ingress</code> network to the Docker host’s
network interface so that traffic can flow to and from swarm managers and
workers. If you create swarm services and do not specify a network, they are
connected to the <code class="highlighter-rouge">ingress</code> network. It is recommended that you use separate
overlay networks for each application or group of applications which will work
together. In the next procedure, you will create two overlay networks and
connect a service to each of them.</p>

<h4 id="create-the-services">Create the services</h4>

<ol>
  <li>
    <p>On <code class="highlighter-rouge">manager</code>, create a new overlay network called <code class="highlighter-rouge">nginx-net</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> overlay nginx-net
</code></pre></div>    </div>

    <p>You don’t need to create the overlay network on the other nodes, beacause it
will be automatically created when one of those nodes starts running a
service task which requires it.</p>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">manager</code>, create a 5-replica Nginx service connected to <code class="highlighter-rouge">nginx-net</code>. The
service will publish port 80 to the outside world. All of the service
task containers can communicate with each other without opening any ports.</p>

    <blockquote>
      <p><strong>Note</strong>: Services can only be created on a manager.</p>
    </blockquote>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service create <span class="se">\</span>
  <span class="nt">--name</span> my-nginx <span class="se">\</span>
  <span class="nt">--publish</span> <span class="nv">target</span><span class="o">=</span>80,published<span class="o">=</span>80 <span class="se">\</span>
  <span class="nt">--replicas</span><span class="o">=</span>5 <span class="se">\</span>
  <span class="nt">--network</span> nginx-net <span class="se">\</span>
  nginx
</code></pre></div>    </div>

    <p>The default publish mode of <code class="highlighter-rouge">ingress</code>, which is used when you do not
  specify a <code class="highlighter-rouge">mode</code> for the <code class="highlighter-rouge">--publish</code> flag, means that if you browse to
  port 80 on <code class="highlighter-rouge">manager</code>, <code class="highlighter-rouge">worker-1</code>, or <code class="highlighter-rouge">worker-2</code>, you will be connected to
  port 80 on one of the 5 service tasks, even if no tasks are currently
  running on the node you browse to. If you want to publish the port using
  <code class="highlighter-rouge">host</code> mode, you can add <code class="highlighter-rouge">mode=host</code> to the <code class="highlighter-rouge">--publish</code> output. However,
  you should also use <code class="highlighter-rouge">--mode global</code> instead of <code class="highlighter-rouge">--replicas=5</code> in this case,
  since only one service task can bind a given port on a given node.</p>
  </li>
  <li>
    <p>Run <code class="highlighter-rouge">docker service ls</code> to monitor the progress of service bring-up, which
may take a few seconds.</p>
  </li>
  <li>
    <p>Inspect the <code class="highlighter-rouge">nginx-net</code> network on <code class="highlighter-rouge">manager</code>, <code class="highlighter-rouge">worker-1</code>, and <code class="highlighter-rouge">worker-2</code>.
Remember that you did not need to create it manually on <code class="highlighter-rouge">worker-1</code> and
<code class="highlighter-rouge">worker-2</code> because Docker created it for you. The output will be long, but
notice the <code class="highlighter-rouge">Containers</code> and <code class="highlighter-rouge">Peers</code> sections. <code class="highlighter-rouge">Containers</code> lists all
service tasks (or standalone containers) connected to the overlay network
from that host.</p>
  </li>
  <li>
    <p>From <code class="highlighter-rouge">manager</code>, inspect the service using <code class="highlighter-rouge">docker service inspect my-nginx</code>
and notice the information about the ports and endpoints used by the
service.</p>
  </li>
  <li>
    <p>Create a new network <code class="highlighter-rouge">nginx-net-2</code>, then update the service to use this
network instead of <code class="highlighter-rouge">nginx-net</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> overlay nginx-net-2
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service update <span class="se">\</span>
  <span class="nt">--network-add</span> nginx-net-2 <span class="se">\</span>
  <span class="nt">--network-rm</span> nginx-net <span class="se">\</span>
  my-nginx
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run <code class="highlighter-rouge">docker service ls</code> to verify that the service has been updated and all
tasks have been redeployed. Run <code class="highlighter-rouge">docker network inspect nginx-net</code> to verify
that no containers are connected to it. Run the same command for
<code class="highlighter-rouge">nginx-net-2</code> and notice that all the service task containers are connected
to it.</p>

    <blockquote>
      <p><strong>Note</strong>: Even though overlay networks are automatically created on swarm
worker nodes as needed, they are not automatically removed.</p>
    </blockquote>
  </li>
  <li>
    <p>Clean up the service and the networks. From <code class="highlighter-rouge">manager</code>, run the following
commands. The manager will direct the workers to remove the networks
automatically.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service rm my-nginx
<span class="nv">$ </span>docker network rm nginx-net nginx-net-2
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="use-a-user-defined-overlay-network">Use a user-defined overlay network</h2>

<h3 id="prerequisites-2">Prerequisites</h3>

<p>This tutorial assumes the swarm is already set up and you are on a manager.</p>

<h3 id="walkthrough-1">Walkthrough</h3>

<ol>
  <li>
    <p>Create the user-defined overlay network.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> overlay my-overlay
</code></pre></div>    </div>
  </li>
  <li>
    <p>Start a service using the overlay network and publishing port 80 to port
8080 on the Docker host.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service create <span class="se">\</span>
  <span class="nt">--name</span> my-nginx <span class="se">\</span>
  <span class="nt">--network</span> my-overlay <span class="se">\</span>
  <span class="nt">--replicas</span> 1 <span class="se">\</span>
  <span class="nt">--publish</span> <span class="nv">published</span><span class="o">=</span>8080,target<span class="o">=</span>80 <span class="se">\</span>
  nginx:latest
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run <code class="highlighter-rouge">docker network inspect my-overlay</code> and verify that the <code class="highlighter-rouge">my-nginx</code>
service task is connected to it, by looking at the <code class="highlighter-rouge">Containers</code> section.</p>
  </li>
  <li>
    <p>Remove the service and the network.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service rm my-nginx

<span class="nv">$ </span>docker network rm my-overlay
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="use-an-overlay-network-for-standalone-containers">Use an overlay network for standalone containers</h2>

<p>This example demonstrates DNS container discovery -- specifically, how to
communicate between standalone containers on different Docker daemons using an
overlay network. Steps are:</p>

<ul>
  <li>On <code class="highlighter-rouge">host1</code>, initialize the node as a swarm (manager).</li>
  <li>On <code class="highlighter-rouge">host2</code>, join the node to the swarm (worker).</li>
  <li>On <code class="highlighter-rouge">host1</code>, create an attachable overlay network (<code class="highlighter-rouge">test-net</code>).</li>
  <li>On <code class="highlighter-rouge">host1</code>, run an interactive <a href="https://hub.docker.com/_/alpine/">alpine</a> container (<code class="highlighter-rouge">alpine1</code>) on <code class="highlighter-rouge">test-net</code>.</li>
  <li>On <code class="highlighter-rouge">host2</code>, run an interactive, and detached, <a href="https://hub.docker.com/_/alpine/">alpine</a> container (<code class="highlighter-rouge">alpine2</code>) on <code class="highlighter-rouge">test-net</code>.</li>
  <li>On <code class="highlighter-rouge">host1</code>, from within a session of <code class="highlighter-rouge">alpine1</code>, ping <code class="highlighter-rouge">alpine2</code>.</li>
</ul>

<h3 id="prerequisites-3">Prerequisites</h3>

<p>For this test, you need two different Docker hosts that can communicate with
each other. Each host must have Docker 17.06 or higher with the following ports
open between the two Docker hosts:</p>

<ul>
  <li>TCP port 2377</li>
  <li>TCP and UDP port 7946</li>
  <li>UDP port 4789</li>
</ul>

<p>One easy way to set this up is to have two VMs (either local or on a cloud
provider like AWS), each with Docker installed and running. If you’re using AWS
or a similar cloud computing platform, the easiest configuration is to use a
security group that opens all incoming ports between the two hosts and the SSH
port from your client’s IP address.</p>

<p>This example refers to the two nodes in our swarm as <code class="highlighter-rouge">host1</code> and <code class="highlighter-rouge">host2</code>. This
example also uses Linux hosts, but the same commands work on Windows.</p>

<h3 id="walk-through">Walk-through</h3>

<ol>
  <li>
    <p>Set up the swarm.</p>

    <p>a.  On <code class="highlighter-rouge">host1</code>, initialize a swarm (and if prompted, use <code class="highlighter-rouge">--advertise-addr</code>
    to specify the IP address for the interface that communicates with other
    hosts in the swarm, for instance, the private IP address on AWS):</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker swarm init
Swarm initialized: current node <span class="o">(</span>vz1mm9am11qcmo979tlrlox42<span class="o">)</span> is now a manager.

To add a worker to this swarm, run the following <span class="nb">command</span>:

    docker swarm join <span class="nt">--token</span> SWMTKN-1-5g90q48weqrtqryq4kj6ow0e8xm9wmv9o6vgqc5j320ymybd5c-8ex8j0bc40s6hgvy5ui5gl4gy 172.31.47.252:2377

To add a manager to this swarm, run <span class="s1">'docker swarm join-token manager'</span> and follow the instructions.
</code></pre></div>    </div>

    <p>b.  On <code class="highlighter-rouge">host2</code>, join the swarm as instructed above:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker swarm join <span class="nt">--token</span> &lt;your_token&gt; &lt;your_ip_address&gt;:2377
This node joined a swarm as a worker.
</code></pre></div>    </div>

    <p>If the node fails to join the swarm, the <code class="highlighter-rouge">docker swarm join</code> command times
out. To resolve, run <code class="highlighter-rouge">docker swarm leave --force</code> on <code class="highlighter-rouge">host2</code>, verify your
network and firewall settings, and try again.</p>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host1</code>, create an attachable overlay network called <code class="highlighter-rouge">test-net</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">--driver</span><span class="o">=</span>overlay <span class="nt">--attachable</span> test-net
uqsof8phj3ak0rq9k86zta6ht
</code></pre></div>    </div>

    <blockquote>
      <p>Notice the returned <strong>NETWORK ID</strong> -- you will see it again when you connect to it from <code class="highlighter-rouge">host2</code>.</p>
    </blockquote>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host1</code>, start an interactive (<code class="highlighter-rouge">-it</code>) container (<code class="highlighter-rouge">alpine1</code>) that connects to <code class="highlighter-rouge">test-net</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--name</span> alpine1 <span class="nt">--network</span> test-net alpine
/ <span class="c">#</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host2</code>, list the available networks -- notice that <code class="highlighter-rouge">test-net</code> does not yet exist:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network <span class="nb">ls
</span>NETWORK ID          NAME                DRIVER              SCOPE
ec299350b504        bridge              bridge              <span class="nb">local
</span>66e77d0d0e9a        docker_gwbridge     bridge              <span class="nb">local
</span>9f6ae26ccb82        host                host                <span class="nb">local
</span>omvdxqrda80z        ingress             overlay             swarm
b65c952a4b2b        none                null                <span class="nb">local</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host2</code>, start a detached (<code class="highlighter-rouge">-d</code>) and interactive (<code class="highlighter-rouge">-it</code>) container (<code class="highlighter-rouge">alpine2</code>) that connects to <code class="highlighter-rouge">test-net</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-dit</span> <span class="nt">--name</span> alpine2 <span class="nt">--network</span> test-net alpine
fb635f5ece59563e7b8b99556f816d24e6949a5f6a5b1fbd92ca244db17a4342
</code></pre></div>    </div>

    <blockquote>
      <p>Automatic DNS container discovery only works with unique container names.</p>
    </blockquote>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host2</code>, verify that <code class="highlighter-rouge">test-net</code> was created (and has the same NETWORK ID as <code class="highlighter-rouge">test-net</code> on <code class="highlighter-rouge">host1</code>):</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>docker network <span class="nb">ls
 </span>NETWORK ID          NAME                DRIVER              SCOPE
 ...
 uqsof8phj3ak        test-net            overlay             swarm
</code></pre></div>    </div>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host1</code>, ping <code class="highlighter-rouge">alpine2</code> within the interactive terminal of <code class="highlighter-rouge">alpine1</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ <span class="c"># ping -c 2 alpine2</span>
PING alpine2 <span class="o">(</span>10.0.0.5<span class="o">)</span>: 56 data bytes
64 bytes from 10.0.0.5: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.600 ms
64 bytes from 10.0.0.5: <span class="nv">seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.555 ms

<span class="nt">---</span> alpine2 ping statistics <span class="nt">---</span>
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max <span class="o">=</span> 0.555/0.577/0.600 ms
</code></pre></div>    </div>

    <p>The two containers communicate with the overlay network connecting the two
hosts. If you run another alpine container on <code class="highlighter-rouge">host2</code> that is <em>not detached</em>,
you can ping <code class="highlighter-rouge">alpine1</code> from <code class="highlighter-rouge">host2</code> (and here we add the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/run/#clean-up---rm">remove option</a> for automatic container cleanup):</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--name</span> alpine3 <span class="nt">--network</span> test-net alpine
/ <span class="c"># ping -c 2 alpine1</span>
/ <span class="c"># exit</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>On <code class="highlighter-rouge">host1</code>, close the <code class="highlighter-rouge">alpine1</code> session (which also stops the container):</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ <span class="c"># exit</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Clean up your containers and networks:</p>

    <p>You must stop and remove the containers on each host independently because
Docker daemons operate independently and these are standalone containers.
You only have to remove the network on <code class="highlighter-rouge">host1</code> because when you stop
<code class="highlighter-rouge">alpine2</code> on <code class="highlighter-rouge">host2</code>, <code class="highlighter-rouge">test-net</code> disappears.</p>

    <p>a.  On <code class="highlighter-rouge">host2</code>, stop <code class="highlighter-rouge">alpine2</code>, check that <code class="highlighter-rouge">test-net</code> was removed, then remove <code class="highlighter-rouge">alpine2</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container stop alpine2
<span class="nv">$ </span>docker network <span class="nb">ls</span>
<span class="nv">$ </span>docker container rm alpine2
</code></pre></div>    </div>

    <p>a.  On <code class="highlighter-rouge">host1</code>, remove <code class="highlighter-rouge">alpine1</code> and <code class="highlighter-rouge">test-net</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container rm alpine1
<span class="nv">$ </span>docker network rm test-net
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="communicate-between-a-container-and-a-swarm-service">Communicate between a container and a swarm service</h2>

<h3 id="prerequisites-4">Prerequisites</h3>

<p>You need Docker 17.06 or higher for this example.</p>

<h3 id="walkthrough-2">Walkthrough</h3>

<p>In this example, you start two different <code class="highlighter-rouge">alpine</code> containers on the same Docker
host and do some tests to understand how they communicate with each other. You
need to have Docker installed and running.</p>

<ol>
  <li>
    <p>Open a terminal window. List current networks before you do anything else.
Here’s what you should see if you’ve never added a network or initialized a
swarm on this Docker daemon. You may see different networks, but you should
at least see these (the network IDs will be different):</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER              SCOPE
17e324f45964        bridge              bridge              <span class="nb">local
</span>6ed54d316334        host                host                <span class="nb">local
</span>7092879f2cc8        none                null                <span class="nb">local</span>
</code></pre></div>    </div>

    <p>The default <code class="highlighter-rouge">bridge</code> network is listed, along with <code class="highlighter-rouge">host</code> and <code class="highlighter-rouge">none</code>. The
latter two are not fully-fledged networks, but are used to start a container
connected directly to the Docker daemon host’s networking stack, or to start
a container with no network devices. <strong>This tutorial will connect two
containers to the <code class="highlighter-rouge">bridge</code> network.</strong></p>
  </li>
  <li>
    <p>Start two <code class="highlighter-rouge">alpine</code> containers running <code class="highlighter-rouge">ash</code>, which is Alpine’s default shell
rather than <code class="highlighter-rouge">bash</code>. The <code class="highlighter-rouge">-dit</code> flags mean to start the container detached
(in the background), interactive (with the ability to type into it), and
with a TTY (so you can see the input and output). Since you are starting it
detached, you won’t be connected to the container right away. Instead, the
container’s ID will be printed. Because you have not specified any
<code class="highlighter-rouge">--network</code> flags, the containers connect to the default <code class="highlighter-rouge">bridge</code> network.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-dit</span> <span class="nt">--name</span> alpine1 alpine ash

<span class="nv">$ </span>docker run <span class="nt">-dit</span> <span class="nt">--name</span> alpine2 alpine ash
</code></pre></div>    </div>

    <p>Check that both containers are actually started:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container <span class="nb">ls

</span>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
602dbf1edc81        alpine              <span class="s2">"ash"</span>               4 seconds ago       Up 3 seconds                            alpine2
da33b7aa74b0        alpine              <span class="s2">"ash"</span>               17 seconds ago      Up 16 seconds                           alpine1
</code></pre></div>    </div>
  </li>
  <li>
    <p>Inspect the <code class="highlighter-rouge">bridge</code> network to see what containers are connected to it.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network inspect bridge

<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"Name"</span>: <span class="s2">"bridge"</span>,
        <span class="s2">"Id"</span>: <span class="s2">"17e324f459648a9baaea32b248d3884da102dde19396c25b30ec800068ce6b10"</span>,
        <span class="s2">"Created"</span>: <span class="s2">"2017-06-22T20:27:43.826654485Z"</span>,
        <span class="s2">"Scope"</span>: <span class="s2">"local"</span>,
        <span class="s2">"Driver"</span>: <span class="s2">"bridge"</span>,
        <span class="s2">"EnableIPv6"</span>: <span class="nb">false</span>,
        <span class="s2">"IPAM"</span>: <span class="o">{</span>
            <span class="s2">"Driver"</span>: <span class="s2">"default"</span>,
            <span class="s2">"Options"</span>: null,
            <span class="s2">"Config"</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">"Subnet"</span>: <span class="s2">"172.17.0.0/16"</span>,
                    <span class="s2">"Gateway"</span>: <span class="s2">"172.17.0.1"</span>
                <span class="o">}</span>
            <span class="o">]</span>
        <span class="o">}</span>,
        <span class="s2">"Internal"</span>: <span class="nb">false</span>,
        <span class="s2">"Attachable"</span>: <span class="nb">false</span>,
        <span class="s2">"Containers"</span>: <span class="o">{</span>
            <span class="s2">"602dbf1edc81813304b6cf0a647e65333dc6fe6ee6ed572dc0f686a3307c6a2c"</span>: <span class="o">{</span>
                <span class="s2">"Name"</span>: <span class="s2">"alpine2"</span>,
                <span class="s2">"EndpointID"</span>: <span class="s2">"03b6aafb7ca4d7e531e292901b43719c0e34cc7eef565b38a6bf84acf50f38cd"</span>,
                <span class="s2">"MacAddress"</span>: <span class="s2">"02:42:ac:11:00:03"</span>,
                <span class="s2">"IPv4Address"</span>: <span class="s2">"172.17.0.3/16"</span>,
                <span class="s2">"IPv6Address"</span>: <span class="s2">""</span>
            <span class="o">}</span>,
            <span class="s2">"da33b7aa74b0bf3bda3ebd502d404320ca112a268aafe05b4851d1e3312ed168"</span>: <span class="o">{</span>
                <span class="s2">"Name"</span>: <span class="s2">"alpine1"</span>,
                <span class="s2">"EndpointID"</span>: <span class="s2">"46c044a645d6afc42ddd7857d19e9dcfb89ad790afb5c239a35ac0af5e8a5bc5"</span>,
                <span class="s2">"MacAddress"</span>: <span class="s2">"02:42:ac:11:00:02"</span>,
                <span class="s2">"IPv4Address"</span>: <span class="s2">"172.17.0.2/16"</span>,
                <span class="s2">"IPv6Address"</span>: <span class="s2">""</span>
            <span class="o">}</span>
        <span class="o">}</span>,
        <span class="s2">"Options"</span>: <span class="o">{</span>
            <span class="s2">"com.docker.network.bridge.default_bridge"</span>: <span class="s2">"true"</span>,
            <span class="s2">"com.docker.network.bridge.enable_icc"</span>: <span class="s2">"true"</span>,
            <span class="s2">"com.docker.network.bridge.enable_ip_masquerade"</span>: <span class="s2">"true"</span>,
            <span class="s2">"com.docker.network.bridge.host_binding_ipv4"</span>: <span class="s2">"0.0.0.0"</span>,
            <span class="s2">"com.docker.network.bridge.name"</span>: <span class="s2">"docker0"</span>,
            <span class="s2">"com.docker.network.driver.mtu"</span>: <span class="s2">"1500"</span>
        <span class="o">}</span>,
        <span class="s2">"Labels"</span>: <span class="o">{}</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre></div>    </div>

    <p>Near the top, information about the <code class="highlighter-rouge">bridge</code> network is listed, including
the IP address of the gateway between the Docker host and the <code class="highlighter-rouge">bridge</code>
network (<code class="highlighter-rouge">172.17.0.1</code>). Under the <code class="highlighter-rouge">Containers</code> key, each connected container
is listed, along with information about its IP address (<code class="highlighter-rouge">172.17.0.2</code> for
<code class="highlighter-rouge">alpine1</code> and <code class="highlighter-rouge">172.17.0.3</code> for <code class="highlighter-rouge">alpine2</code>).</p>
  </li>
  <li>
    <p>The containers are running in the background. Use the <code class="highlighter-rouge">docker attach</code>
command to connect to <code class="highlighter-rouge">alpine1</code>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker attach alpine1

/ <span class="c">#</span>
</code></pre></div>    </div>

    <p>The prompt changes to <code class="highlighter-rouge">#</code> to indicate that you are the <code class="highlighter-rouge">root</code> user within
the container. Use the <code class="highlighter-rouge">ip addr show</code> command to show the network interfaces
for <code class="highlighter-rouge">alpine1</code> as they look from within the container:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ip addr show</span>

1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
27: eth0@if28: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.2/16 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:acff:fe11:2/64 scope link
       valid_lft forever preferred_lft forever
</code></pre></div>    </div>

    <p>The first interface is the loopback device. Ignore it for now. Notice that
the second interface has the IP address <code class="highlighter-rouge">172.17.0.2</code>, which is the same
address shown for <code class="highlighter-rouge">alpine1</code> in the previous step.</p>
  </li>
  <li>
    <p>From within <code class="highlighter-rouge">alpine1</code>, make sure you can connect to the internet by
pinging <code class="highlighter-rouge">google.com</code>. The <code class="highlighter-rouge">-c 2</code> flag limits the command two two <code class="highlighter-rouge">ping</code>
attempts.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ping -c 2 google.com</span>

PING google.com <span class="o">(</span>172.217.3.174<span class="o">)</span>: 56 data bytes
64 bytes from 172.217.3.174: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>41 <span class="nb">time</span><span class="o">=</span>9.841 ms
64 bytes from 172.217.3.174: <span class="nv">seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>41 <span class="nb">time</span><span class="o">=</span>9.897 ms

<span class="nt">---</span> google.com ping statistics <span class="nt">---</span>
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max <span class="o">=</span> 9.841/9.869/9.897 ms
</code></pre></div>    </div>
  </li>
  <li>
    <p>Now try to ping the second container. First, ping it by its IP address,
<code class="highlighter-rouge">172.17.0.3</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ping -c 2 172.17.0.3</span>

PING 172.17.0.3 <span class="o">(</span>172.17.0.3<span class="o">)</span>: 56 data bytes
64 bytes from 172.17.0.3: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.086 ms
64 bytes from 172.17.0.3: <span class="nv">seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.094 ms

<span class="nt">---</span> 172.17.0.3 ping statistics <span class="nt">---</span>
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max <span class="o">=</span> 0.086/0.090/0.094 ms
</code></pre></div>    </div>

    <p>This succeeds. Next, try pinging the <code class="highlighter-rouge">alpine2</code> container by container
name. This will fail.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ping -c 2 alpine2</span>

ping: bad address <span class="s1">'alpine2'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Detach from <code class="highlighter-rouge">alpine1</code> without stopping it by using the detach sequence,
<code class="highlighter-rouge">CTRL</code> + <code class="highlighter-rouge">p</code> <code class="highlighter-rouge">CTRL</code> + <code class="highlighter-rouge">q</code> (hold down <code class="highlighter-rouge">CTRL</code> and type <code class="highlighter-rouge">p</code> followed by <code class="highlighter-rouge">q</code>).
If you wish, attach to <code class="highlighter-rouge">alpine2</code> and repeat steps 4, 5, and 6 there,
substituting <code class="highlighter-rouge">alpine1</code> for <code class="highlighter-rouge">alpine2</code>.</p>
  </li>
  <li>
    <p>Stop and remove both containers.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container stop alpine1 alpine2
<span class="nv">$ </span>docker container rm alpine1 alpine2
</code></pre></div>    </div>
  </li>
</ol>

<p>Remember, the default <code class="highlighter-rouge">bridge</code> network is not recommended for production. To
learn about user-defined bridge networks, continue to the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-user-defined-bridge-networks">next tutorial</a>.</p>

<h2 id="other-networking-tutorials">Other networking tutorials</h2>

<p>Now that you have completed the networking tutorials for overlay networks,
you might want to run through these other networking tutorials:</p>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-host/">Host networking tutorial</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-standalone/">Standalone networking tutorial</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-macvlan/">Macvlan networking tutorial</a></li>
</ul>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=networking">networking</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=bridge">bridge</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=routing">routing</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=ports">ports</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=swarm">swarm</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=overlay">overlay</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/network/network-tutorial-overlay/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "network/network-tutorial-overlay.md",
										"title": "Networking with overlay networks",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/network/network-tutorial-overlay.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v18.09.local/network/network-tutorial-overlay.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [network/network-tutorial-overlay.md](https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#prerequisites" class="nomunge">Prerequisites</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-the-default-overlay-network" class="nomunge">Use the default overlay network</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#prerequisites-1" class="nomunge">Prerequisites</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#walkthrough" class="nomunge">Walkthrough</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-a-user-defined-overlay-network" class="nomunge">Use a user-defined overlay network</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#prerequisites-2" class="nomunge">Prerequisites</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#walkthrough-1" class="nomunge">Walkthrough</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#use-an-overlay-network-for-standalone-containers" class="nomunge">Use an overlay network for standalone containers</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#prerequisites-3" class="nomunge">Prerequisites</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#walk-through" class="nomunge">Walk-through</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#communicate-between-a-container-and-a-swarm-service" class="nomunge">Communicate between a container and a swarm service</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#prerequisites-4" class="nomunge">Prerequisites</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#walkthrough-2" class="nomunge">Walkthrough</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/network/network-tutorial-overlay/#other-networking-tutorials" class="nomunge">Other networking tutorials</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/network/network-tutorial-overlay/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
