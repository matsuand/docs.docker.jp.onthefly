<!-- Page generated 2020-04-13 12:18:52 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="/docs.docker.jp.onthefly/config/containers/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
	<!-- End Google Tag Manager -->
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2020-04-13T12:18:52+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Runtime options with Memory, CPUs, and GPUs"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="By default, a container has no resource constraints and can use as much of a given resource as the host’s kernel scheduler allows. Docker provides ways to control how much..." />
	<meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker ドキュメント"/>
	<meta property="article:published_time" itemprop="datePublished" content="2020-04-13T12:18:52+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="docker, daemon, configuration, runtime">
	<link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Runtime options with Memory, CPUs, and GPUs | Docker ドキュメント</title>
<meta property="og:title" content="Runtime options with Memory, CPUs, and GPUs" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Specify the runtime options for a container" />
<meta property="og:description" content="Specify the runtime options for a container" />
<link rel="canonical" href="/docs.docker.jp.onthefly/config/containers/resource_constraints/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/config/containers/resource_constraints/" />
<meta property="og:site_name" content="Docker ドキュメント" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Runtime options with Memory, CPUs, and GPUs","description":"Specify the runtime options for a container","url":"https://matsuand.github.io/docs.docker.jp.onthefly/config/containers/resource_constraints/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (current)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Runtime options with Memory, CPUs, and GPUs</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    16 分
  
</span>

							
							
							<p>By default, a container has no resource constraints and can use as much of a
given resource as the host’s kernel scheduler allows. Docker provides ways
to control how much memory, or CPU a container can use, setting runtime
configuration flags of the <code class="highlighter-rouge">docker run</code> command. This section provides details
on when you should set such limits and the possible implications of setting them.</p>

<p>Many of these features require your kernel to support Linux capabilities. To
check for support, you can use the
<a href="/docs.docker.jp.onthefly/engine/reference/commandline/info.md"><code class="highlighter-rouge">docker info</code></a> command. If a capability
is disabled in your kernel, you may see a warning at the end of the output like
the following:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">WARNING: No swap limit support
</span></code></pre></div></div>

<p>Consult your operating system’s documentation for enabling them.
<a href="/docs.docker.jp.onthefly/engine/install/linux-postinstall.md#your-kernel-does-not-support-cgroup-swap-limit-capabilities">Learn more</a>.</p>

<h2 id="memory">Memory</h2>

<h3 id="understand-the-risks-of-running-out-of-memory">Understand the risks of running out of memory</h3>

<p>It is important not to allow a running container to consume too much of the
host machine’s memory. On Linux hosts, if the kernel detects that there is not
enough memory to perform important system functions, it throws an <code class="highlighter-rouge">OOME</code>, or
<code class="highlighter-rouge">Out Of Memory Exception</code>, and starts killing processes to free up
memory. Any process is subject to killing, including Docker and other important
applications. This can effectively bring the entire system down if the wrong
process is killed.</p>

<p>Docker attempts to mitigate these risks by adjusting the OOM priority on the
Docker daemon so that it is less likely to be killed than other processes
on the system. The OOM priority on containers is not adjusted. This makes it more
likely for an individual container to be killed than for the Docker daemon
or other system processes to be killed. You should not try to circumvent
these safeguards by manually setting <code class="highlighter-rouge">--oom-score-adj</code> to an extreme negative
number on the daemon or a container, or by setting <code class="highlighter-rouge">--oom-kill-disable</code> on a
container.</p>

<p>For more information about the Linux kernel’s OOM management, see
<a href="https://www.kernel.org/doc/gorman/html/understand/understand016.html" target="_blank" class="_">Out of Memory Management</a>.</p>

<p>You can mitigate the risk of system instability due to OOME by:</p>

<ul>
  <li>Perform tests to understand the memory requirements of your application before
placing it into production.</li>
  <li>Ensure that your application runs only on hosts with adequate resources.</li>
  <li>Limit the amount of memory your container can use, as described below.</li>
  <li>Be mindful when configuring swap on your Docker hosts. Swap is slower and
less performant than memory but can provide a buffer against running out of
system memory.</li>
  <li>Consider converting your container to a <a href="/docs.docker.jp.onthefly/engine/swarm/services.md">service</a>,
and using service-level constraints and node labels to ensure that the
application runs only on hosts with enough memory</li>
</ul>

<h3 id="limit-a-containers-access-to-memory">Limit a container’s access to memory</h3>

<p>Docker can enforce hard memory limits, which allow the container to use no more
than a given amount of user or system memory, or soft limits, which allow the
container to use as much memory as it needs unless certain conditions are met,
such as when the kernel detects low memory or contention on the host machine.
Some of these options have different effects when used alone or when more than
one option is set.</p>

<p>Most of these options take a positive integer, followed by a suffix of <code class="highlighter-rouge">b</code>, <code class="highlighter-rouge">k</code>,
<code class="highlighter-rouge">m</code>, <code class="highlighter-rouge">g</code>, to indicate bytes, kilobytes, megabytes, or gigabytes.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">-m</code> or <code class="highlighter-rouge">--memory=</code></td>
      <td style="text-align: left">The maximum amount of memory the container can use. If you set this option, the minimum allowed value is <code class="highlighter-rouge">4m</code> (4 megabyte).</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--memory-swap</code>*</td>
      <td style="text-align: left">The amount of memory this container is allowed to swap to disk. See <a href="/docs.docker.jp.onthefly/resource_constraints.md#--memory-swap-details"><code class="highlighter-rouge">--memory-swap</code> details</a>.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--memory-swappiness</code></td>
      <td style="text-align: left">By default, the host kernel can swap out a percentage of anonymous pages used by a container. You can set <code class="highlighter-rouge">--memory-swappiness</code> to a value between 0 and 100, to tune this percentage. See <a href="/docs.docker.jp.onthefly/resource_constraints.md#--memory-swappiness-details"><code class="highlighter-rouge">--memory-swappiness</code> details</a>.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--memory-reservation</code></td>
      <td style="text-align: left">Allows you to specify a soft limit smaller than <code class="highlighter-rouge">--memory</code> which is activated when Docker detects contention or low memory on the host machine. If you use <code class="highlighter-rouge">--memory-reservation</code>, it must be set lower than <code class="highlighter-rouge">--memory</code> for it to take precedence. Because it is a soft limit, it does not guarantee that the container doesn’t exceed the limit.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--kernel-memory</code></td>
      <td style="text-align: left">The maximum amount of kernel memory the container can use. The minimum allowed value is <code class="highlighter-rouge">4m</code>. Because kernel memory cannot be swapped out, a container which is starved of kernel memory may block host machine resources, which can have side effects on the host machine and on other containers. See <a href="/docs.docker.jp.onthefly/resource_constraints.md#--kernel-memory-details"><code class="highlighter-rouge">--kernel-memory</code> details</a>.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--oom-kill-disable</code></td>
      <td style="text-align: left">By default, if an out-of-memory (OOM) error occurs, the kernel kills processes in a container. To change this behavior, use the <code class="highlighter-rouge">--oom-kill-disable</code> option. Only disable the OOM killer on containers where you have also set the <code class="highlighter-rouge">-m/--memory</code> option. If the <code class="highlighter-rouge">-m</code> flag is not set, the host can run out of memory and the kernel may need to kill the host system’s processes to free memory.</td>
    </tr>
  </tbody>
</table>

<p>For more information about cgroups and memory in general, see the documentation
for <a href="https://www.kernel.org/doc/Documentation/cgroup-v1/memory.txt">Memory Resource Controller</a>.</p>

<h3 id="--memory-swap-details"><code class="highlighter-rouge">--memory-swap</code> details</h3>

<p><code class="highlighter-rouge">--memory-swap</code> is a modifier flag that only has meaning if <code class="highlighter-rouge">--memory</code> is also
set. Using swap allows the container to write excess memory requirements to disk
when the container has exhausted all the RAM that is available to it. There is a
performance penalty for applications that swap memory to disk often.</p>

<p>Its setting can have complicated effects:</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">--memory-swap</code> is set to a positive integer, then both <code class="highlighter-rouge">--memory</code> and
<code class="highlighter-rouge">--memory-swap</code> must be set. <code class="highlighter-rouge">--memory-swap</code> represents the total amount of
memory and swap that can be used, and <code class="highlighter-rouge">--memory</code> controls the amount used by
non-swap memory. So if <code class="highlighter-rouge">--memory="300m"</code> and <code class="highlighter-rouge">--memory-swap="1g"</code>, the
container can use 300m of memory and 700m (<code class="highlighter-rouge">1g - 300m</code>) swap.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">--memory-swap</code> is set to <code class="highlighter-rouge">0</code>, the setting is ignored, and the value is
treated as unset.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">--memory-swap</code> is set to the same value as <code class="highlighter-rouge">--memory</code>, and <code class="highlighter-rouge">--memory</code> is
set to a positive integer, <strong>the container does not have access to swap</strong>.
See
<a href="/docs.docker.jp.onthefly/resource_constraints.md#prevent-a-container-from-using-swap">Prevent a container from using swap</a>.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">--memory-swap</code> is unset, and <code class="highlighter-rouge">--memory</code> is set, the container can use
as much swap as the <code class="highlighter-rouge">--memory</code> setting, if the host container has swap
memory configured. For instance, if <code class="highlighter-rouge">--memory="300m"</code> and <code class="highlighter-rouge">--memory-swap</code> is
not set, the container can use 600m in total of memory and swap.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">--memory-swap</code> is explicitly set to <code class="highlighter-rouge">-1</code>, the container is allowed to use
unlimited swap, up to the amount available on the host system.</p>
  </li>
  <li>
    <p>Inside the container, tools like <code class="highlighter-rouge">free</code> report the host’s available swap, not what’s available inside the container. Don’t rely on the output of <code class="highlighter-rouge">free</code> or similar tools to determine whether swap is present.</p>
  </li>
</ul>

<h4 id="prevent-a-container-from-using-swap">Prevent a container from using swap</h4>

<p>If <code class="highlighter-rouge">--memory</code> and <code class="highlighter-rouge">--memory-swap</code> are set to the same value, this prevents
containers from using any swap. This is because <code class="highlighter-rouge">--memory-swap</code> is the amount of
combined memory and swap that can be used, while <code class="highlighter-rouge">--memory</code> is only the amount
of physical memory that can be used.</p>

<h3 id="--memory-swappiness-details"><code class="highlighter-rouge">--memory-swappiness</code> details</h3>

<ul>
  <li>A value of 0 turns off anonymous page swapping.</li>
  <li>A value of 100 sets all anonymous pages as swappable.</li>
  <li>By default, if you do not set <code class="highlighter-rouge">--memory-swappiness</code>, the value is
inherited from the host machine.</li>
</ul>

<h3 id="--kernel-memory-details"><code class="highlighter-rouge">--kernel-memory</code> details</h3>

<p>Kernel memory limits are expressed in terms of the overall memory allocated to
a container. Consider the following scenarios:</p>

<ul>
  <li><strong>Unlimited memory, unlimited kernel memory</strong>: This is the default
behavior.</li>
  <li><strong>Unlimited memory, limited kernel memory</strong>: This is appropriate when the
amount of memory needed by all cgroups is greater than the amount of
memory that actually exists on the host machine. You can configure the
kernel memory to never go over what is available on the host machine,
and containers which need more memory need to wait for it.</li>
  <li><strong>Limited memory, unlimited kernel memory</strong>: The overall memory is
limited, but the kernel memory is not.</li>
  <li><strong>Limited memory, limited kernel memory</strong>: Limiting both user and kernel
memory can be useful for debugging memory-related problems. If a container
is using an unexpected amount of either type of memory, it runs out
of memory without affecting other containers or the host machine. Within
this setting, if the kernel memory limit is lower than the user memory
limit, running out of kernel memory causes the container to experience
an OOM error. If the kernel memory limit is higher than the user memory
limit, the kernel limit does not cause the container to experience an OOM.</li>
</ul>

<p>When you turn on any kernel memory limits, the host machine tracks “high water
mark” statistics on a per-process basis, so you can track which processes (in
this case, containers) are using excess memory. This can be seen per process
by viewing <code class="highlighter-rouge">/proc/&lt;PID&gt;/status</code> on the host machine.</p>

<h2 id="cpu">CPU</h2>

<p>By default, each container’s access to the host machine’s CPU cycles is unlimited.
You can set various constraints to limit a given container’s access to the host
machine’s CPU cycles. Most users use and configure the
<a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-the-default-cfs-scheduler">default CFS scheduler</a>. In Docker 1.13
and higher, you can also configure the
<a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-the-realtime-scheduler">realtime scheduler</a>.</p>

<h3 id="configure-the-default-cfs-scheduler">Configure the default CFS scheduler</h3>

<p>The CFS is the Linux kernel CPU scheduler for normal Linux processes. Several
runtime flags allow you to configure the amount of access to CPU resources your
container has. When you use these settings, Docker modifies the settings for
the container’s cgroup on the host machine.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cpus=&lt;value&gt;</code></td>
      <td style="text-align: left">Specify how much of the available CPU resources a container can use. For instance, if the host machine has two CPUs and you set <code class="highlighter-rouge">--cpus="1.5"</code>, the container is guaranteed at most one and a half of the CPUs. This is the equivalent of setting <code class="highlighter-rouge">--cpu-period="100000"</code> and <code class="highlighter-rouge">--cpu-quota="150000"</code>. Available in Docker 1.13 and higher.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cpu-period=&lt;value&gt;</code></td>
      <td style="text-align: left">Specify the CPU CFS scheduler period, which is used alongside  <code class="highlighter-rouge">--cpu-quota</code>. Defaults to 100 micro-seconds. Most users do not change this from the default. If you use Docker 1.13 or higher, use <code class="highlighter-rouge">--cpus</code> instead.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cpu-quota=&lt;value&gt;</code></td>
      <td style="text-align: left">Impose a CPU CFS quota on the container. The number of microseconds per <code class="highlighter-rouge">--cpu-period</code> that the container is limited to before throttled. As such acting as the effective ceiling. If you use Docker 1.13 or higher, use <code class="highlighter-rouge">--cpus</code> instead.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cpuset-cpus</code></td>
      <td style="text-align: left">Limit the specific CPUs or cores a container can use. A comma-separated list or hyphen-separated range of CPUs a container can use, if you have more than one CPU. The first CPU is numbered 0. A valid value might be <code class="highlighter-rouge">0-3</code> (to use the first, second, third, and fourth CPU) or <code class="highlighter-rouge">1,3</code> (to use the second and fourth CPU).</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cpu-shares</code></td>
      <td style="text-align: left">Set this flag to a value greater or less than the default of 1024 to increase or reduce the container’s weight, and give it access to a greater or lesser proportion of the host machine’s CPU cycles. This is only enforced when CPU cycles are constrained. When plenty of CPU cycles are available, all containers use as much CPU as they need. In that way, this is a soft limit. <code class="highlighter-rouge">--cpu-shares</code> does not prevent containers from being scheduled in swarm mode. It prioritizes container CPU resources for the available CPU cycles. It does not guarantee or reserve any specific CPU access.</td>
    </tr>
  </tbody>
</table>

<p>If you have 1 CPU, each of the following commands guarantees the container at
most 50% of the CPU every second.</p>

<p><strong>Docker 1.13 and higher</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--cpus</span><span class="o">=</span><span class="s2">".5"</span> ubuntu /bin/bash
</code></pre></div></div>

<p><strong>Docker 1.12 and lower</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--cpu-period</span><span class="o">=</span>100000 <span class="nt">--cpu-quota</span><span class="o">=</span>50000 ubuntu /bin/bash
</code></pre></div></div>

<h3 id="configure-the-realtime-scheduler">Configure the realtime scheduler</h3>

<p>In Docker 1.13 and higher, you can configure your container to use the
realtime scheduler, for tasks which cannot use the CFS scheduler. You need to
<a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-the-host-machines-kernel">make sure the host machine’s kernel is configured correctly</a>
before you can <a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-the-docker-daemon">configure the Docker daemon</a> or
<a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-individual-containers">configure individual containers</a>.</p>

<blockquote class="warning">
  <p><strong>Warning</strong></p>

  <p>CPU scheduling and prioritization are advanced kernel-level features. Most
users do not need to change these values from their defaults. Setting these
values incorrectly can cause your host system to become unstable or unusable.</p>
</blockquote>

<h4 id="configure-the-host-machines-kernel">Configure the host machine’s kernel</h4>

<p>Verify that <code class="highlighter-rouge">CONFIG_RT_GROUP_SCHED</code> is enabled in the Linux kernel by running
<code class="highlighter-rouge">zcat /proc/config.gz | grep CONFIG_RT_GROUP_SCHED</code> or by checking for the
existence of the file <code class="highlighter-rouge">/sys/fs/cgroup/cpu.rt_runtime_us</code>. For guidance on
configuring the kernel realtime scheduler, consult the documentation for your
operating system.</p>

<h4 id="configure-the-docker-daemon">Configure the Docker daemon</h4>

<p>To run containers using the realtime scheduler, run the Docker daemon with
the <code class="highlighter-rouge">--cpu-rt-runtime</code> flag set to the maximum number of microseconds reserved
for realtime tasks per runtime period. For instance, with the default period of
1000000 microseconds (1 second), setting <code class="highlighter-rouge">--cpu-rt-runtime=950000</code> ensures that
containers using the realtime scheduler can run for 950000 microseconds for every
1000000-microsecond period, leaving at least 50000 microseconds available for
non-realtime tasks. To make this configuration permanent on systems which use
<code class="highlighter-rouge">systemd</code>, see <a href="/docs.docker.jp.onthefly/config/daemon/systemd.md">Control and configure Docker with systemd</a>.</p>

<h4 id="configure-individual-containers">Configure individual containers</h4>

<p>You can pass several flags to control a container’s CPU priority when you
start the container using <code class="highlighter-rouge">docker run</code>. Consult your operating system’s
documentation or the <code class="highlighter-rouge">ulimit</code> command for information on appropriate values.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cap-add=sys_nice</code></td>
      <td style="text-align: left">Grants the container the <code class="highlighter-rouge">CAP_SYS_NICE</code> capability, which allows the container to raise process <code class="highlighter-rouge">nice</code> values, set real-time scheduling policies, set CPU affinity, and other operations.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--cpu-rt-runtime=&lt;value&gt;</code></td>
      <td style="text-align: left">The maximum number of microseconds the container can run at realtime priority within the Docker daemon’s realtime scheduler period. You also need the <code class="highlighter-rouge">--cap-add=sys_nice</code> flag.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">--ulimit rtprio=&lt;value&gt;</code></td>
      <td style="text-align: left">The maximum realtime priority allowed for the container. You also need the <code class="highlighter-rouge">--cap-add=sys_nice</code> flag.</td>
    </tr>
  </tbody>
</table>

<p>The following example command sets each of these three flags on a <code class="highlighter-rouge">debian:jessie</code>
container.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="se">\</span>
    <span class="nt">--cpu-rt-runtime</span><span class="o">=</span>950000 <span class="se">\</span>
    <span class="nt">--ulimit</span> <span class="nv">rtprio</span><span class="o">=</span>99 <span class="se">\</span>
    <span class="nt">--cap-add</span><span class="o">=</span>sys_nice <span class="se">\</span>
    debian:jessie
</code></pre></div></div>

<p>If the kernel or Docker daemon is not configured correctly, an error occurs.</p>

<h2 id="gpu">GPU</h2>

<h3 id="access-an-nvidia-gpu">Access an NVIDIA GPU</h3>

<h4 id="prerequisites">Prerequisites</h4>

<p>Visit the official <a href="https://www.nvidia.com/Download/index.aspx">NVIDIA drivers page</a>
to download and install the proper drivers. Reboot your system once you have
done so.</p>

<p>Verify that your GPU is running and accessible.</p>

<h4 id="install-nvidia-container-runtime">Install nvidia-container-runtime</h4>

<p>Follow the instructions at (https://nvidia.github.io/nvidia-container-runtime/)
and then run this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get install nvidia-container-runtime
</code></pre></div></div>

<p>Ensure the <code class="highlighter-rouge">nvidia-container-runtime-hook</code> is accessible from <code class="highlighter-rouge">$PATH</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>which nvidia-container-runtime-hook
</code></pre></div></div>

<p>Restart the Docker daemon.</p>

<h4 id="expose-gpus-for-use">Expose GPUs for use</h4>

<p>Include the <code class="highlighter-rouge">--gpus</code> flag when you start a container to access GPU resources.
Specify how many GPUs to use. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--gpus</span> all ubuntu nvidia-smi
</code></pre></div></div>

<p>Exposes all available GPUs and returns a result akin to the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-----------------------------------------------------------------------------+
| NVIDIA-SMI 384.130            	Driver Version: 384.130               	|
|-------------------------------+----------------------+----------------------+
| GPU  Name 	   Persistence-M| Bus-Id    	Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|<span class="o">===============================</span>+<span class="o">======================</span>+<span class="o">======================</span>|
|   0  GRID K520       	Off  | 00000000:00:03.0 Off |                  N/A |
| N/A   36C	P0    39W / 125W |  	0MiB /  4036MiB |      0%  	Default |
+-------------------------------+----------------------+----------------------+
+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU   	PID   Type   Process name                         	Usage  	|
|<span class="o">=============================================================================</span>|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</code></pre></div></div>

<p>Use the <code class="highlighter-rouge">device</code> option to specify GPUs. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--gpus</span> <span class="nv">device</span><span class="o">=</span>GPU-3a23c669-1f69-c64e-cf85-44e9b07e7a2a ubuntu nvidia-smi
</code></pre></div></div>

<p>Exposes that specific GPU.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--gpus</span> <span class="nv">device</span><span class="o">=</span>0,2 nvidia-smi
</code></pre></div></div>

<p>Exposes the first and third GPUs.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>NVIDIA GPUs can only be accessed by systems running a single engine.</p>
</blockquote>

<h4 id="set-nvidia-capabilities">Set NVIDIA capabilities</h4>

<p>You can set capabilities manually. For example, on Ubuntu you can run the
following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--gpus</span> <span class="s1">'all,capabilities=utility'</span> <span class="nt">--rm</span> ubuntu nvidia-smi
</code></pre></div></div>

<p>This enables the <code class="highlighter-rouge">utility</code> driver capability which adds the <code class="highlighter-rouge">nvidia-smi</code> tool to
the container.</p>

<p>Capabilities as well as other configurations can be set in images via
environment variables. More information on valid variables can be found at the
<a href="https://github.com/NVIDIA/nvidia-container-runtime">nvidia-container-runtime</a>
GitHub page. These variables can be set in a Dockerfile.</p>

<p>You can also utitize CUDA images which sets these variables automatically. See
the <a href="https://github.com/NVIDIA/nvidia-docker/wiki/CUDA">CUDA images</a> GitHub page
for more information.</p>

							<!-- tags -->
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=docker">docker</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=daemon">daemon</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=configuration">configuration</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=runtime">runtime</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/config/containers/resource_constraints/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "config/containers/resource_constraints.md",
										"title": "Runtime options with Memory, CPUs, and GPUs",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/config/containers/resource_constraints.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/config/containers/resource_constraints.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [config/containers/resource_constraints.md](https://matsuand.github.io/docs.docker.jp.onthefly/config/containers/resource_constraints/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#memory" class="nomunge">Memory</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#understand-the-risks-of-running-out-of-memory" class="nomunge">Understand the risks of running out of memory</a></li>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#limit-a-containers-access-to-memory" class="nomunge">Limit a container’s access to memory</a></li>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#--memory-swap-details" class="nomunge">--memory-swap details</a></li>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#--memory-swappiness-details" class="nomunge">--memory-swappiness details</a></li>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#--kernel-memory-details" class="nomunge">--kernel-memory details</a></li>
    </ul>
  </li>
  <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#cpu" class="nomunge">CPU</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-the-default-cfs-scheduler" class="nomunge">Configure the default CFS scheduler</a></li>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#configure-the-realtime-scheduler" class="nomunge">Configure the realtime scheduler</a></li>
    </ul>
  </li>
  <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#gpu" class="nomunge">GPU</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/resource_constraints.md#access-an-nvidia-gpu" class="nomunge">Access an NVIDIA GPU</a></li>
    </ul>
  </li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
	
	<script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/config/containers/resource_constraints/';
	</script>
	<script src="/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
