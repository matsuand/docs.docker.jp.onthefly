<!-- Page generated 2020-06-04 15:54:47 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style type="text/css">
      @charset "UTF-8";
      [ng\:cloak],
      [ng-cloak],
      [data-ng-cloak],
      [x-ng-cloak],
      .ng-cloak,
      .x-ng-cloak,
      .ng-hide:not(.ng-hide-animate) {
          display: none !important;
      }

      ng\:form {
          display: block;
      }
  </style>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>

  
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <!-- metadata -->
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2020-06-04T15:54:47+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:title" itemprop="title name" content="Docker Compose をはじめよう"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="このページでは、簡単な Python ウェブアプリケーションを Docker Compose 上に作り上げます。 このアプリケーションは Flask フレームワークを利用し、Redis によりアクセスカウンターを管理します。 サンプルでは Python を用いていますが、ここで示す考え方は Python に不慣れな方でも理解できるようにしています。 前提条件 Docker Engine と Docker Compose をインストールしておいてください。 Python や Redis はインストールする必要はありません。 これはいずれも Docker イメージとして提供されます。 ステップ..." />
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="article:published_time" itemprop="datePublished" content="2020-06-04T15:54:47+09:00"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="documentation, docs, docker, compose, orchestration, containers">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
  <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

  <!-- Go get "Open Sans" font from Google -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <!-- SEO stuff -->
  <title>Docker Compose をはじめよう | Docker Documentation</title>
  <meta property="og:title" content="Docker Compose をはじめよう" />
  <meta property="og:locale" content="ja_JP" />
  <meta name="description" content="Docker Compose をはじめよう。" />
  <meta property="og:description" content="Docker Compose をはじめよう。" />
  <link rel="canonical" href="/compose/gettingstarted/" />
  <meta property="og:url" content="https://docs.docker.com/compose/gettingstarted/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Docker Compose をはじめよう","description":"Docker Compose をはじめよう。","url":"https://docs.docker.com/compose/gettingstarted/"}</script>
  <!-- END SEO STUFF -->
  
  <script>
  // Default to assuming this is an archive and hiding some stuff
  // See js/archive.js and js/docs.js for logic relating to this
  var isArchive = true;
  var dockerVersion = 'v19.03';
  </script>
</head>


    <body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs">
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs">
    </a>
</div>
<div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div id="tabs">
        <ul class="tabs jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                            
                            <h1>Docker Compose をはじめよう</h1> 
                            <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    6 分
  
</span>

                            
                            
<p>このページでは、簡単な Python ウェブアプリケーションを Docker Compose 上に作り上げます。
このアプリケーションは Flask フレームワークを利用し、Redis によりアクセスカウンターを管理します。
サンプルでは Python を用いていますが、ここで示す考え方は Python に不慣れな方でも理解できるようにしています。</p>

<h2 id="prerequisites">前提条件</h2>

<p><a href="/docs.docker.jp.onthefly/get-docker/">Docker Engine</a> と <a href="/docs.docker.jp.onthefly/compose/install/">Docker Compose</a> をインストールしておいてください。
Python や Redis はインストールする必要はありません。
これはいずれも Docker イメージとして提供されます。</p>

<h2 id="step-1-setup">ステップ 1: セットアップ</h2>

<p>アプリケーションの依存パッケージを定義します。</p>

<ol>
  <li>
    <p>プロジェクト用のディレクトリを生成します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir composetest
$ cd composetest
</code></pre></div>    </div>
  </li>
  <li>
    <p>プロジェクトディレクトリ内に <code class="highlighter-rouge">app.py</code> というファイルを生成して、以下の記述を書き写してください。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import time

import redis
from flask import Flask

app = Flask(__name__)
cache = redis.Redis(host='redis', port=6379)


def get_hit_count():
    retries = 5
    while True:
        try:
            return cache.incr('hits')
        except redis.exceptions.ConnectionError as exc:
            if retries == 0:
                raise exc
            retries -= 1
            time.sleep(0.5)


@app.route('/')
def hello():
    count = get_hit_count()
    return 'Hello World! I have been seen {} times.\n'.format(count)
</code></pre></div>    </div>

    <p>この例において <code class="highlighter-rouge">redis</code> とは、このアプリケーションネットワーク上の redis コンテナーのホスト名です。
  Redis のデフォルトポートとして <code class="highlighter-rouge">6379</code> を利用します。</p>

    <blockquote>
      <p>一時的なエラーの取り扱い</p>

      <p><code class="highlighter-rouge">get_hit_count</code> という関数がどのように書かれているかを見てください。
この単純なリトライのループにより、redis サービスが起動していなかったとしても、リクエストを何度でも送信できます。
アプリケーションが起動する最中に対して、この方法が適していますが、さらにはこのアプリの動作中に redis サービスを再起動する必要が発生した場合も、アプリが柔軟に対応できる方法です。
クラスターを構成している場合、ノード間でのネットワークの瞬断を制御することもできます。</p>
    </blockquote>
  </li>
  <li>
    <p>プロジェクト用のディレクトリにもう一つ <code class="highlighter-rouge">requirements.txt</code> という名称のファイルを作成し、次のようにします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flask
redis
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="step-2-create-a-dockerfile">ステップ 2: Dockerfile の生成</h2>

<p>このステップでは、Docker イメージを構築する Dockerfile を作ります。
そのイメージには依存するすべてのもの、つまり Python と Python アプリケーションが含まれます。</p>

<p>プロジェクト用のディレクトリ内で <code class="highlighter-rouge">Dockerfile</code> という名称のファイルを作成し、次の内容にします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM python:3.7-alpine
WORKDIR /code
ENV FLASK_APP app.py
ENV FLASK_RUN_HOST 0.0.0.0
RUN apk add --no-cache gcc musl-dev linux-headers
COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt
COPY . .
CMD ["flask", "run"]
</code></pre></div></div>

<p>これは Docker に対して以下の指示を行います。</p>

<ul>
  <li>Python 3.7 イメージを使って当イメージを構築する</li>
  <li>作業用ディレクトリを <code class="highlighter-rouge">/code</code> に指定する</li>
  <li><code class="highlighter-rouge">flask</code>コマンドにより用いられる環境変数を設定する</li>
  <li>gcc をインストールし、MarkupSafe や SQLAlchemy Python のような Python 依存パッケージこのコンパイルをスピードアップする</li>
  <li><code class="highlighter-rouge">requirements.txt</code>をコピーして Python 依存パッケージをインストールする</li>
  <li>このプロジェクトのカレントディレクトリ<code class="highlighter-rouge">.</code>を、イメージ内のワークディレクトリ<code class="highlighter-rouge">.</code>にコピーする</li>
  <li>コンテナーに対するデフォルトのコマンドを <code class="highlighter-rouge">flask run</code> にする</li>
</ul>

<p>Dockerfile の書き方の詳細については、<a href="/docs.docker.jp.onthefly/develop/">Docker ユーザーガイド</a>や <a href="/engine/reference/builder/">Dockerfile リファレンス</a> をご覧ください。</p>

<h2 id="step-3-define-services-in-a-compose-file">ステップ 3: Compose ファイル内でのサービス定義</h2>

<p>プロジェクト用のディレクトリ内で <code class="highlighter-rouge">Dockerfile</code> という名称のファイルを作成し、次の内容にします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3'
services:
  web:
    build: .
    ports:
      - "5000:5000"
  redis:
    image: "redis:alpine"
</code></pre></div></div>

<p>この Compose ファイルは <code class="highlighter-rouge">web</code> と <code class="highlighter-rouge">redis</code> という 2 つのサービスを定義します。</p>

<h3 id="web-service">ウェブサービス</h3>

<p><code class="highlighter-rouge">web</code> サービスは、カレントディレクトリ内の <code class="highlighter-rouge">Dockerfile</code> からビルドされたイメージを利用します。
そしてコンテナーとホストマシンを、公開用ポート <code class="highlighter-rouge">5000</code> でつなぎます。
このサービス例では、Flask ウェブサーバーのデフォルトポートである <code class="highlighter-rouge">5000</code> を利用するものです。</p>

<h3 id="redis-service">Redis サービス</h3>

<p><code class="highlighter-rouge">redis</code> サービスには Docker Hub レジストリから取得した、公開の <a href="https://registry.hub.docker.com/_/redis/">Redis</a> イメージを利用します。</p>

<h2 id="step-4-build-and-run-your-app-with-compose">ステップ 4: Compose によるアプリケーションの構築と実行</h2>

<ol>
  <li>
    <p>プロジェクト用のディレクトリで <code class="highlighter-rouge">docker-compose up</code> によりアプリケーションを起動します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up
Creating network "composetest_default" with the default driver
Creating composetest_web_1 ...
Creating composetest_redis_1 ...
Creating composetest_web_1
Creating composetest_redis_1 ... done
Attaching to composetest_web_1, composetest_redis_1
web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
redis_1  | 1:C 17 Aug 22:11:10.480 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
redis_1  | 1:C 17 Aug 22:11:10.480 # Redis version=4.0.1, bits=64, commit=00000000, modified=0, pid=1, just started
redis_1  | 1:C 17 Aug 22:11:10.480 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
web_1    |  * Restarting with stat
redis_1  | 1:M 17 Aug 22:11:10.483 * Running mode=standalone, port=6379.
redis_1  | 1:M 17 Aug 22:11:10.483 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
web_1    |  * Debugger is active!
redis_1  | 1:M 17 Aug 22:11:10.483 # Server initialized
redis_1  | 1:M 17 Aug 22:11:10.483 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
web_1    |  * Debugger PIN: 330-787-903
redis_1  | 1:M 17 Aug 22:11:10.483 * Ready to accept connections
</code></pre></div>    </div>

    <p>Compose は Redis イメージを取得し、コードが動作するイメージを構築した上で、定義されているサービスを開始します。
この例ではビルド時において、コードがイメージ内に静的にコピーされます。</p>
  </li>
  <li>
    <p>ブラウザーで <code class="highlighter-rouge">http://localhost:5000/</code> を開き、アプリケーションの動作を確認します。</p>

    <p>Docker を Linux、Docker Desktop for Mac、Docker Desktop for Windows で直接使っている場合、ウェブアプリは Docker デーモンのホスト上でポート 5000 を開いています。
ブラウザーから http://localhost:5000 にアクセスして、<code class="highlighter-rouge">Hello World</code> メッセージが表示されることを確認してください。
接続できなければ <code class="highlighter-rouge">http://127.0.0.1:5000</code> も試してください。</p>

    <p>Docker Machine on Mac や Docker Machine on Windows を利用している場合は、<code class="highlighter-rouge">docker-machine ip 仮想マシン名</code> を実行して Docker ホスト上の IP アドレスを取得します。
そしてブラウザーから <code class="highlighter-rouge">http://仮想マシンのIP:5000</code> を開きます。</p>

    <p>ブラウザーには以下のメッセージが表示されます。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World! I have been seen 1 times.
</code></pre></div>    </div>

    <p><img src="/docs.docker.jp.onthefly/compose/images/quick-hello-world-1.png" alt="ブラウザー上の hello world" /></p>
  </li>
  <li>
    <p>ページを更新します。</p>

    <p>数値が更新されたはずです。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World! I have been seen 2 times.
</code></pre></div>    </div>

    <p><img src="/docs.docker.jp.onthefly/compose/images/quick-hello-world-2.png" alt="ブラウザー上の hello world" /></p>
  </li>
  <li>
    <p>別の端末画面を開いて <code class="highlighter-rouge">docker image ls</code> を実行し、ローカルのイメージ一覧を表示します。</p>

    <p>この時点で一覧表示されるイメージに <code class="highlighter-rouge">redis</code> と <code class="highlighter-rouge">web</code> が含まれます。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker image ls
REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE
composetest_web         latest              e2c21aa48cc1        4 minutes ago       93.8MB
python                  3.4-alpine          84e6077c7ab6        7 days ago          82.5MB
redis                   alpine              9d8fa9aa0e5b        3 weeks ago         27.5MB
</code></pre></div>    </div>

    <p><code class="highlighter-rouge">docker inspect &lt;tag または id&gt;</code> によってイメージを確認することもできます。</p>
  </li>
  <li>
    <p>アプリケーションを停止させます。
2 つめに開いた端末画面上のプロジェクトディレクトリにおいて <code class="highlighter-rouge">docker-compose down</code> を実行します。
またはアプリを開始したはじめの端末画面上において CTRL+C を入力します。</p>
  </li>
</ol>

<h2 id="step-5-edit-the-compose-file-to-add-a-bind-mount">ステップ 5: Compose ファイルにバインドマウントを追加</h2>

<p>プロジェクトディレクトリ内にある <code class="highlighter-rouge">docker-compose.yml</code> を編集して、<code class="highlighter-rouge">web</code> サービスへの <a href="/docs.docker.jp.onthefly/storage/bind-mounts/">バインドマウント</a> を追加します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3'
services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - .:/code
    environment:
      FLASK_ENV: development
  redis:
    image: "redis:alpine"
</code></pre></div></div>

<p>新しい <code class="highlighter-rouge">volumes</code> というキーは、ホスト上のプロジェクトディレクトリ（カレントディレクトリ）を、コンテナー内にある <code class="highlighter-rouge">/code</code> ディレクトリにマウントします。
こうすることで、イメージを再構築することなく、実行中のコードを修正できるようになります。
<code class="highlighter-rouge">environment</code>キーには環境変数<code class="highlighter-rouge">FLASK_ENV</code>を設定しています。
これは開発モードで<code class="highlighter-rouge">flask run</code>を実行し、コード変更時にリロードするよう指示します。
このモードは開発時にのみ用いるようにします。</p>

<h2 id="step-6-re-build-and-run-the-app-with-compose">ステップ 6: Compose によるアプリの再構築と実行</h2>

<p>プロジェクトディレクトリにて <code class="highlighter-rouge">docker-compose up</code> を入力する際に、Compose ファイルが更新されていると、アプリは再構築され実行されます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up
Creating network "composetest_default" with the default driver
Creating composetest_web_1 ...
Creating composetest_redis_1 ...
Creating composetest_web_1
Creating composetest_redis_1 ... done
Attaching to composetest_web_1, composetest_redis_1
web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
...
</code></pre></div></div>

<p><code class="highlighter-rouge">Hello World</code> メッセージをもう一度確認してみます。
再読み込みをすると、さらにカウンターが増えるはずです。</p>

<blockquote class="important">
  <p>フォルダ、ボリューム、バインドマウントの共有</p>

  <ul>
    <li>
      <p>プロジェクトを <code class="highlighter-rouge">Users</code> ディレクトリ（<code class="highlighter-rouge">cd ~</code>）以外に置いている場合、利用している Dockerfile やボリュームのドライブ、ディレクトリは、共有できるようにしておく必要があります。
実行時に、アプリケーションファイルが見つからない、ボリュームマウントが拒否される、サービスが起動できない、といったランタイムエラーが発生した場合は、ファイルやドライブを共有にすることを試してください。
<code class="highlighter-rouge">C:\Users</code>（Windows の場合）または <code class="highlighter-rouge">/Users</code>（Mac の場合）ではないディレクトリにあるプロジェクトがある場合は、ボリュームマウントを共有ドライブにする必要があります。
これはまた、<a href="/docs.docker.jp.onthefly/docker-for-windows/#switch-between-windows-and-linux-containers">Linux コンテナー</a> を利用する Docker Desktop  for Windows のプロジェクトでも同様です。
詳しくは Docker for Mac における <a href="/docs.docker.jp.onthefly/docker-for-mac/#file-sharing">ファイル共有</a> を参照してください。
また一般的な利用例に関しては <a href="/docs.docker.jp.onthefly/storage/volumes/">コンテナーでデータ管理</a> を参照してください。</p>
    </li>
    <li>
      <p>比較的古い Windows OS 上において Oracle VirtualBox を利用している場合は、<a href="https://www.virtualbox.org/ticket/14920">VB trouble ticket</a> に示されている共有フォルダに関する問題が起こるかもしれません。
より新しい Windows システムであれば、<a href="/docs.docker.jp.onthefly/docker-for-windows/install/">Docker Desktop for Windows</a> の要件を満たすため、VirtualBox は必要としません。</p>
    </li>
  </ul>
</blockquote>

<h2 id="step-7-update-the-application">ステップ 7: アプリケーションの更新</h2>

<p>アプリケーションのコードは、ボリュームを利用してコンテナー内にマウントされたため、コードへの変更とその確認はすぐにできます。
イメージを再構築することは必要なくなりました。</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">app.py</code> 内のメッセージを変更して保存します。
たとえば <code class="highlighter-rouge">Hello World!</code> メッセージを <code class="highlighter-rouge">Hello from Docker!</code> に変更することにします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>return 'Hello from Docker! I have been seen {} times.\n'.format(count)
</code></pre></div>    </div>
  </li>
  <li>
    <p>ブラウザーにてアプリを再読み込みします。
メッセージは更新され、カウンターも加算されているはずです。</p>

    <p><img src="/docs.docker.jp.onthefly/compose/images/quick-hello-world-3.png" alt="ブラウザー上の hello world" /></p>
  </li>
</ol>

<h2 id="step-8-experiment-with-some-other-commands">ステップ 8: その他のコマンドを試す</h2>

<p>サービスをバックグラウンドで実行したい場合は <code class="highlighter-rouge">docker-compose up</code> に <code class="highlighter-rouge">-d</code> フラグ（”デタッチ”モード用のフラグ）をつけます。
<code class="highlighter-rouge">docker-compose ps</code> を実行して、現在動いているものを確認します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up -d
Starting composetest_redis_1...
Starting composetest_web_1...

$ docker-compose ps
Name                 Command            State       Ports
-------------------------------------------------------------------
composetest_redis_1   /usr/local/bin/run         Up
composetest_web_1     /bin/sh -c python app.py   Up      5000-&gt;5000/tcp
</code></pre></div></div>

<p><code class="highlighter-rouge">docker-compose run</code> コマンドを使えば、サービスに対してのコマンド実行を行うことができます。
たとえば <code class="highlighter-rouge">web</code> サービス上でどのような環境変数が利用可能であるかは、以下のコマンドを実行します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose run web env
</code></pre></div></div>

<p><code class="highlighter-rouge">docker-compose --help</code> を実行すれば、その他のコマンドを確認できます。
bash や zsh シェルにおいて <a href="/docs.docker.jp.onthefly/compose/completion/">コマンド補完</a>をインストールしている場合は、利用可能なコマンドを確認することもできます。</p>

<p><code class="highlighter-rouge">docker-compose up -d</code> により Compose を起動していた場合は、サービスを停止させるために以下のコマンドを実行します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose stop
</code></pre></div></div>

<p>コンテナーも完全に削除し、すべてを終わらせる場合には <code class="highlighter-rouge">down</code> コマンドを使います。
<code class="highlighter-rouge">--volumes</code> を指定すれば Redis コンテナーにおいて利用されているデータボリュームも削除することができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose down --volumes
</code></pre></div></div>

<p>ここまで Compose の基本動作について見てきました。</p>

<h2 id="where-to-go-next">次に読むものは</h2>

<ul>
  <li>次は <a href="/docs.docker.jp.onthefly/compose/django/">Django</a>、<a href="/docs.docker.jp.onthefly/compose/rails/">Rails</a>、<a href="/docs.docker.jp.onthefly/compose/wordpress/">WordPress</a> のクイックスタートを試してみましょう。</li>
  <li><a href="/docs.docker.jp.onthefly/compose/reference/">Compose コマンドの全一覧</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a></li>
  <li>ボリュームやバインドマウントについての詳細は、<a href="/docs.docker.jp.onthefly/storage/">Docker でのデータ管理</a> を参照してください。</li>
</ul>

                            <!-- tags -->
                            
                            <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span
                                style="vertical-align: 2px"><a
                                    href="https://docs.docker.com/search/?q=documentation">documentation</a>, <a
                                    href="https://docs.docker.com/search/?q=docs">docs</a>, <a
                                    href="https://docs.docker.com/search/?q=docker">docker</a>, <a
                                    href="https://docs.docker.com/search/?q=compose">compose</a>, <a
                                    href="https://docs.docker.com/search/?q=orchestration">orchestration</a>, <a
                                    href="https://docs.docker.com/search/?q=containers">containers</a></span>
                            
                            
                            <div id="ratings-div"
                                style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "compose/gettingstarted.md",
                                        "title": "Docker Compose をはじめよう",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/compose/gettingstarted.md"
                                    };
                                    (function (d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
    <ul class="nav jsTOCHorizontal hidden-md hidden-lg">
    </ul>
    <div class="divider hidden-md hidden-lg"></div>
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/compose/gettingstarted.md"><i
                                                    class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
                                        <li><a href="https://github.com/matsuand/docs.docker.jp/issues/new?body=ファイル: [compose/gettingstarted.md](https://matsuand.github.io/docs.docker.jp.onthefly/compose/gettingstarted/)"
                                                class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                    </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                
                                
                                
                                
                                <div id="side-toc-title">本ページ内:</div>
                                
<ul id="my_toc" class="inline_toc">
  <li><a href="#prerequisites" class="nomunge">前提条件</a></li>
  <li><a href="#step-1-setup" class="nomunge">ステップ 1: セットアップ</a></li>
  <li><a href="#step-2-create-a-dockerfile" class="nomunge">ステップ 2: Dockerfile の生成</a></li>
  <li><a href="#step-3-define-services-in-a-compose-file" class="nomunge">ステップ 3: Compose ファイル内でのサービス定義</a>
    <ul>
      <li><a href="#web-service" class="nomunge">ウェブサービス</a></li>
      <li><a href="#redis-service" class="nomunge">Redis サービス</a></li>
    </ul>
  </li>
  <li><a href="#step-4-build-and-run-your-app-with-compose" class="nomunge">ステップ 4: Compose によるアプリケーションの構築と実行</a></li>
  <li><a href="#step-5-edit-the-compose-file-to-add-a-bind-mount" class="nomunge">ステップ 5: Compose ファイルにバインドマウントを追加</a></li>
  <li><a href="#step-6-re-build-and-run-the-app-with-compose" class="nomunge">ステップ 6: Compose によるアプリの再構築と実行</a></li>
  <li><a href="#step-7-update-the-application" class="nomunge">ステップ 7: アプリケーションの更新</a></li>
  <li><a href="#step-8-experiment-with-some-other-commands" class="nomunge">ステップ 8: その他のコマンドを試す</a></li>
  <li><a href="#where-to-go-next" class="nomunge">次に読むものは</a></li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
        // Default to assuming this is an archive and hiding some stuff
        // See js/archive.js and js/docs.js for logic relating to this
        var isArchive = true;
        var dockerVersion = 'v19.03';
        // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
        var jekyllEnv = 'development';
        // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
        if (jekyllEnv === 'development') {
            jekyllEnv = '';
        }
        var pageURL = jekyllEnv + '/compose/gettingstarted/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script defer src="/js/search.js"></script>
</body>


</html>
