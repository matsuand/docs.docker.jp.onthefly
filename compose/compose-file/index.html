<!-- Page generated 2019-05-09 15:07:29 +0900 -->
<!-- relative link basehrefs -->

	


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-05-09T15:07:29+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Compose ファイル バージョン 3 リファレンス"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="リファレンスとガイドライン These topics describe version 3 of the Compose file format. This is the newest version. Compose and Docker compatibility matrix There are several versions of the Compose file format..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-05-09T15:07:29+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="fig, composition, compose, docker">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Compose ファイル バージョン 3 リファレンス | Docker Documentation</title>
<meta property="og:title" content="Compose ファイル バージョン 3 リファレンス" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Compose ファイルリファレンス" />
<meta property="og:description" content="Compose ファイルリファレンス" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Compose ファイル バージョン 3 リファレンス","description":"Compose ファイルリファレンス","url":"https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" /id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Compose ファイル バージョン 3 リファレンス</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    74 分
  
</span>

							
							
							
<h2 id="reference-and-guidelines">リファレンスとガイドライン</h2>

<p>These topics describe version 3 of the Compose file format. This is the newest
version.</p>

<h2 id="compose-and-docker-compatibility-matrix">Compose and Docker compatibility matrix</h2>

<p>There are several versions of the Compose file format – 1, 2, 2.x, and 3.x. The
table below is a quick look. For full details on what each version includes and
how to upgrade, see <strong><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/">About versions and upgrading</a></strong>.</p>

<p>This table shows which Compose file versions support specific Docker releases.</p>

<table>
  <thead>
    <tr>
      <th><strong>Compose file format</strong></th>
      <th><strong>Docker Engine release</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3.7</td>
      <td>18.06.0+</td>
    </tr>
    <tr>
      <td>3.6</td>
      <td>18.02.0+</td>
    </tr>
    <tr>
      <td>3.5</td>
      <td>17.12.0+</td>
    </tr>
    <tr>
      <td>3.4</td>
      <td>17.09.0+</td>
    </tr>
    <tr>
      <td>3.3</td>
      <td>17.06.0+</td>
    </tr>
    <tr>
      <td>3.2</td>
      <td>17.04.0+</td>
    </tr>
    <tr>
      <td>3.1</td>
      <td>1.13.1+</td>
    </tr>
    <tr>
      <td>3.0</td>
      <td>1.13.0+</td>
    </tr>
    <tr>
      <td>2.4</td>
      <td>17.12.0+</td>
    </tr>
    <tr>
      <td>2.3</td>
      <td>17.06.0+</td>
    </tr>
    <tr>
      <td>2.2</td>
      <td>1.13.0+</td>
    </tr>
    <tr>
      <td>2.1</td>
      <td>1.12.0+</td>
    </tr>
    <tr>
      <td>2.0</td>
      <td>1.10.0+</td>
    </tr>
    <tr>
      <td>1.0</td>
      <td>1.9.1.+</td>
    </tr>
  </tbody>
</table>

<p>In addition to Compose file format versions shown in the table, the Compose
itself is on a release schedule, as shown in <a href="https://github.com/docker/compose/releases/">Compose
releases</a>, but file format versions
do not necessarily increment with each release. For example, Compose file format
3.0 was first introduced in <a href="https://github.com/docker/compose/releases/tag/1.10.0">Compose release
1.10.0</a>, and versioned
gradually in subsequent releases.</p>

<h2 id="compose-file-structure-and-examples">Compose file structure and examples</h2>

<div class="panel panel-default">
  <div class="panel-heading collapsed" data-toggle="collapse" data-target="#collapseSample1" style="cursor: pointer">
Example Compose file version 3 <em class="chevron fa fa-fw"></em>
  </div>
  <div class="collapse block" id="collapseSample1">
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
version: "3.7"
services:

  redis:
    image: redis:alpine
    ports:
      - "6379"
    networks:
      - frontend
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure

  db:
    image: postgres:9.4
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend
    deploy:
      placement:
        constraints: [node.role == manager]

  vote:
    image: dockersamples/examplevotingapp_vote:before
    ports:
      - "5000:80"
    networks:
      - frontend
    depends_on:
      - redis
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
      restart_policy:
        condition: on-failure

  result:
    image: dockersamples/examplevotingapp_result:before
    ports:
      - "5001:80"
    networks:
      - backend
    depends_on:
      - db
    deploy:
      replicas: 1
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure

  worker:
    image: dockersamples/examplevotingapp_worker
    networks:
      - frontend
      - backend
    deploy:
      mode: replicated
      replicas: 1
      labels: [APP=VOTING]
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 3
        window: 120s
      placement:
        constraints: [node.role == manager]

  visualizer:
    image: dockersamples/visualizer:stable
    ports:
      - "8080:8080"
    stop_grace_period: 1m30s
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    deploy:
      placement:
        constraints: [node.role == manager]

networks:
  frontend:
  backend:

volumes:
  db-data:
</code></pre></div>    </div>
  </div>
</div>

<p>The topics on this reference page are organized alphabetically by top-level key
to reflect the structure of the Compose file itself. Top-level keys that define
a section in the configuration file such as <code class="highlighter-rouge">build</code>, <code class="highlighter-rouge">deploy</code>, <code class="highlighter-rouge">depends_on</code>,
<code class="highlighter-rouge">networks</code>, and so on, are listed with the options that support them as
sub-topics. This maps to the <code class="highlighter-rouge">&lt;key&gt;: &lt;option&gt;: &lt;value&gt;</code> indent structure of the
Compose file.</p>

<p>A good place to start is the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/index.md">Getting Started</a> tutorial
which uses version 3 Compose stack files to implement multi-container apps,
service definitions, and swarm mode. Here are some Compose files used in the
tutorial.</p>

<ul>
  <li>
    <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/part3.md#your-first-docker-composeyml-file">Your first docker-compose.yml File</a></p>
  </li>
  <li>
    <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/part5.md#add-a-new-service-and-redeploy">Add a new service and redeploy</a></p>
  </li>
</ul>

<p>Another good reference is the Compose file for the voting app sample used in the
<a href="https://github.com/docker/labs/tree/master/beginner/">Docker for Beginners lab</a>
topic on <a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md">Deploying an app to a
Swarm</a>. This is also shown on the accordion at the top of this section.</p>

<h2 id="service-configuration-reference">Service configuration reference</h2>

<p>The Compose file is a <a href="http://yaml.org/">YAML</a> file defining
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#service-configuration-reference">services</a>,
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network-configuration-reference">networks</a> and
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volume-configuration-reference">volumes</a>.
The default path for a Compose file is <code class="highlighter-rouge">./docker-compose.yml</code>.</p>

<blockquote>
  <p><strong>Tip</strong>: You can use either a <code class="highlighter-rouge">.yml</code> or <code class="highlighter-rouge">.yaml</code> extension for this file.
They both work.</p>
</blockquote>

<p>A service definition contains configuration that is applied to each
container started for that service, much like passing command-line parameters to
<code class="highlighter-rouge">docker container create</code>. Likewise, network and volume definitions are analogous to
<code class="highlighter-rouge">docker network create</code> and <code class="highlighter-rouge">docker volume create</code>.</p>

<p>As with <code class="highlighter-rouge">docker container create</code>, options specified in the Dockerfile, such as <code class="highlighter-rouge">CMD</code>,
<code class="highlighter-rouge">EXPOSE</code>, <code class="highlighter-rouge">VOLUME</code>, <code class="highlighter-rouge">ENV</code>, are respected by default - you don’t need to
specify them again in <code class="highlighter-rouge">docker-compose.yml</code>.</p>

<p>You can use environment variables in configuration values with a Bash-like
<code class="highlighter-rouge">${VARIABLE}</code> syntax - see
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#variable-substitution">variable substitution</a> for full details.</p>

<p>This section contains a list of all configuration options supported by a service
definition in version 3.</p>

<h3 id="build">build</h3>

<p>Configuration options that are applied at build time.</p>

<p><code class="highlighter-rouge">build</code> can be specified either as a string containing a path to the build
context:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">webapp</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./dir</span>
</code></pre></div></div>

<p>Or, as an object with the path specified under <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#context">context</a> and
optionally <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#dockerfile">Dockerfile</a> and <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#args">args</a>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">webapp</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./dir</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile-alternate</span>
      <span class="na">args</span><span class="pi">:</span>
        <span class="na">buildno</span><span class="pi">:</span> <span class="s">1</span>
</code></pre></div></div>

<p>If you specify <code class="highlighter-rouge">image</code> as well as <code class="highlighter-rouge">build</code>, then Compose names the built image
with the <code class="highlighter-rouge">webapp</code> and optional <code class="highlighter-rouge">tag</code> specified in <code class="highlighter-rouge">image</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span> <span class="s">./dir</span>
<span class="na">image</span><span class="pi">:</span> <span class="s">webapp:tag</span>
</code></pre></div></div>

<p>This results in an image named <code class="highlighter-rouge">webapp</code> and tagged <code class="highlighter-rouge">tag</code>, built from <code class="highlighter-rouge">./dir</code>.</p>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file. The <code class="highlighter-rouge">docker stack</code> command accepts only pre-built images.</p>
</blockquote>

<h4 id="context">context</h4>

<p>Either a path to a directory containing a Dockerfile, or a url to a git repository.</p>

<p>When the value supplied is a relative path, it is interpreted as relative to the
location of the Compose file. This directory is also the build context that is
sent to the Docker daemon.</p>

<p>Compose builds and tags it with a generated name, and uses that image
thereafter.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">./dir</span>
</code></pre></div></div>

<h4 id="dockerfile">dockerfile</h4>

<p>Alternate Dockerfile.</p>

<p>Compose uses an alternate file to build with. A build path must also be
specified.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile-alternate</span>
</code></pre></div></div>

<h4 id="args">args</h4>

<p>Add build arguments, which are environment variables accessible only during the
build process.</p>

<p>First, specify the arguments in your Dockerfile:</p>

<pre><code class="language-Dockerfile">ARG buildno
ARG gitcommithash

RUN echo "Build number: $buildno"
RUN echo "Based on commit: $gitcommithash"
</code></pre>

<p>Then specify the arguments under the <code class="highlighter-rouge">build</code> key. You can pass a mapping
or a list:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">args</span><span class="pi">:</span>
    <span class="na">buildno</span><span class="pi">:</span> <span class="s">1</span>
    <span class="na">gitcommithash</span><span class="pi">:</span> <span class="s">cdc3b19</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">args</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">buildno=1</span>
    <span class="pi">-</span> <span class="s">gitcommithash=cdc3b19</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: In your Dockerfile, if you specify <code class="highlighter-rouge">ARG</code> before the <code class="highlighter-rouge">FROM</code> instruction,
<code class="highlighter-rouge">ARG</code> is not available in the build instructions under <code class="highlighter-rouge">FROM</code>.
If you need an argument to be available in both places, also specify it under the <code class="highlighter-rouge">FROM</code> instruction.
See <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder/#understand-how-arg-and-from-interact">Understand how ARGS and FROM interact</a> for usage details.</p>
</blockquote>

<p>You can omit the value when specifying a build argument, in which case its value
at build time is the value in the environment where Compose is running.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">args</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">buildno</span>
  <span class="pi">-</span> <span class="s">gitcommithash</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: YAML boolean values (<code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, <code class="highlighter-rouge">yes</code>, <code class="highlighter-rouge">no</code>, <code class="highlighter-rouge">on</code>, <code class="highlighter-rouge">off</code>) must
be enclosed in quotes, so that the parser interprets them as strings.</p>
</blockquote>

<h4 id="cache_from">cache_from</h4>

<blockquote>
  <p><strong>Note</strong>: This option is new in v3.2</p>
</blockquote>

<p>A list of images that the engine uses for cache resolution.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">cache_from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">alpine:latest</span>
    <span class="pi">-</span> <span class="s">corp/web_app:3.14</span>
</code></pre></div></div>

<h4 id="labels">labels</h4>

<blockquote>
  <p><strong>Note</strong>: This option is new in v3.3</p>
</blockquote>

<p>Add metadata to the resulting image using <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a>.
You can use either an array or a dictionary.</p>

<p>We recommend that you use reverse-DNS notation to prevent your labels from conflicting with
those used by other software.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Accounting</span><span class="nv"> </span><span class="s">webapp"</span>
    <span class="s">com.example.department</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Finance"</span>
    <span class="s">com.example.label-with-empty-value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.description=Accounting</span><span class="nv"> </span><span class="s">webapp"</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.department=Finance"</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.label-with-empty-value"</span>
</code></pre></div></div>

<h4 id="shm_size">shm_size</h4>

<blockquote>
  <p>Added in <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-35">version 3.5</a> file format</p>
</blockquote>

<p>Set the size of the <code class="highlighter-rouge">/dev/shm</code> partition for this build’s containers. Specify
as an integer value representing the number of bytes or as a string expressing
a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-byte-values">byte value</a>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">shm_size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2gb'</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">shm_size</span><span class="pi">:</span> <span class="s">10000000</span>
</code></pre></div></div>

<h4 id="target">target</h4>

<blockquote>
  <p>Added in <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-34">version 3.4</a> file format</p>
</blockquote>

<p>Build the specified stage as defined inside the <code class="highlighter-rouge">Dockerfile</code>. See the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/eng-image/multistage-build.md">multi-stage build docs</a> for
details.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build</span><span class="pi">:</span>
  <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">target</span><span class="pi">:</span> <span class="s">prod</span>
</code></pre></div></div>

<h3 id="cap_add-cap_drop">cap_add, cap_drop</h3>

<p>Add or drop container capabilities.
See <code class="highlighter-rouge">man 7 capabilities</code> for a full list.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cap_add</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ALL</span>

<span class="na">cap_drop</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">NET_ADMIN</span>
  <span class="pi">-</span> <span class="s">SYS_ADMIN</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: These options are ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="cgroup_parent">cgroup_parent</h3>

<p>Specify an optional parent cgroup for the container.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cgroup_parent</span><span class="pi">:</span> <span class="s">m-executor-abcd</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="command">command</h3>

<p>Override the default command.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">command</span><span class="pi">:</span> <span class="s">bundle exec thin -p 3000</span>
</code></pre></div></div>

<p>The command can also be a list, in a manner similar to
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder.md#cmd">dockerfile</a>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">bundle"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">exec"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">thin"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-p"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">3000"</span><span class="pi">]</span>
</code></pre></div></div>

<h3 id="configs">configs</h3>

<p>Grant access to configs on a per-service basis using the per-service <code class="highlighter-rouge">configs</code>
configuration. Two different syntax variants are supported.</p>

<blockquote>
  <p><strong>Note</strong>: The config must already exist or be
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#configs-configuration-reference">defined in the top-level <code class="highlighter-rouge">configs</code> configuration</a>
of this stack file, or stack deployment fails.</p>
</blockquote>

<p>For more information on configs, see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/configs.md">configs</a>.</p>

<h4 id="short-syntax">Short syntax</h4>

<p>The short syntax variant only specifies the config name. This grants the
container access to the config and mounts it at <code class="highlighter-rouge">/&lt;config_name&gt;</code>
within the container. The source name and destination mountpoint are both set
to the config name.</p>

<p>The following example uses the short syntax to grant the <code class="highlighter-rouge">redis</code> service
access to the <code class="highlighter-rouge">my_config</code> and <code class="highlighter-rouge">my_other_config</code> configs. The value of
<code class="highlighter-rouge">my_config</code> is set to the contents of the file <code class="highlighter-rouge">./my_config.txt</code>, and
<code class="highlighter-rouge">my_other_config</code> is defined as an external resource, which means that it has
already been defined in Docker, either by running the <code class="highlighter-rouge">docker config create</code>
command or by another stack deployment. If the external config does not exist,
the stack deployment fails with a <code class="highlighter-rouge">config not found</code> error.</p>

<blockquote>
  <p><strong>Note</strong>: <code class="highlighter-rouge">config</code> definitions are only supported in version 3.3 and higher
 of the compose file format.</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:latest</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">1</span>
    <span class="na">configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">my_config</span>
      <span class="pi">-</span> <span class="s">my_other_config</span>
<span class="na">configs</span><span class="pi">:</span>
  <span class="na">my_config</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_config.txt</span>
  <span class="na">my_other_config</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h4 id="long-syntax">Long syntax</h4>

<p>The long syntax provides more granularity in how the config is created within
the service’s task containers.</p>

<ul>
  <li><code class="highlighter-rouge">source</code>: The name of the config as it exists in Docker.</li>
  <li><code class="highlighter-rouge">target</code>: The path and name of the file to be mounted in the service’s
task containers. Defaults to <code class="highlighter-rouge">/&lt;source&gt;</code> if not specified.</li>
  <li><code class="highlighter-rouge">uid</code> and <code class="highlighter-rouge">gid</code>: The numeric UID or GID that owns the mounted config file
within in the service’s task containers. Both default to <code class="highlighter-rouge">0</code> on Linux if not
specified. Not supported on Windows.</li>
  <li><code class="highlighter-rouge">mode</code>: The permissions for the file that is mounted within the service’s
task containers, in octal notation. For instance, <code class="highlighter-rouge">0444</code>
represents world-readable. The default is <code class="highlighter-rouge">0444</code>. Configs cannot be writable
because they are mounted in a temporary filesystem, so if you set the writable
bit, it is ignored. The executable bit can be set. If you aren’t familiar with
UNIX file permission modes, you may find this
<a href="http://permissions-calculator.org/" target="_blank" class="_">permissions calculator</a>
useful.</li>
</ul>

<p>The following example sets the name of <code class="highlighter-rouge">my_config</code> to <code class="highlighter-rouge">redis_config</code> within the
container, sets the mode to <code class="highlighter-rouge">0440</code> (group-readable) and sets the user and group
to <code class="highlighter-rouge">103</code>. The <code class="highlighter-rouge">redis</code> service does not have access to the <code class="highlighter-rouge">my_other_config</code>
config.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:latest</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">1</span>
    <span class="na">configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">my_config</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/redis_config</span>
        <span class="na">uid</span><span class="pi">:</span> <span class="s1">'</span><span class="s">103'</span>
        <span class="na">gid</span><span class="pi">:</span> <span class="s1">'</span><span class="s">103'</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">0440</span>
<span class="na">configs</span><span class="pi">:</span>
  <span class="na">my_config</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_config.txt</span>
  <span class="na">my_other_config</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>You can grant a service access to multiple configs and you can mix long and
short syntax. Defining a config does not imply granting a service access to it.</p>

<h3 id="container_name">container_name</h3>

<p>Specify a custom container name, rather than a generated default name.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">container_name</span><span class="pi">:</span> <span class="s">my-web-container</span>
</code></pre></div></div>

<p>Because Docker container names must be unique, you cannot scale a service beyond
1 container if you have specified a custom name. Attempting to do so results in
an error.</p>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="credential_spec">credential_spec</h3>

<blockquote>
  <p><strong>Note</strong>: this option was added in v3.3.</p>
</blockquote>

<p>Configure the credential spec for managed service account. This option is only
used for services using Windows containers. The <code class="highlighter-rouge">credential_spec</code> must be in the
format <code class="highlighter-rouge">file://&lt;filename&gt;</code> or <code class="highlighter-rouge">registry://&lt;value-name&gt;</code>.</p>

<p>When using <code class="highlighter-rouge">file:</code>, the referenced file must be present in the <code class="highlighter-rouge">CredentialSpecs</code>
subdirectory in the Docker data directory, which defaults to <code class="highlighter-rouge">C:\ProgramData\Docker\</code>
on Windows. The following example loads the credential spec from a file named
<code class="highlighter-rouge">C:\ProgramData\Docker\CredentialSpecs\my-credential-spec.json</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">credential_spec</span><span class="pi">:</span>
  <span class="na">file</span><span class="pi">:</span> <span class="s">my-credential-spec.json</span>
</code></pre></div></div>

<p>When using <code class="highlighter-rouge">registry:</code>, the credential spec is read from the Windows registry on
the daemon’s host. A registry value with the given name must be located in:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Virtualization\Containers\CredentialSpecs
</code></pre></div></div>

<p>The following example load the credential spec from a value named <code class="highlighter-rouge">my-credential-spec</code>
in the registry:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">credential_spec</span><span class="pi">:</span>
  <span class="na">registry</span><span class="pi">:</span> <span class="s">my-credential-spec</span>
</code></pre></div></div>

<h3 id="depends_on">depends_on</h3>

<p>Express dependency between services, Service dependencies cause the following
behaviors:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">docker-compose up</code> starts services in dependency order. In the following
example, <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code> are started before <code class="highlighter-rouge">web</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">docker-compose up SERVICE</code> automatically includes <code class="highlighter-rouge">SERVICE</code>’s
dependencies. In the following example, <code class="highlighter-rouge">docker-compose up web</code> also
creates and starts <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">docker-compose stop</code> stops services in dependency order. In the following
example, <code class="highlighter-rouge">web</code> is stopped before <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code>.</p>
  </li>
</ul>

<p>Simple example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
      <span class="pi">-</span> <span class="s">redis</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
</code></pre></div></div>

<blockquote>
  <p>There are several things to be aware of when using <code class="highlighter-rouge">depends_on</code>:</p>

  <ul>
    <li>
      <p><code class="highlighter-rouge">depends_on</code> does not wait for <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code> to be “ready” before
starting <code class="highlighter-rouge">web</code> - only until they have been started. If you need to wait
for a service to be ready, see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/startup-order.md">Controlling startup order</a>
for more on this problem and strategies for solving it.</p>
    </li>
    <li>
      <p>Version 3 no longer supports the <code class="highlighter-rouge">condition</code> form of <code class="highlighter-rouge">depends_on</code>.</p>
    </li>
    <li>
      <p>The <code class="highlighter-rouge">depends_on</code> option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a version 3 Compose file.</p>
    </li>
  </ul>
</blockquote>

<h3 id="deploy">deploy</h3>

<blockquote>
  <p><strong><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-3">Version 3</a> only.</strong></p>
</blockquote>

<p>Specify configuration related to the deployment and running of services. This
only takes effect when deploying to a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/index.md">swarm</a> with
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">docker stack deploy</a>, and is
ignored by <code class="highlighter-rouge">docker-compose up</code> and <code class="highlighter-rouge">docker-compose run</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:alpine</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">6</span>
      <span class="na">update_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="s">2</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
</code></pre></div></div>

<p>Several sub-options are available:</p>

<h4 id="endpoint_mode">endpoint_mode</h4>

<p>Specify a service discovery method for external clients connecting to a swarm.</p>

<blockquote>
  <p><strong><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-3">Version 3.3</a> only.</strong></p>
</blockquote>

<ul>
  <li>
    <p><code class="highlighter-rouge">endpoint_mode: vip</code> - Docker assigns the service a virtual IP (VIP)
that acts as the front end for clients to reach the service on a
network. Docker routes requests between the client and available worker
nodes for the service, without client knowledge of how many nodes
are participating in the service or their IP addresses or ports.
(This is the default.)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">endpoint_mode: dnsrr</code> -  DNS round-robin (DNSRR) service discovery does
not use a single virtual IP. Docker sets up DNS entries for the service
such that a DNS query for the service name returns a list of IP addresses,
and the client connects directly to one of these. DNS round-robin is useful
in cases where you want to use your own load balancer, or for Hybrid
Windows and Linux applications.</p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">wordpress</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">wordpress</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">overlay</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
      <span class="na">endpoint_mode</span><span class="pi">:</span> <span class="s">vip</span>

  <span class="na">mysql</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="na">volumes</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">db-data:/var/lib/mysql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">overlay</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
      <span class="na">endpoint_mode</span><span class="pi">:</span> <span class="s">dnsrr</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">db-data</span><span class="pi">:</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">overlay</span><span class="pi">:</span>
</code></pre></div></div>

<p>The options for <code class="highlighter-rouge">endpoint_mode</code> also work as flags on the swarm mode CLI command
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/service_create.md">docker service create</a>. For a
quick list of all swarm related <code class="highlighter-rouge">docker</code> commands, see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm.md#swarm-mode-key-concepts-and-tutorial">Swarm mode CLI
commands</a>.</p>

<p>To learn more about service discovery and networking in swarm mode, see
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/networking.md#configure-service-discovery">Configure service
discovery</a> in the swarm
mode topics.</p>

<h4 id="labels-1">labels</h4>

<p>Specify labels for the service. These labels are <em>only</em> set on the service,
and <em>not</em> on any containers for the service.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">web</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">This</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">appear</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">service"</span>
</code></pre></div></div>

<p>To set labels on containers instead, use the <code class="highlighter-rouge">labels</code> key outside of <code class="highlighter-rouge">deploy</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">web</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">This</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">appear</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">containers</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">service"</span>
</code></pre></div></div>

<h4 id="mode">mode</h4>

<p>Either <code class="highlighter-rouge">global</code> (exactly one container per swarm node) or <code class="highlighter-rouge">replicated</code> (a
specified number of containers). The default is <code class="highlighter-rouge">replicated</code>. (To learn more,
see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/how-swarm-mode-works/services/#replicated-and-global-services">Replicated and global
services</a>
in the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/">swarm</a> topics.)</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">dockersamples/examplevotingapp_worker</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">global</span>
</code></pre></div></div>

<h4 id="placement">placement</h4>

<p>Specify placement of constraints and preferences. See the docker service create documentation for a full description of the syntax and available types of <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/service_create.md#specify-service-constraints-constraint">constraints</a> and <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/service_create.md#specify-service-placement-preferences-placement-pref">preferences</a>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">placement</span><span class="pi">:</span>
        <span class="na">constraints</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">node.role == manager</span>
          <span class="pi">-</span> <span class="s">engine.labels.operatingsystem == ubuntu 14.04</span>
        <span class="na">preferences</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">spread</span><span class="pi">:</span> <span class="s">node.labels.zone</span>
</code></pre></div></div>

<h4 id="replicas">replicas</h4>

<p>If the service is <code class="highlighter-rouge">replicated</code> (which is the default), specify the number of
containers that should be running at any given time.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">dockersamples/examplevotingapp_worker</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">6</span>
</code></pre></div></div>

<h4 id="resources">resources</h4>

<p>Configures resource constraints.</p>

<blockquote>
  <p><strong>Note</strong>: This replaces the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cpu-and-other-resources">older resource constraint options</a> for non swarm mode in
Compose files prior to version 3 (<code class="highlighter-rouge">cpu_shares</code>, <code class="highlighter-rouge">cpu_quota</code>, <code class="highlighter-rouge">cpuset</code>,
<code class="highlighter-rouge">mem_limit</code>, <code class="highlighter-rouge">memswap_limit</code>, <code class="highlighter-rouge">mem_swappiness</code>), as described in <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning.md#upgrading">Upgrading
version 2.x to 3.x</a>.</p>
</blockquote>

<p>Each of these is a single value, analogous to its <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/service_create.md">docker service
create</a> counterpart.</p>

<p>In this general example, the <code class="highlighter-rouge">redis</code> service is constrained to use no more than
50M of memory and <code class="highlighter-rouge">0.50</code> (50% of a single core) of available processing time (CPU),
and has <code class="highlighter-rouge">20M</code> of memory and <code class="highlighter-rouge">0.25</code> CPU time reserved (as always available to it).</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:alpine</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.50'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">50M</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.25'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">20M</span>
</code></pre></div></div>

<p>The topics below describe available options to set resource constraints on
services or containers in a swarm.</p>

<blockquote class="important">
  <p>Looking for options to set resources on non swarm mode containers?</p>

  <p>The options described here are specific to the
<code class="highlighter-rouge">deploy</code> key and swarm mode. If you want to set resource constraints
on non swarm deployments, use
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cpu-and-other-resources">Compose file format version 2 CPU, memory, and other resource
options</a>.
If you have further questions, refer to the discussion on the GitHub
issue <a href="https://github.com/docker/compose/issues/4513" target="_blank" class="_">docker/compose/4513</a>.</p>
</blockquote>

<h5 id="out-of-memory-exceptions-oome">Out Of Memory Exceptions (OOME)</h5>

<p>If your services or containers attempt to use more memory than the system has
available, you may experience an Out Of Memory Exception (OOME) and a container,
or the Docker daemon, might be killed by the kernel OOM killer. To prevent this
from happening, ensure that your application runs on hosts with adequate memory
and see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/resource_constraints.md#understand-the-risks-of-running-out-of-memory">Understand the risks of running out of
memory</a>.</p>

<h4 id="restart_policy">restart_policy</h4>

<p>Configures if and how to restart containers when they exit. Replaces
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#orig-resources"><code class="highlighter-rouge">restart</code></a>.</p>

<ul>
  <li><code class="highlighter-rouge">condition</code>: One of <code class="highlighter-rouge">none</code>, <code class="highlighter-rouge">on-failure</code> or <code class="highlighter-rouge">any</code> (default: <code class="highlighter-rouge">any</code>).</li>
  <li><code class="highlighter-rouge">delay</code>: How long to wait between restart attempts, specified as a
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations">duration</a> (default: 0).</li>
  <li><code class="highlighter-rouge">max_attempts</code>: How many times to attempt to restart a container before giving
up (default: never give up). If the restart does not succeed within the configured
<code class="highlighter-rouge">window</code>, this attempt doesn’t count toward the configured <code class="highlighter-rouge">max_attempts</code> value.
For example, if <code class="highlighter-rouge">max_attempts</code> is set to ‘2’, and the restart fails on the first
attempt, more than two restarts may be attempted.</li>
  <li><code class="highlighter-rouge">window</code>: How long to wait before deciding if a restart has succeeded,
specified as a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations">duration</a> (default:
decide immediately).</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:alpine</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">5s</span>
        <span class="na">max_attempts</span><span class="pi">:</span> <span class="s">3</span>
        <span class="na">window</span><span class="pi">:</span> <span class="s">120s</span>
</code></pre></div></div>

<h4 id="rollback_config">rollback_config</h4>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-37">Version 3.7 file format</a> and up</p>
</blockquote>

<p>Configures how the service should be rollbacked in case of a failing
update.</p>

<ul>
  <li><code class="highlighter-rouge">parallelism</code>: The number of containers to rollback at a time. If set to 0, all containers rollback simultaneously.</li>
  <li><code class="highlighter-rouge">delay</code>: The time to wait between each container group’s rollback (default 0s).</li>
  <li><code class="highlighter-rouge">failure_action</code>: What to do if a rollback fails. One of <code class="highlighter-rouge">continue</code> or <code class="highlighter-rouge">pause</code> (default <code class="highlighter-rouge">pause</code>)</li>
  <li><code class="highlighter-rouge">monitor</code>: Duration after each task update to monitor for failure <code class="highlighter-rouge">(ns|us|ms|s|m|h)</code> (default 0s).</li>
  <li><code class="highlighter-rouge">max_failure_ratio</code>: Failure rate to tolerate during a rollback (default 0).</li>
  <li><code class="highlighter-rouge">order</code>: Order of operations during rollbacks. One of <code class="highlighter-rouge">stop-first</code> (old task is stopped before starting new one), or <code class="highlighter-rouge">start-first</code> (new task is started first, and the running tasks briefly overlap) (default <code class="highlighter-rouge">stop-first</code>).</li>
</ul>

<h4 id="update_config">update_config</h4>

<p>Configures how the service should be updated. Useful for configuring rolling
updates.</p>

<ul>
  <li><code class="highlighter-rouge">parallelism</code>: The number of containers to update at a time.</li>
  <li><code class="highlighter-rouge">delay</code>: The time to wait between updating a group of containers.</li>
  <li><code class="highlighter-rouge">failure_action</code>: What to do if an update fails. One of <code class="highlighter-rouge">continue</code>, <code class="highlighter-rouge">rollback</code>, or <code class="highlighter-rouge">pause</code>
(default: <code class="highlighter-rouge">pause</code>).</li>
  <li><code class="highlighter-rouge">monitor</code>: Duration after each task update to monitor for failure <code class="highlighter-rouge">(ns|us|ms|s|m|h)</code> (default 0s).</li>
  <li><code class="highlighter-rouge">max_failure_ratio</code>: Failure rate to tolerate during an update.</li>
  <li><code class="highlighter-rouge">order</code>: Order of operations during updates. One of <code class="highlighter-rouge">stop-first</code> (old task is stopped before starting new one), or <code class="highlighter-rouge">start-first</code> (new task is started first, and the running tasks briefly overlap) (default <code class="highlighter-rouge">stop-first</code>) <strong>Note</strong>: Only supported for v3.4 and higher.</li>
</ul>

<blockquote>
  <p><strong>Note</strong>: <code class="highlighter-rouge">order</code> is only supported for v3.4 and higher of the compose
file format.</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">vote</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">dockersamples/examplevotingapp_vote:before</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
      <span class="na">update_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="s">2</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
        <span class="na">order</span><span class="pi">:</span> <span class="s">stop-first</span>
</code></pre></div></div>

<h4 id="not-supported-for-docker-stack-deploy">Not supported for <code class="highlighter-rouge">docker stack deploy</code></h4>

<p>The following sub-options (supported for <code class="highlighter-rouge">docker-compose up</code> and <code class="highlighter-rouge">docker-compose run</code>) are <em>not supported</em> for <code class="highlighter-rouge">docker stack deploy</code> or the <code class="highlighter-rouge">deploy</code> key.</p>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#build">build</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#cgroup_parent">cgroup_parent</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#container_name">container_name</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#devices">devices</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#tmpfs">tmpfs</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#external_links">external_links</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#links">links</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network_mode">network_mode</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#restart">restart</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#security_opt">security_opt</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#sysctls">sysctls</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#userns_mode">userns_mode</a></li>
</ul>

<blockquote>
  <p><strong>Tip:</strong> See the section on <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volumes-for-services-swarms-and-stack-files">how to configure volumes
for services, swarms, and docker-stack.yml
files</a>. Volumes <em>are</em> supported
but to work with swarms and services, they must be configured
as named volumes or associated with services that are constrained to nodes with
access to the requisite volumes.</p>
</blockquote>

<h3 id="devices">devices</h3>

<p>List of device mappings.  Uses the same format as the <code class="highlighter-rouge">--device</code> docker
client create option.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">devices</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">/dev/ttyUSB0:/dev/ttyUSB0"</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="depends_on-1">depends_on</h3>

<p>Express dependency between services, Service dependencies cause the following
behaviors:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">docker-compose up</code> starts services in dependency order. In the following
example, <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code> are started before <code class="highlighter-rouge">web</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">docker-compose up SERVICE</code> automatically includes <code class="highlighter-rouge">SERVICE</code>’s
dependencies. In the following example, <code class="highlighter-rouge">docker-compose up web</code> also
creates and starts <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">docker-compose stop</code> stops services in dependency order. In the following
example, <code class="highlighter-rouge">web</code> is stopped before <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code>.</p>
  </li>
</ul>

<p>Simple example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
      <span class="pi">-</span> <span class="s">redis</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
</code></pre></div></div>

<blockquote>
  <p>There are several things to be aware of when using <code class="highlighter-rouge">depends_on</code>:</p>

  <ul>
    <li>
      <p><code class="highlighter-rouge">depends_on</code> does not wait for <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code> to be “ready” before
starting <code class="highlighter-rouge">web</code> - only until they have been started. If you need to wait
for a service to be ready, see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/startup-order.md">Controlling startup order</a>
for more on this problem and strategies for solving it.</p>
    </li>
    <li>
      <p>Version 3 no longer supports the <code class="highlighter-rouge">condition</code> form of <code class="highlighter-rouge">depends_on</code>.</p>
    </li>
    <li>
      <p>The <code class="highlighter-rouge">depends_on</code> option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a version 3 Compose file.</p>
    </li>
  </ul>
</blockquote>

<h3 id="dns">dns</h3>

<p>Custom DNS servers. Can be a single value or a list.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dns</span><span class="pi">:</span> <span class="s">8.8.8.8</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dns</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">8.8.8.8</span>
  <span class="pi">-</span> <span class="s">9.9.9.9</span>
</code></pre></div></div>

<h3 id="dns_search">dns_search</h3>

<p>Custom DNS search domains. Can be a single value or a list.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dns_search</span><span class="pi">:</span> <span class="s">example.com</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dns_search</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">dc1.example.com</span>
  <span class="pi">-</span> <span class="s">dc2.example.com</span>
</code></pre></div></div>

<h3 id="entrypoint">entrypoint</h3>

<p>Override the default entrypoint.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">entrypoint</span><span class="pi">:</span> <span class="s">/code/entrypoint.sh</span>
</code></pre></div></div>

<p>The entrypoint can also be a list, in a manner similar to
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder.md#entrypoint">dockerfile</a>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">entrypoint</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">php</span>
    <span class="pi">-</span> <span class="s">-d</span>
    <span class="pi">-</span> <span class="s">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</span>
    <span class="pi">-</span> <span class="s">-d</span>
    <span class="pi">-</span> <span class="s">memory_limit=-1</span>
    <span class="pi">-</span> <span class="s">vendor/bin/phpunit</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Setting <code class="highlighter-rouge">entrypoint</code> both overrides any default entrypoint set
on the service’s image with the <code class="highlighter-rouge">ENTRYPOINT</code> Dockerfile instruction, <em>and</em>
clears out any default command on the image - meaning that if there’s a <code class="highlighter-rouge">CMD</code>
instruction in the Dockerfile, it is ignored.</p>
</blockquote>

<h3 id="env_file">env_file</h3>

<p>Add environment variables from a file. Can be a single value or a list.</p>

<p>If you have specified a Compose file with <code class="highlighter-rouge">docker-compose -f FILE</code>, paths in
<code class="highlighter-rouge">env_file</code> are relative to the directory that file is in.</p>

<p>Environment variables declared in the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#environment">environment</a> section
<em>override</em> these values – this holds true even if those values are
empty or undefined.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">env_file</span><span class="pi">:</span> <span class="s">.env</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">env_file</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">./common.env</span>
  <span class="pi">-</span> <span class="s">./apps/web.env</span>
  <span class="pi">-</span> <span class="s">/opt/secrets.env</span>
</code></pre></div></div>

<p>Compose expects each line in an env file to be in <code class="highlighter-rouge">VAR=VAL</code> format. Lines
beginning with <code class="highlighter-rouge">#</code> are treated as comments and are ignored. Blank lines are
also ignored.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set Rails/Rack environment</span>
<span class="nv">RACK_ENV</span><span class="o">=</span>development
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: If your service specifies a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#build">build</a> option, variables
defined in environment files are <em>not</em> automatically visible during the
build. Use the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#args">args</a> sub-option of <code class="highlighter-rouge">build</code> to define build-time
environment variables.</p>
</blockquote>

<p>The value of <code class="highlighter-rouge">VAL</code> is used as is and not modified at all. For example if the
value is surrounded by quotes (as is often the case of shell variables), the
quotes are included in the value passed to Compose.</p>

<p>Keep in mind that <em>the order of files in the list is significant in determining
the value assigned to a variable that shows up more than once</em>. The files in the
list are processed from the top down. For the same variable specified in file
<code class="highlighter-rouge">a.env</code> and assigned a different value in file <code class="highlighter-rouge">b.env</code>, if <code class="highlighter-rouge">b.env</code> is
listed below (after), then the value from <code class="highlighter-rouge">b.env</code> stands. For example, given the
following declaration in <code class="highlighter-rouge">docker-compose.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">some-service</span><span class="pi">:</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">a.env</span>
      <span class="pi">-</span> <span class="s">b.env</span>
</code></pre></div></div>

<p>And the following files:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># a.env</span>
<span class="nv">VAR</span><span class="o">=</span>1
</code></pre></div></div>

<p>and</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># b.env</span>
<span class="nv">VAR</span><span class="o">=</span>hello
</code></pre></div></div>

<p><code class="highlighter-rouge">$VAR</code> is <code class="highlighter-rouge">hello</code>.</p>

<h3 id="environment">environment</h3>

<p>Add environment variables. You can use either an array or a dictionary. Any
boolean values; true, false, yes no, need to be enclosed in quotes to ensure
they are not converted to True or False by the YML parser.</p>

<p>Environment variables with only a key are resolved to their values on the
machine Compose is running on, which can be helpful for secret or host-specific values.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">environment</span><span class="pi">:</span>
  <span class="na">RACK_ENV</span><span class="pi">:</span> <span class="s">development</span>
  <span class="na">SHOW</span><span class="pi">:</span> <span class="s1">'</span><span class="s">true'</span>
  <span class="na">SESSION_SECRET</span><span class="pi">:</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">environment</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">RACK_ENV=development</span>
  <span class="pi">-</span> <span class="s">SHOW=true</span>
  <span class="pi">-</span> <span class="s">SESSION_SECRET</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: If your service specifies a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#build">build</a> option, variables
defined in <code class="highlighter-rouge">environment</code> are <em>not</em> automatically visible during the
build. Use the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#args">args</a> sub-option of <code class="highlighter-rouge">build</code> to define build-time
environment variables.</p>
</blockquote>

<h3 id="expose">expose</h3>

<p>Expose ports without publishing them to the host machine - they’ll only be
accessible to linked services. Only the internal port can be specified.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">expose</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">3000"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">8000"</span>
</code></pre></div></div>

<h3 id="external_links">external_links</h3>

<p>Link to containers started outside this <code class="highlighter-rouge">docker-compose.yml</code> or even outside of
Compose, especially for containers that provide shared or common services.
<code class="highlighter-rouge">external_links</code> follow semantics similar to the legacy option <code class="highlighter-rouge">links</code> when
specifying both the container name and the link alias (<code class="highlighter-rouge">CONTAINER:ALIAS</code>).</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">external_links</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="s">redis_1</span>
 <span class="pi">-</span> <span class="s">project_db_1:mysql</span>
 <span class="pi">-</span> <span class="s">project_db_1:postgresql</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Notes:</strong></p>

  <p>If you’re using the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">version 2 or above file format</a>, the externally-created  containers
must be connected to at least one of the same networks as the service that is
linking to them. <a href="compose-file-v2#links">Links</a> are a
legacy option. We recommend using <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#networks">networks</a> instead.</p>

  <p>This option is ignored when <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="extra_hosts">extra_hosts</h3>

<p>Add hostname mappings. Use the same values as the docker client <code class="highlighter-rouge">--add-host</code> parameter.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">extra_hosts</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">somehost:162.242.195.82"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">otherhost:50.31.209.229"</span>
</code></pre></div></div>

<p>An entry with the ip address and hostname is created in <code class="highlighter-rouge">/etc/hosts</code> inside containers for this service, e.g:</p>

<pre><code class="language-none">162.242.195.82  somehost
50.31.209.229   otherhost
</code></pre>

<h3 id="healthcheck">healthcheck</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">Version 2.1 file format</a> and up.</p>
</blockquote>

<p>Configure a check that’s run to determine whether or not containers for this
service are “healthy”. See the docs for the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder.md#healthcheck">HEALTHCHECK Dockerfile instruction</a>
for details on how healthchecks work.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">healthcheck</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost"</span><span class="pi">]</span>
  <span class="na">interval</span><span class="pi">:</span> <span class="s">1m30s</span>
  <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
  <span class="na">retries</span><span class="pi">:</span> <span class="s">3</span>
  <span class="na">start_period</span><span class="pi">:</span> <span class="s">40s</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">interval</code>, <code class="highlighter-rouge">timeout</code> and <code class="highlighter-rouge">start_period</code> are specified as <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations">durations</a>.</p>

<blockquote>
  <p><strong>Note</strong>: <code class="highlighter-rouge">start_period</code> is only supported for v3.4 and higher of the compose
file format.</p>
</blockquote>

<p><code class="highlighter-rouge">test</code> must be either a string or a list. If it’s a list, the first item must be
either <code class="highlighter-rouge">NONE</code>, <code class="highlighter-rouge">CMD</code> or <code class="highlighter-rouge">CMD-SHELL</code>. If it’s a string, it’s equivalent to
specifying <code class="highlighter-rouge">CMD-SHELL</code> followed by that string.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Hit the local web app</span>
<span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost"</span><span class="pi">]</span>
</code></pre></div></div>

<p>As above, but wrapped in <code class="highlighter-rouge">/bin/sh</code>. Both forms below are equivalent.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">http://localhost</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">1"</span><span class="pi">]</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">test</span><span class="pi">:</span> <span class="s">curl -f https://localhost || exit 1</span>
</code></pre></div></div>

<p>To disable any default healthcheck set by the image, you can use <code class="highlighter-rouge">disable:
true</code>. This is equivalent to specifying <code class="highlighter-rouge">test: ["NONE"]</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">healthcheck</span><span class="pi">:</span>
  <span class="na">disable</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h3 id="image">image</h3>

<p>Specify the image to start the container from. Can either be a repository/tag or
a partial image ID.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>image: redis
image: ubuntu:14.04
image: tutum/influxdb
image: example-registry.com:4000/postgresql
image: a4bc65fd
</code></pre></div></div>

<p>If the image does not exist, Compose attempts to pull it, unless you have also
specified <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#build">build</a>, in which case it builds it using the specified
options and tags it with the specified tag.</p>

<h3 id="init">init</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-37">Added in version 3.7 file format</a>.</p>
</blockquote>

<p>Run an init inside the container that forwards signals and reaps processes.
Set this option to <code class="highlighter-rouge">true</code> to enable this feature for the service.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">alpine:latest</span>
    <span class="na">init</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<blockquote>
  <p>The default init binary that is used is <a href="https://github.com/krallin/tini">Tini</a>,
and is installed in <code class="highlighter-rouge">/usr/libexec/docker-init</code> on the daemon host. You can
configure the daemon to use a custom init binary through the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/dockerd/#daemon-configuration-file"><code class="highlighter-rouge">init-path</code> configuration option</a>.</p>
</blockquote>

<h3 id="isolation">isolation</h3>

<p>Specify a container’s isolation technology. On Linux, the only supported value
is <code class="highlighter-rouge">default</code>. On Windows, acceptable values are <code class="highlighter-rouge">default</code>, <code class="highlighter-rouge">process</code> and
<code class="highlighter-rouge">hyperv</code>. Refer to the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/run.md#specify-isolation-technology-for-container---isolation">Docker Engine docs</a>
for details.</p>

<h3 id="labels-2">labels</h3>

<p>Add metadata to containers using <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a>. You can use either an array or a dictionary.</p>

<p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">labels</span><span class="pi">:</span>
  <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Accounting</span><span class="nv"> </span><span class="s">webapp"</span>
  <span class="s">com.example.department</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Finance"</span>
  <span class="s">com.example.label-with-empty-value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">labels</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.description=Accounting</span><span class="nv"> </span><span class="s">webapp"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.department=Finance"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.label-with-empty-value"</span>
</code></pre></div></div>

<h3 id="links">links</h3>

<blockquote class="warning">
  <p><strong>Warning</strong>: The <code class="highlighter-rouge">--link</code> flag is a legacy feature of Docker. It
may eventually be removed. Unless you absolutely need to continue using it, we
recommend that you use <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/networking//#user-defined-networks">user-defined networks</a>
to facilitate communication between two containers instead of using <code class="highlighter-rouge">--link</code>.
One feature that user-defined networks do not support that you can do with
<code class="highlighter-rouge">--link</code> is sharing environmental variables between containers. However, you can
use other mechanisms such as volumes to share environment variables between
containers in a more controlled way.</p>
</blockquote>

<p>Link to containers in another service. Either specify both the service name and
a link alias (<code class="highlighter-rouge">SERVICE:ALIAS</code>), or just the service name.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">web</span><span class="pi">:</span>
  <span class="na">links</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">db</span>
   <span class="pi">-</span> <span class="s">db:database</span>
   <span class="pi">-</span> <span class="s">redis</span>
</code></pre></div></div>

<p>Containers for the linked service are reachable at a hostname identical to
the alias, or the service name if no alias was specified.</p>

<p>Links are not required to enable services to communicate - by default,
any service can reach any other service at that service’s name. (See also, the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/networking.md#links">Links topic in Networking in Compose</a>.)</p>

<p>Links also express dependency between services in the same way as
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#depends_on">depends_on</a>, so they determine the order of service startup.</p>

<blockquote>
  <p><strong>Notes</strong></p>

  <ul>
    <li>
      <p>If you define both links and <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#networks">networks</a>, services with
links between them must share at least one network in common to
communicate.</p>
    </li>
    <li>
      <p>This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
    </li>
  </ul>
</blockquote>

<h3 id="logging">logging</h3>

<p>Logging configuration for the service.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">syslog</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">syslog-address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tcp://192.168.0.42:123"</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">driver</code>  name specifies a logging driver for the service’s
containers, as with the <code class="highlighter-rouge">--log-driver</code> option for docker run
(<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/logging/overview.md">documented here</a>).</p>

<p>The default value is json-file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>driver: "json-file"
driver: "syslog"
driver: "none"
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Only the <code class="highlighter-rouge">json-file</code> and <code class="highlighter-rouge">journald</code> drivers make the logs
available directly from <code class="highlighter-rouge">docker-compose up</code> and <code class="highlighter-rouge">docker-compose logs</code>.
Using any other driver does not print any logs.</p>
</blockquote>

<p>Specify logging options for the logging driver with the <code class="highlighter-rouge">options</code> key, as with the <code class="highlighter-rouge">--log-opt</code> option for <code class="highlighter-rouge">docker run</code>.</p>

<p>Logging options are key-value pairs. An example of <code class="highlighter-rouge">syslog</code> options:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">syslog"</span>
<span class="na">options</span><span class="pi">:</span>
  <span class="na">syslog-address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tcp://192.168.0.42:123"</span>
</code></pre></div></div>

<p>The default driver <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/logging/overview.md#json-file">json-file</a>, has options to limit the amount of logs stored. To do this, use a key-value pair for maximum storage size and maximum number of files:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">options</span><span class="pi">:</span>
  <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200k"</span>
  <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10"</span>
</code></pre></div></div>

<p>The example shown above would store log files until they reach a <code class="highlighter-rouge">max-size</code> of
200kB, and then rotate them. The amount of individual log files stored is
specified by the <code class="highlighter-rouge">max-file</code> value. As logs grow beyond the max limits, older log
files are removed to allow storage of new logs.</p>

<p>Here is an example <code class="highlighter-rouge">docker-compose.yml</code> file that limits logging storage:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">some-service</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">some-service</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">json-file"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200k"</span>
        <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10"</span>
</code></pre></div></div>

<blockquote>
  <p>Logging options available depend on which logging driver you use</p>

  <p>The above example for controlling log files and sizes uses options
specific to the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/logging/overview.md#json-file">json-file driver</a>.
These particular options are not available on other logging drivers.
For a full list of supported logging drivers and their options, see
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/logging/overview.md">logging drivers</a>.</p>
</blockquote>

<h3 id="network_mode">network_mode</h3>

<p>Network mode. Use the same values as the docker client <code class="highlighter-rouge">--network</code> parameter, plus
the special form <code class="highlighter-rouge">service:[service name]</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>network_mode: "bridge"
network_mode: "host"
network_mode: "none"
network_mode: "service:[service name]"
network_mode: "container:[container name/id]"
</code></pre></div></div>

<blockquote>
  <p><strong>Notes</strong></p>

  <ul>
    <li>
      <p>This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm
 mode</a> with a (version 3) Compose
 file.</p>
    </li>
    <li>
      <p><code class="highlighter-rouge">network_mode: "host"</code> cannot be mixed with <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#links">links</a>.</p>
    </li>
  </ul>
</blockquote>

<h3 id="networks">networks</h3>

<p>Networks to join, referencing entries under the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network-configuration-reference">top-level <code class="highlighter-rouge">networks</code> key</a>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">some-service</span><span class="pi">:</span>
    <span class="na">networks</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">some-network</span>
     <span class="pi">-</span> <span class="s">other-network</span>
</code></pre></div></div>

<h4 id="aliases">aliases</h4>

<p>Aliases (alternative hostnames) for this service on the network. Other containers on the same network can use either the service name or this alias to connect to one of the service’s containers.</p>

<p>Since <code class="highlighter-rouge">aliases</code> is network-scoped, the same service can have different aliases on different networks.</p>

<blockquote>
  <p><strong>Note</strong>: A network-wide alias can be shared by multiple containers, and even by multiple services. If it is, then exactly which container the name resolves to is not guaranteed.</p>
</blockquote>

<p>The general format is shown here.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">some-service</span><span class="pi">:</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">some-network</span><span class="pi">:</span>
        <span class="na">aliases</span><span class="pi">:</span>
         <span class="pi">-</span> <span class="s">alias1</span>
         <span class="pi">-</span> <span class="s">alias3</span>
      <span class="na">other-network</span><span class="pi">:</span>
        <span class="na">aliases</span><span class="pi">:</span>
         <span class="pi">-</span> <span class="s">alias2</span>
</code></pre></div></div>

<p>In the example below, three services are provided (<code class="highlighter-rouge">web</code>, <code class="highlighter-rouge">worker</code>, and <code class="highlighter-rouge">db</code>),
along with two networks (<code class="highlighter-rouge">new</code> and <code class="highlighter-rouge">legacy</code>). The <code class="highlighter-rouge">db</code> service is reachable at
the hostname <code class="highlighter-rouge">db</code> or <code class="highlighter-rouge">database</code> on the <code class="highlighter-rouge">new</code> network, and at <code class="highlighter-rouge">db</code> or <code class="highlighter-rouge">mysql</code> on
the <code class="highlighter-rouge">legacy</code> network.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx:alpine"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">new</span>

  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my-worker-image:latest"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">legacy</span>

  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">new</span><span class="pi">:</span>
        <span class="na">aliases</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">database</span>
      <span class="na">legacy</span><span class="pi">:</span>
        <span class="na">aliases</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">mysql</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">new</span><span class="pi">:</span>
  <span class="na">legacy</span><span class="pi">:</span>
</code></pre></div></div>

<h4 id="ipv4_address-ipv6_address">ipv4_address, ipv6_address</h4>

<p>Specify a static IP address for containers for this service when joining the network.</p>

<p>The corresponding network configuration in the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network-configuration-reference">top-level networks section</a> must have an
<code class="highlighter-rouge">ipam</code> block with subnet configurations covering each static address.</p>

<blockquote>
  <p>If IPv6 addressing is desired, the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/##enable_ipv6"><code class="highlighter-rouge">enable_ipv6</code></a>
option must be set, and you must use a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#ipv4_address-ipv6_address">version 2.x Compose file</a>.
<em>IPv6 options do not currently work in swarm mode</em>.</p>
</blockquote>

<p>An example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">app_net</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">172.16.238.10</span>
        <span class="na">ipv6_address</span><span class="pi">:</span> <span class="s">2001:3984:3989::10</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app_net</span><span class="pi">:</span>
    <span class="na">ipam</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s">default</span>
      <span class="na">config</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">subnet</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.16.238.0/24"</span>
        <span class="pi">-</span> <span class="na">subnet</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2001:3984:3989::/64"</span>
</code></pre></div></div>

<h3 id="pid">pid</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pid: "host"
</code></pre></div></div>

<p>Sets the PID mode to the host PID mode.  This turns on sharing between
container and the host operating system the PID address space.  Containers
launched with this flag can access and manipulate other
containers in the bare-metal machine’s namespace and vice versa.</p>

<h3 id="ports">ports</h3>

<p>Expose ports.</p>

<blockquote>
  <p><strong>Note</strong>: Port mapping is incompatible with <code class="highlighter-rouge">network_mode: host</code></p>
</blockquote>

<h4 id="short-syntax-1">Short syntax</h4>

<p>Either specify both ports (<code class="highlighter-rouge">HOST:CONTAINER</code>), or just the container
port (an ephemeral host port is chosen).</p>

<blockquote>
  <p><strong>Note</strong>: When mapping ports in the <code class="highlighter-rouge">HOST:CONTAINER</code> format, you may experience
erroneous results when using a container port lower than 60, because YAML
parses numbers in the format <code class="highlighter-rouge">xx:yy</code> as a base-60 value. For this reason,
we recommend always explicitly specifying your port mappings as strings.</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ports</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">3000"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">3000-3005"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">8000:8000"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">9090-9091:8080-8081"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">49100:22"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">127.0.0.1:8001:8001"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">127.0.0.1:5000-5010:5000-5010"</span>
 <span class="pi">-</span> <span class="s2">"</span><span class="s">6060:6060/udp"</span>
</code></pre></div></div>

<h4 id="long-syntax-1">Long syntax</h4>

<p>The long form syntax allows the configuration of additional fields that can’t be
expressed in the short form.</p>

<ul>
  <li><code class="highlighter-rouge">target</code>: the port inside the container</li>
  <li><code class="highlighter-rouge">published</code>: the publicly exposed port</li>
  <li><code class="highlighter-rouge">protocol</code>: the port protocol (<code class="highlighter-rouge">tcp</code> or <code class="highlighter-rouge">udp</code>)</li>
  <li><code class="highlighter-rouge">mode</code>: <code class="highlighter-rouge">host</code> for publishing a host port on each node, or <code class="highlighter-rouge">ingress</code> for a swarm
 mode port to be load balanced.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">target</span><span class="pi">:</span> <span class="s">80</span>
    <span class="na">published</span><span class="pi">:</span> <span class="s">8080</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">tcp</span>
    <span class="na">mode</span><span class="pi">:</span> <span class="s">host</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: The long syntax is new in v3.2</p>
</blockquote>

<h3 id="restart">restart</h3>

<p><code class="highlighter-rouge">no</code> is the default restart policy, and it does not restart a container under
any circumstance. When <code class="highlighter-rouge">always</code> is specified, the container always restarts. The
<code class="highlighter-rouge">on-failure</code> policy restarts a container if the exit code indicates an
on-failure error.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>restart: "no"
restart: always
restart: on-failure
restart: unless-stopped
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file. Use <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#restart_policy">restart_policy</a> instead.</p>
</blockquote>

<h3 id="secrets">secrets</h3>

<p>Grant access to secrets on a per-service basis using the per-service <code class="highlighter-rouge">secrets</code>
configuration. Two different syntax variants are supported.</p>

<blockquote>
  <p><strong>Note</strong>: The secret must already exist or be
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#secrets-configuration-reference">defined in the top-level <code class="highlighter-rouge">secrets</code> configuration</a>
of this stack file, or stack deployment fails.</p>
</blockquote>

<p>For more information on secrets, see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/secrets.md">secrets</a>.</p>

<h4 id="short-syntax-2">Short syntax</h4>

<p>The short syntax variant only specifies the secret name. This grants the
container access to the secret and mounts it at <code class="highlighter-rouge">/run/secrets/&lt;secret_name&gt;</code>
within the container. The source name and destination mountpoint are both set
to the secret name.</p>

<p>The following example uses the short syntax to grant the <code class="highlighter-rouge">redis</code> service
access to the <code class="highlighter-rouge">my_secret</code> and <code class="highlighter-rouge">my_other_secret</code> secrets. The value of
<code class="highlighter-rouge">my_secret</code> is set to the contents of the file <code class="highlighter-rouge">./my_secret.txt</code>, and
<code class="highlighter-rouge">my_other_secret</code> is defined as an external resource, which means that it has
already been defined in Docker, either by running the <code class="highlighter-rouge">docker secret create</code>
command or by another stack deployment. If the external secret does not exist,
the stack deployment fails with a <code class="highlighter-rouge">secret not found</code> error.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:latest</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">1</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">my_secret</span>
      <span class="pi">-</span> <span class="s">my_other_secret</span>
<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">my_secret</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_secret.txt</span>
  <span class="na">my_other_secret</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h4 id="long-syntax-2">Long syntax</h4>

<p>The long syntax provides more granularity in how the secret is created within
the service’s task containers.</p>

<ul>
  <li><code class="highlighter-rouge">source</code>: The name of the secret as it exists in Docker.</li>
  <li><code class="highlighter-rouge">target</code>: The name of the file to be mounted in <code class="highlighter-rouge">/run/secrets/</code> in the
service’s task containers. Defaults to <code class="highlighter-rouge">source</code> if not specified.</li>
  <li><code class="highlighter-rouge">uid</code> and <code class="highlighter-rouge">gid</code>: The numeric UID or GID that owns the file within
<code class="highlighter-rouge">/run/secrets/</code> in the service’s task containers. Both default to <code class="highlighter-rouge">0</code> if not
specified.</li>
  <li><code class="highlighter-rouge">mode</code>: The permissions for the file to be mounted in <code class="highlighter-rouge">/run/secrets/</code>
in the service’s task containers, in octal notation. For instance, <code class="highlighter-rouge">0444</code>
represents world-readable. The default in Docker 1.13.1 is <code class="highlighter-rouge">0000</code>, but is
be <code class="highlighter-rouge">0444</code> in newer versions. Secrets cannot be writable because they are mounted
in a temporary filesystem, so if you set the writable bit, it is ignored. The
executable bit can be set. If you aren’t familiar with UNIX file permission
modes, you may find this
<a href="http://permissions-calculator.org/" target="_blank" class="_">permissions calculator</a>
useful.</li>
</ul>

<p>The following example sets name of the <code class="highlighter-rouge">my_secret</code> to <code class="highlighter-rouge">redis_secret</code> within the
container, sets the mode to <code class="highlighter-rouge">0440</code> (group-readable) and sets the user and group
to <code class="highlighter-rouge">103</code>. The <code class="highlighter-rouge">redis</code> service does not have access to the <code class="highlighter-rouge">my_other_secret</code>
secret.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:latest</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">1</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">my_secret</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">redis_secret</span>
        <span class="na">uid</span><span class="pi">:</span> <span class="s1">'</span><span class="s">103'</span>
        <span class="na">gid</span><span class="pi">:</span> <span class="s1">'</span><span class="s">103'</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">0440</span>
<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">my_secret</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_secret.txt</span>
  <span class="na">my_other_secret</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>You can grant a service access to multiple secrets and you can mix long and
short syntax. Defining a secret does not imply granting a service access to it.</p>

<h3 id="security_opt">security_opt</h3>

<p>Override the default labeling scheme for each container.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">security_opt</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">label:user:USER</span>
  <span class="pi">-</span> <span class="s">label:role:ROLE</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="stop_grace_period">stop_grace_period</h3>

<p>Specify how long to wait when attempting to stop a container if it doesn’t
handle SIGTERM (or whatever stop signal has been specified with
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#stopsignal"><code class="highlighter-rouge">stop_signal</code></a>), before sending SIGKILL. Specified
as a <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations">duration</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stop_grace_period: 1s
stop_grace_period: 1m30s
</code></pre></div></div>

<p>By default, <code class="highlighter-rouge">stop</code> waits 10 seconds for the container to exit before sending
SIGKILL.</p>

<h3 id="stop_signal">stop_signal</h3>

<p>Sets an alternative signal to stop the container. By default <code class="highlighter-rouge">stop</code> uses
SIGTERM. Setting an alternative signal using <code class="highlighter-rouge">stop_signal</code> causes
<code class="highlighter-rouge">stop</code> to send that signal instead.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stop_signal</span><span class="pi">:</span> <span class="s">SIGUSR1</span>
</code></pre></div></div>

<h3 id="sysctls">sysctls</h3>

<p>Kernel parameters to set in the container. You can use either an array or a
dictionary.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sysctls</span><span class="pi">:</span>
  <span class="s">net.core.somaxconn</span><span class="pi">:</span> <span class="s">1024</span>
  <span class="s">net.ipv4.tcp_syncookies</span><span class="pi">:</span> <span class="s">0</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sysctls</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">net.core.somaxconn=1024</span>
  <span class="pi">-</span> <span class="s">net.ipv4.tcp_syncookies=0</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="tmpfs">tmpfs</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">Version 2 file format</a> and up.</p>
</blockquote>

<p>Mount a temporary file system inside the container. Can be a single value or a list.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tmpfs</span><span class="pi">:</span> <span class="s">/run</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tmpfs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">/run</span>
  <span class="pi">-</span> <span class="s">/tmp</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3-3.5) Compose file.</p>
</blockquote>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-3">Version 3.6 file format</a> and up.</p>
</blockquote>

<p>Mount a temporary file system inside the container. Size parameter specifies the size
of the tmpfs mount in bytes. Unlimited by default.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">tmpfs</span>
     <span class="s">target</span><span class="pi">:</span> <span class="s">/app</span>
     <span class="s">tmpfs</span><span class="pi">:</span>
       <span class="na">size</span><span class="pi">:</span> <span class="s">1000</span>
</code></pre></div></div>

<h3 id="ulimits">ulimits</h3>

<p>Override the default ulimits for a container. You can either specify a single
limit as an integer or soft/hard limits as a mapping.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ulimits</span><span class="pi">:</span>
  <span class="na">nproc</span><span class="pi">:</span> <span class="s">65535</span>
  <span class="na">nofile</span><span class="pi">:</span>
    <span class="na">soft</span><span class="pi">:</span> <span class="s">20000</span>
    <span class="na">hard</span><span class="pi">:</span> <span class="s">40000</span>
</code></pre></div></div>

<h3 id="userns_mode">userns_mode</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">userns_mode</span><span class="pi">:</span> <span class="s2">"</span><span class="s">host"</span>
</code></pre></div></div>

<p>Disables the user namespace for this service, if Docker daemon is configured with user namespaces.
See <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/dockerd.md#disable-user-namespace-for-a-container">dockerd</a> for
more information.</p>

<blockquote>
  <p><strong>Note</strong>: This option is ignored when
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/stack_deploy.md">deploying a stack in swarm mode</a>
with a (version 3) Compose file.</p>
</blockquote>

<h3 id="volumes">volumes</h3>

<p>Mount host paths or named volumes, specified as sub-options to a service.</p>

<p>You can mount a host path as part of a definition for a single service, and
there is no need to define it in the top level <code class="highlighter-rouge">volumes</code> key.</p>

<p>But, if you want to reuse a volume across multiple services, then define a named
volume in the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> key</a>. Use
named volumes with <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volumes-for-services-swarms-and-stack-files">services, swarms, and stack
files</a>.</p>

<blockquote>
  <p><strong>Note</strong>: The top-level
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volume-configuration-reference">volumes</a> key defines
a named volume and references it from each service’s <code class="highlighter-rouge">volumes</code> list. This replaces <code class="highlighter-rouge">volumes_from</code> in earlier versions of the Compose file format. See <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/volumes/volumes.md">Use volumes</a> and <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/extend/plugins_volume.md">Volume
Plugins</a> for general information on volumes.</p>
</blockquote>

<p>This example shows a named volume (<code class="highlighter-rouge">mydata</code>) being used by the <code class="highlighter-rouge">web</code> service,
and a bind mount defined for a single service (first path under <code class="highlighter-rouge">db</code> service
<code class="highlighter-rouge">volumes</code>). The <code class="highlighter-rouge">db</code> service also uses a named volume called <code class="highlighter-rouge">dbdata</code> (second
path under <code class="highlighter-rouge">db</code> service <code class="highlighter-rouge">volumes</code>), but defines it using the old string format
for mounting a named volume. Named volumes must be listed under the top-level
<code class="highlighter-rouge">volumes</code> key, as shown.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">volume</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">mydata</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/data</span>
        <span class="na">volume</span><span class="pi">:</span>
          <span class="na">nocopy</span><span class="pi">:</span> <span class="no">true</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">bind</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">./static</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/opt/app/static</span>

  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">dbdata:/var/lib/postgresql/data"</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">mydata</span><span class="pi">:</span>
  <span class="na">dbdata</span><span class="pi">:</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: See <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/volumes/volumes.md">Use volumes</a> and <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/extend/plugins_volume.md">Volume
Plugins</a> for general information on volumes.</p>
</blockquote>

<h4 id="short-syntax-3">Short syntax</h4>

<p>Optionally specify a path on the host machine
(<code class="highlighter-rouge">HOST:CONTAINER</code>), or an access mode (<code class="highlighter-rouge">HOST:CONTAINER:ro</code>).</p>

<p>You can mount a relative path on the host, that expands relative to
the directory of the Compose configuration file being used. Relative paths
should always begin with <code class="highlighter-rouge">.</code> or <code class="highlighter-rouge">..</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">volumes</span><span class="pi">:</span>
  <span class="c1"># Just specify a path and let the Engine create a volume</span>
  <span class="pi">-</span> <span class="s">/var/lib/mysql</span>

  <span class="c1"># Specify an absolute path mapping</span>
  <span class="pi">-</span> <span class="s">/opt/data:/var/lib/mysql</span>

  <span class="c1"># Path on the host, relative to the Compose file</span>
  <span class="pi">-</span> <span class="s">./cache:/tmp/cache</span>

  <span class="c1"># User-relative path</span>
  <span class="pi">-</span> <span class="s">~/configs:/etc/configs/:ro</span>

  <span class="c1"># Named volume</span>
  <span class="pi">-</span> <span class="s">datavolume:/var/lib/mysql</span>
</code></pre></div></div>

<h4 id="long-syntax-3">Long syntax</h4>

<p>The long form syntax allows the configuration of additional fields that can’t be
expressed in the short form.</p>

<ul>
  <li><code class="highlighter-rouge">type</code>: the mount type <code class="highlighter-rouge">volume</code>, <code class="highlighter-rouge">bind</code> or <code class="highlighter-rouge">tmpfs</code></li>
  <li><code class="highlighter-rouge">source</code>: the source of the mount, a path on the host for a bind mount, or the
name of a volume defined in the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> key</a>. Not applicable for a tmpfs mount.</li>
  <li><code class="highlighter-rouge">target</code>: the path in the container where the volume is mounted</li>
  <li><code class="highlighter-rouge">read_only</code>: flag to set the volume as read-only</li>
  <li><code class="highlighter-rouge">bind</code>: configure additional bind options
    <ul>
      <li><code class="highlighter-rouge">propagation</code>: the propagation mode used for the bind</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">volume</code>: configure additional volume options
    <ul>
      <li><code class="highlighter-rouge">nocopy</code>: flag to disable copying of data from a container when a volume is
created</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">tmpfs</code>: configure additional tmpfs options
    <ul>
      <li><code class="highlighter-rouge">size</code>: the size for the tmpfs mount in bytes</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">consistency</code>: the consistency requirements of the mount, one of <code class="highlighter-rouge">consistent</code> (host and container have identical view), <code class="highlighter-rouge">cached</code> (read cache, host view is authoritative) or <code class="highlighter-rouge">delegated</code> (read-write cache, container’s view is authoritative)</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">volume</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">mydata</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/data</span>
        <span class="na">volume</span><span class="pi">:</span>
          <span class="na">nocopy</span><span class="pi">:</span> <span class="no">true</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">bind</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">./static</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/opt/app/static</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">webnet</span><span class="pi">:</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">mydata</span><span class="pi">:</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: The long syntax is new in v3.2</p>
</blockquote>

<h4 id="volumes-for-services-swarms-and-stack-files">Volumes for services, swarms, and stack files</h4>

<p>When working with services, swarms, and <code class="highlighter-rouge">docker-stack.yml</code> files, keep in mind
that the tasks (containers) backing a service can be deployed on any node in a
swarm, and this may be a different node each time the service is updated.</p>

<p>In the absence of having named volumes with specified sources, Docker creates an
anonymous volume for each task backing a service. Anonymous volumes do not
persist after the associated containers are removed.</p>

<p>If you want your data to persist, use a named volume and a volume driver that
is multi-host aware, so that the data is accessible from any node. Or, set
constraints on the service so that its tasks are deployed on a node that has the
volume present.</p>

<p>As an example, the <code class="highlighter-rouge">docker-stack.yml</code> file for the
<a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md">votingapp sample in Docker
Labs</a> defines a service called <code class="highlighter-rouge">db</code> that runs a <code class="highlighter-rouge">postgres</code> database. It is
configured as a named volume to persist the data on the swarm,
<em>and</em> is constrained to run only on <code class="highlighter-rouge">manager</code> nodes. Here is the relevant snip-it from that file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:9.4</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db-data:/var/lib/postgresql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">placement</span><span class="pi">:</span>
        <span class="na">constraints</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">node.role == manager</span><span class="pi">]</span>
</code></pre></div></div>

<h4 id="caching-options-for-volume-mounts-docker-desktop-for-mac">Caching options for volume mounts (Docker Desktop for Mac)</h4>

<p>On Docker 17.04 CE Edge and up, including 17.06 CE Edge and Stable, you can
configure container-and-host consistency requirements for bind-mounted
directories in Compose files to allow for better performance on read/write of
volume mounts. These options address issues specific to <code class="highlighter-rouge">osxfs</code> file sharing,
and therefore are only applicable on Docker Desktop for Mac.</p>

<p>The flags are:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">consistent</code>: Full consistency. The container runtime and the
host maintain an identical view of the mount at all times.  This is the default.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">cached</code>: The host’s view of the mount is authoritative. There may be
delays before updates made on the host are visible within a container.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">delegated</code>: The container runtime’s view of the mount is
authoritative. There may be delays before updates made in a container
are visible on the host.</p>
  </li>
</ul>

<p>Here is an example of configuring a volume as <code class="highlighter-rouge">cached</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">php</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">php:7.1-fpm</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9000"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.:/var/www/project:cached</span>
</code></pre></div></div>

<p>Full detail on these flags, the problems they solve, and their
<code class="highlighter-rouge">docker run</code> counterparts is in the Docker Desktop for Mac topic <a href="https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-mac/osxfs-caching.md">Performance tuning for
volume mounts (shared filesystems)</a>.</p>

<h3 id="domainname-hostname-ipc-mac_address-privileged-read_only-shm_size-stdin_open-tty-user-working_dir">domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</h3>

<p>Each of these is a single value, analogous to its
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/run.md">docker run</a> counterpart. Note that <code class="highlighter-rouge">mac_address</code> is a legacy option.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">user</span><span class="pi">:</span> <span class="s">postgresql</span>
<span class="na">working_dir</span><span class="pi">:</span> <span class="s">/code</span>

<span class="na">domainname</span><span class="pi">:</span> <span class="s">foo.com</span>
<span class="na">hostname</span><span class="pi">:</span> <span class="s">foo</span>
<span class="na">ipc</span><span class="pi">:</span> <span class="s">host</span>
<span class="na">mac_address</span><span class="pi">:</span> <span class="s">02:42:ac:11:65:43</span>

<span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>


<span class="na">read_only</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">shm_size</span><span class="pi">:</span> <span class="s">64M</span>
<span class="na">stdin_open</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h2 id="specifying-durations">Specifying durations</h2>

<p>Some configuration options, such as the <code class="highlighter-rouge">interval</code> and <code class="highlighter-rouge">timeout</code> sub-options for
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#healthcheck"><code class="highlighter-rouge">check</code></a>, accept a duration as a string in a
format that looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.5s
10s
1m30s
2h32m
5h34m56s
</code></pre></div></div>

<p>The supported units are <code class="highlighter-rouge">us</code>, <code class="highlighter-rouge">ms</code>, <code class="highlighter-rouge">s</code>, <code class="highlighter-rouge">m</code> and <code class="highlighter-rouge">h</code>.</p>

<h2 id="specifying-byte-values">Specifying byte values</h2>

<p>Some configuration options, such as the <code class="highlighter-rouge">shm_size</code> sub-option for
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#build"><code class="highlighter-rouge">build</code></a>, accept a byte value as a string in a format
that looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2b
1024kb
2048k
300m
1gb
</code></pre></div></div>

<p>The supported units are <code class="highlighter-rouge">b</code>, <code class="highlighter-rouge">k</code>, <code class="highlighter-rouge">m</code> and <code class="highlighter-rouge">g</code>, and their alternative notation <code class="highlighter-rouge">kb</code>,
<code class="highlighter-rouge">mb</code> and <code class="highlighter-rouge">gb</code>. Decimal values are not supported at this time.</p>

<h2 id="volume-configuration-reference">Volume configuration reference</h2>

<p>While it is possible to declare <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volumes">volumes</a> on the file as part of the
service declaration, this section allows you to create named volumes (without
relying on <code class="highlighter-rouge">volumes_from</code>) that can be reused across multiple services, and are
easily retrieved and inspected using the docker command line or API. See the
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/volume_create.md">docker volume</a> subcommand
documentation for more information.</p>

<p>See <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/volumes/volumes.md">Use volumes</a> and <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/extend/plugins_volume.md">Volume
Plugins</a> for general information on volumes.</p>

<p>Here’s an example of a two-service setup where a database’s data directory is
shared with another service as a volume so that it can be periodically backed
up:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">db</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">data-volume:/var/lib/db</span>
  <span class="na">backup</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">backup-service</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">data-volume:/var/lib/backup/data</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">data-volume</span><span class="pi">:</span>
</code></pre></div></div>

<p>An entry under the top-level <code class="highlighter-rouge">volumes</code> key can be empty, in which case it
uses the default driver configured by the Engine (in most cases, this is the
<code class="highlighter-rouge">local</code> driver). Optionally, you can configure it with the following keys:</p>

<h3 id="driver">driver</h3>

<p>Specify which volume driver should be used for this volume. Defaults to whatever
driver the Docker Engine has been configured to use, which in most cases is
<code class="highlighter-rouge">local</code>. If the driver is not available, the Engine returns an error when
<code class="highlighter-rouge">docker-compose up</code> tries to create the volume.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">driver</span><span class="pi">:</span> <span class="s">foobar</span>
</code></pre></div></div>

<h3 id="driver_opts">driver_opts</h3>

<p>Specify a list of options as key-value pairs to pass to the driver for this
volume. Those options are driver-dependent - consult the driver’s
documentation for more information. Optional.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">volumes</span><span class="pi">:</span>
  <span class="na">example</span><span class="pi">:</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nfs"</span>
      <span class="na">o</span><span class="pi">:</span> <span class="s2">"</span><span class="s">addr=10.40.0.199,nolock,soft,rw"</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s2">"</span><span class="s">:/docker/example"</span>
</code></pre></div></div>

<h3 id="external">external</h3>

<p>If set to <code class="highlighter-rouge">true</code>, specifies that this volume has been created outside of
Compose. <code class="highlighter-rouge">docker-compose up</code> does not attempt to create it, and raises
an error if it doesn’t exist.</p>

<p>For version 3.3 and below of the format, <code class="highlighter-rouge">external</code> cannot be used in
conjunction with other volume configuration keys (<code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">driver_opts</code>,
<code class="highlighter-rouge">labels</code>). This limitation no longer exists for
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-34">version 3.4</a> and above.</p>

<p>In the example below, instead of attempting to create a volume called
<code class="highlighter-rouge">[projectname]_data</code>, Compose looks for an existing volume simply
called <code class="highlighter-rouge">data</code> and mount it into the <code class="highlighter-rouge">db</code> service’s containers.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">data:/var/lib/postgresql/data</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">data</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-34">external.name was deprecated in version 3.4 file format</a>
use <code class="highlighter-rouge">name</code> instead.</p>
</blockquote>

<p>You can also specify the name of the volume separately from the name used to
refer to it within the Compose file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">volumes</span><span class="pi">:</span>
  <span class="na">data</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">actual-name-of-volume</span>
</code></pre></div></div>

<blockquote>
  <p>External volumes are always created with docker stack deploy</p>

  <p>External volumes that do not exist <em>are created</em> if you use <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#deploy">docker stack
deploy</a> to launch the app in <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/index.md">swarm mode</a>
(instead of <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/reference/up.md">docker compose up</a>). In swarm mode, a
volume is automatically created when it is defined by a service. As service
tasks are scheduled on new nodes,
<a href="https://github.com/docker/swarmkit/blob/master/README.md">swarmkit</a> creates the
volume on the local node. To learn more, see
<a href="https://github.com/moby/moby/issues/29976">moby/moby#29976</a>.</p>
</blockquote>

<h3 id="labels-3">labels</h3>

<p>Add metadata to containers using
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a>. You can use either
an array or a dictionary.</p>

<p>It’s recommended that you use reverse-DNS notation to prevent your labels from
conflicting with those used by other software.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">labels</span><span class="pi">:</span>
  <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Database</span><span class="nv"> </span><span class="s">volume"</span>
  <span class="s">com.example.department</span><span class="pi">:</span> <span class="s2">"</span><span class="s">IT/Ops"</span>
  <span class="s">com.example.label-with-empty-value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">labels</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.description=Database</span><span class="nv"> </span><span class="s">volume"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.department=IT/Ops"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.label-with-empty-value"</span>
</code></pre></div></div>

<h3 id="name">name</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-34">Added in version 3.4 file format</a></p>
</blockquote>

<p>Set a custom name for this volume. The name field can be used to reference
volumes that contain special characters. The name is used as is
and will <strong>not</strong> be scoped with the stack name.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">data</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">my-app-data</span>
</code></pre></div></div>

<p>It can also be used in conjunction with the <code class="highlighter-rouge">external</code> property:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">data</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">my-app-data</span>
</code></pre></div></div>

<h2 id="network-configuration-reference">Network configuration reference</h2>

<p>The top-level <code class="highlighter-rouge">networks</code> key lets you specify networks to be created.</p>

<ul>
  <li>
    <p>For a full explanation of Compose’s use of Docker networking features and all
network driver options, see the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/networking/">Networking guide</a>.</p>
  </li>
  <li>
    <p>For <a href="https://github.com/docker/labs/blob/master/README.md">Docker Labs</a>
tutorials on networking, start with <a href="https://github.com/docker/labs/blob/master/networking/README.md">Designing Scalable, Portable Docker
Container
Networks</a></p>
  </li>
</ul>

<h3 id="driver-1">driver</h3>

<p>Specify which driver should be used for this network.</p>

<p>The default driver depends on how the Docker Engine you’re using is configured,
but in most instances it is <code class="highlighter-rouge">bridge</code> on a single host and <code class="highlighter-rouge">overlay</code> on a
Swarm.</p>

<p>The Docker Engine returns an error if the driver is not available.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">driver</span><span class="pi">:</span> <span class="s">overlay</span>
</code></pre></div></div>

<h4 id="bridge">bridge</h4>

<p>Docker defaults to using a <code class="highlighter-rouge">bridge</code> network on a single host. For examples of
how to work with bridge networks, see the Docker Labs tutorial on <a href="https://github.com/docker/labs/blob/master/networking/A2-bridge-networking.md">Bridge
networking</a>.</p>

<h4 id="overlay">overlay</h4>

<p>The <code class="highlighter-rouge">overlay</code> driver creates a named network across multiple nodes in a
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/">swarm</a>.</p>

<ul>
  <li>
    <p>For a working example of how to build and use an
<code class="highlighter-rouge">overlay</code> network with a service in swarm mode, see the Docker Labs tutorial on
<a href="https://github.com/docker/labs/blob/master/networking/A3-overlay-networking.md">Overlay networking and service
discovery</a>.</p>
  </li>
  <li>
    <p>For an in-depth look at how it works under the hood, see the
networking concepts lab on the <a href="https://github.com/docker/labs/blob/master/networking/concepts/06-overlay-networks.md">Overlay Driver Network
Architecture</a>.</p>
  </li>
</ul>

<h4 id="host-or-none">host or none</h4>

<p>Use the host’s networking stack, or no networking. Equivalent to
<code class="highlighter-rouge">docker run --net=host</code> or <code class="highlighter-rouge">docker run --net=none</code>. Only used if you use
<code class="highlighter-rouge">docker stack</code> commands. If you use the <code class="highlighter-rouge">docker-compose</code> command,
use <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network_mode">network_mode</a> instead.</p>

<p>If you want to use a particular network on a common build, use [network] as
mentioned in the second yaml file example.</p>

<p>The syntax for using built-in networks such as <code class="highlighter-rouge">host</code> and <code class="highlighter-rouge">none</code> is a little
different. Define an external network with the name <code class="highlighter-rouge">host</code> or <code class="highlighter-rouge">none</code> (that
Docker has already created automatically) and an alias that Compose can use
(<code class="highlighter-rouge">hostnet</code> or <code class="highlighter-rouge">nonet</code> in the following examples), then grant the service access to that
network using the alias.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">hostnet</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">hostnet</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">host</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">build</span><span class="pi">:</span>
      <span class="s">...</span>
      <span class="s">network</span><span class="pi">:</span> <span class="s">host</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="s">...</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">networks</span><span class="pi">:</span>
      <span class="na">nonet</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">nonet</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">none</span>
</code></pre></div></div>

<h3 id="driver_opts-1">driver_opts</h3>

<p>Specify a list of options as key-value pairs to pass to the driver for this
network. Those options are driver-dependent - consult the driver’s
documentation for more information. Optional.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">driver_opts</span><span class="pi">:</span>
  <span class="na">foo</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bar"</span>
  <span class="na">baz</span><span class="pi">:</span> <span class="s">1</span>
</code></pre></div></div>

<h3 id="attachable">attachable</h3>

<blockquote>
  <p><strong>Note</strong>: Only supported for v3.2 and higher.</p>
</blockquote>

<p>Only used when the <code class="highlighter-rouge">driver</code> is set to <code class="highlighter-rouge">overlay</code>. If set to <code class="highlighter-rouge">true</code>, then
standalone containers can attach to this network, in addition to services. If a
standalone container attaches to an overlay network, it can communicate with
services and standalone containers that are also attached to the overlay
network from other Docker daemons.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">networks</span><span class="pi">:</span>
  <span class="na">mynet1</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">overlay</span>
    <span class="na">attachable</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h3 id="enable_ipv6">enable_ipv6</h3>

<p>Enable IPv6 networking on this network.</p>

<blockquote class="warning">
  <p>Not supported in Compose File version 3</p>

  <p><code class="highlighter-rouge">enable_ipv6</code> requires you to use a version 2 Compose file, as this directive
is not yet supported in Swarm mode.</p>
</blockquote>

<h3 id="ipam">ipam</h3>

<p>Specify custom IPAM config. This is an object with several properties, each of
which is optional:</p>

<ul>
  <li><code class="highlighter-rouge">driver</code>: Custom IPAM driver, instead of the default.</li>
  <li><code class="highlighter-rouge">config</code>: A list with zero or more config blocks, each containing any of
the following keys:
    <ul>
      <li><code class="highlighter-rouge">subnet</code>: Subnet in CIDR format that represents a network segment</li>
    </ul>
  </li>
</ul>

<p>A full example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ipam</span><span class="pi">:</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">config</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">subnet</span><span class="pi">:</span> <span class="s">172.28.0.0/16</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Additional IPAM configurations, such as <code class="highlighter-rouge">gateway</code>, are only honored for version 2 at the moment.</p>
</blockquote>

<h3 id="internal">internal</h3>

<p>By default, Docker also connects a bridge network to it to provide external
connectivity. If you want to create an externally isolated overlay network,
you can set this option to <code class="highlighter-rouge">true</code>.</p>

<h3 id="labels-4">labels</h3>

<p>Add metadata to containers using
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a>. You can use either
an array or a dictionary.</p>

<p>It’s recommended that you use reverse-DNS notation to prevent your labels from
conflicting with those used by other software.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">labels</span><span class="pi">:</span>
  <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Financial</span><span class="nv"> </span><span class="s">transaction</span><span class="nv"> </span><span class="s">network"</span>
  <span class="s">com.example.department</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Finance"</span>
  <span class="s">com.example.label-with-empty-value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">labels</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.description=Financial</span><span class="nv"> </span><span class="s">transaction</span><span class="nv"> </span><span class="s">network"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.department=Finance"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">com.example.label-with-empty-value"</span>
</code></pre></div></div>

<h3 id="external-1">external</h3>

<p>If set to <code class="highlighter-rouge">true</code>, specifies that this network has been created outside of
Compose. <code class="highlighter-rouge">docker-compose up</code> does not attempt to create it, and raises
an error if it doesn’t exist.</p>

<p>For version 3.3 and below of the format, <code class="highlighter-rouge">external</code> cannot be used in
conjunction with other network configuration keys (<code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">driver_opts</code>,
<code class="highlighter-rouge">ipam</code>, <code class="highlighter-rouge">internal</code>). This limitation no longer exists for
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-34">version 3.4</a> and above.</p>

<p>In the example below, <code class="highlighter-rouge">proxy</code> is the gateway to the outside world. Instead of
attempting to create a network called <code class="highlighter-rouge">[projectname]_outside</code>, Compose
looks for an existing network simply called <code class="highlighter-rouge">outside</code> and connect the <code class="highlighter-rouge">proxy</code>
service’s containers to it.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">proxy</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./proxy</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">outside</span>
      <span class="pi">-</span> <span class="s">default</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./app</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">default</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">outside</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-35">external.name was deprecated in version 3.5 file format</a>
use <code class="highlighter-rouge">name</code> instead.</p>
</blockquote>

<p>You can also specify the name of the network separately from the name used to
refer to it within the Compose file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">outside</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">actual-name-of-network</span>
</code></pre></div></div>

<h3 id="name-1">name</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-35">Added in version 3.5 file format</a></p>
</blockquote>

<p>Set a custom name for this network. The name field can be used to reference
networks which contain special characters. The name is used as is
and will <strong>not</strong> be scoped with the stack name.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">network1</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">my-app-net</span>
</code></pre></div></div>

<p>It can also be used in conjunction with the <code class="highlighter-rouge">external</code> property:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">network1</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">my-app-net</span>
</code></pre></div></div>

<h2 id="configs-configuration-reference">configs configuration reference</h2>

<p>The top-level <code class="highlighter-rouge">configs</code> declaration defines or references
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/configs.md">configs</a> that can be granted to the services in this
stack. The source of the config is either <code class="highlighter-rouge">file</code> or <code class="highlighter-rouge">external</code>.</p>

<ul>
  <li><code class="highlighter-rouge">file</code>: The config is created with the contents of the file at the specified
path.</li>
  <li><code class="highlighter-rouge">external</code>: If set to true, specifies that this config has already been
created. Docker does not attempt to create it, and if it does not exist, a
<code class="highlighter-rouge">config not found</code> error occurs.</li>
  <li><code class="highlighter-rouge">name</code>: The name of the config object in Docker. This field can be used to
 reference configs that contain special characters. The name is used as is
 and will <strong>not</strong> be scoped with the stack name. Introduced in version 3.5
 file format.</li>
</ul>

<p>In this example, <code class="highlighter-rouge">my_first_config</code> is created (as
<code class="highlighter-rouge">&lt;stack_name&gt;_my_first_config)</code>when the stack is deployed,
and <code class="highlighter-rouge">my_second_config</code> already exists in Docker.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">configs</span><span class="pi">:</span>
  <span class="na">my_first_config</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./config_data</span>
  <span class="na">my_second_config</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Another variant for external configs is when the name of the config in Docker
is different from the name that exists within the service. The following
example modifies the previous one to use the external config called
<code class="highlighter-rouge">redis_config</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">configs</span><span class="pi">:</span>
  <span class="na">my_first_config</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./config_data</span>
  <span class="na">my_second_config</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">redis_config</span>
</code></pre></div></div>

<p>You still need to <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#configs">grant access to the config</a> to each service in the
stack.</p>

<h2 id="secrets-configuration-reference">secrets configuration reference</h2>

<p>The top-level <code class="highlighter-rouge">secrets</code> declaration defines or references
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/secrets.md">secrets</a> that can be granted to the services in this
stack. The source of the secret is either <code class="highlighter-rouge">file</code> or <code class="highlighter-rouge">external</code>.</p>

<ul>
  <li><code class="highlighter-rouge">file</code>: The secret is created with the contents of the file at the specified
path.</li>
  <li><code class="highlighter-rouge">external</code>: If set to true, specifies that this secret has already been
created. Docker does not attempt to create it, and if it does not exist, a
<code class="highlighter-rouge">secret not found</code> error occurs.</li>
  <li><code class="highlighter-rouge">name</code>: The name of the secret object in Docker. This field can be used to
 reference secrets that contain special characters. The name is used as is
 and will <strong>not</strong> be scoped with the stack name. Introduced in version 3.5
 file format.</li>
</ul>

<p>In this example, <code class="highlighter-rouge">my_first_secret</code> is created as
<code class="highlighter-rouge">&lt;stack_name&gt;_my_first_secret </code>when the stack is deployed,
and <code class="highlighter-rouge">my_second_secret</code> already exists in Docker.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">secrets</span><span class="pi">:</span>
  <span class="na">my_first_secret</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secret_data</span>
  <span class="na">my_second_secret</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Another variant for external secrets is when the name of the secret in Docker
is different from the name that exists within the service. The following
example modifies the previous one to use the external secret called
<code class="highlighter-rouge">redis_secret</code>.</p>

<h3 id="compose-file-v35-and-above">Compose File v3.5 and above</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">secrets</span><span class="pi">:</span>
  <span class="na">my_first_secret</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secret_data</span>
  <span class="na">my_second_secret</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">redis_secret</span>
</code></pre></div></div>

<h3 id="compose-file-v34-and-under">Compose File v3.4 and under</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">my_second_secret</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">redis_secret</span>
</code></pre></div></div>

<p>You still need to <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#secrets">grant access to the secrets</a> to each service in the
stack.</p>

<h2 id="variable-substitution">変数の置換</h2>

<p>設定オプションには環境変数を含めることができます。
Compose は <code class="highlighter-rouge">docker-compose</code> が実行されたシェル環境から変数値を取得します。
たとえばシェル環境に <code class="highlighter-rouge">POSTGRES_VERSION=9.3</code> が定義されているとして、以下のような設定を行ったとします。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">db</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgres:${POSTGRES_VERSION}"</span>
</code></pre></div></div>

<p>上の設定を使って <code class="highlighter-rouge">docker-compose up</code> を実行すると、Compose はシェル環境内の環境変数 <code class="highlighter-rouge">POSTGRES_VERSION</code> を見にいき、その値を使って設定を置換します。
この例では <code class="highlighter-rouge">image</code> が <code class="highlighter-rouge">postgres:9.3</code> と置換された上で、設定に関する処理へ進みます。</p>

<p>その環境変数が何も設定されていなかった場合、Compose は空文字に置換します。
上の例でいうと <code class="highlighter-rouge">POSTGRES_VERSION</code> が設定されていなかったとき、<code class="highlighter-rouge">image</code> オプションの値は <code class="highlighter-rouge">postgres:</code> になります。</p>

<p>環境変数のデフォルト値を <a href="../env-file.md"><code class="highlighter-rouge">.env</code> ファイル</a>に設定しておくことができます。
Compose はこのファイルを自動的に探しにいきます。
<code class="highlighter-rouge">.env</code> ファイルで定義されたものよりも、シェル環境で設定された値が優先されます。</p>

<blockquote class="important">
  <p><strong>重要</strong>： <code class="highlighter-rouge">.env</code> ファイルによる機能は <code class="highlighter-rouge">docker-compose up</code> コマンドを使うときだけ動作します。
<code class="highlighter-rouge">docker stack deploy</code> コマンドでは動作しません。</p>
</blockquote>

<p><code class="highlighter-rouge">$VARIABLE</code> と <code class="highlighter-rouge">${VARIABLE}</code> という 2 つの文法がともにサポートされます。
さらに <a href="compose-versioning.md#version-21">2.1 ファイルフォーマット</a>を利用している場合は、シェル上でも利用されているインラインのデフォルト指定方法を行うことができます。</p>

<ul>
  <li><code class="highlighter-rouge">${VARIABLE:-default}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないか空文字であるときに <code class="highlighter-rouge">default</code> として評価されます。</li>
  <li><code class="highlighter-rouge">${VARIABLE-default}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないときのみ <code class="highlighter-rouge">default</code> として評価されます。</li>
</ul>

<p>同様に以下の文法により、変数を必須とする扱いができます。</p>

<ul>
  <li><code class="highlighter-rouge">${VARIABLE:?err}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないか空文字であるときに、<code class="highlighter-rouge">err</code> を含むエラーメッセージを表示して終了します。</li>
  <li><code class="highlighter-rouge">${VARIABLE?err}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないときに、<code class="highlighter-rouge">err</code> を含むエラーメッセージを表示して終了します。</li>
</ul>

<p>シェル風のこの他の機能、たとえば <code class="highlighter-rouge">${VARIABLE/foo/bar}</code> などはサポートされていません。</p>

<p>設定ファイル内にドル記号そのものが必要な場合は <code class="highlighter-rouge">$$</code>（ドル記号 2 つ）を書きます。
この記述は Compose が値を取り違えないようにします。
つまり <code class="highlighter-rouge">$$</code> と書くことで、環境変数を参照しつつ Compose には処理させないようにすることができます。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">web</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$$VAR_NOT_INTERPOLATED_BY_COMPOSE"</span>
</code></pre></div></div>

<p>このことを忘れてドル記号 1 つ（<code class="highlighter-rouge">$</code>）を用いてしまうと、Compose は環境変数として値を解釈し、以下の警告を出します。</p>

<p>VAR_NOT_INTERPOLATED_BY_COMPOSE は設定されていません。空文字として置換します。</p>

<h2 id="extension-fields">Extension fields</h2>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-34">Added in version 3.4 file format</a>.</p>
</blockquote>

<p>It is possible to re-use configuration fragments using extension fields. Those
special fields can be of any format as long as they are located at the root of
your Compose file and their name start with the <code class="highlighter-rouge">x-</code> character sequence.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Starting with the 3.7 format (for the 3.x series) and 2.4 format
(for the 2.x series), extension fields are also allowed at the root
of service, volume, network, config and secret definitions.</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.4'</span>
<span class="na">x-custom</span><span class="pi">:</span>
  <span class="na">items</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">a</span>
    <span class="pi">-</span> <span class="s">b</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">max-size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">12m'</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">custom"</span>
</code></pre></div></div>

<p>The contents of those fields are ignored by Compose, but they can be
inserted in your resource definitions using <a href="http://www.yaml.org/spec/1.2/spec.html#id2765878">YAML anchors</a>.
For example, if you want several of your services to use the same logging
configuration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">max-size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">12m'</span>
    <span class="na">max-file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">5'</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">json-file</span>
</code></pre></div></div>

<p>You may write your Compose file as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.4'</span>
<span class="na">x-logging</span><span class="pi">:</span>
  <span class="nl">&amp;default-logging</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">max-size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">12m'</span>
    <span class="na">max-file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">5'</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">json-file</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp/web:latest</span>
    <span class="na">logging</span><span class="pi">:</span> <span class="nv">*default-logging</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:latest</span>
    <span class="na">logging</span><span class="pi">:</span> <span class="nv">*default-logging</span>
</code></pre></div></div>

<p>It is also possible to partially override values in extension fields using
the <a href="http://yaml.org/type/merge.html">YAML merge type</a>. For example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.4'</span>
<span class="na">x-volumes</span><span class="pi">:</span>
  <span class="nl">&amp;default-volume</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">foobar-storage</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp/web:latest</span>
    <span class="na">volumes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">vol1"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">vol2"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">vol3"</span><span class="pi">]</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">vol1</span><span class="pi">:</span> <span class="nv">*default-volume</span>
  <span class="na">vol2</span><span class="pi">:</span>
    <span class="s">&lt;&lt;</span> <span class="pi">:</span> <span class="nv">*default-volume</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">volume02</span>
  <span class="na">vol3</span><span class="pi">:</span>
    <span class="s">&lt;&lt;</span> <span class="pi">:</span> <span class="nv">*default-volume</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">default</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">volume-local</span>
</code></pre></div></div>

<h2 id="compose-documentation">Compose documentation</h2>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/index.md">User guide</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/install/">Installing Compose</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/">Compose file versions and upgrading</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/">Get started with Docker</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/samples/">Samples</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/reference/">Command line reference</a></li>
</ul>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=fig">fig</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=composition">composition</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=compose">compose</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=docker">docker</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/compose/compose-file/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "compose/compose-file/index.md",
										"title": "Compose ファイル バージョン 3 リファレンス",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/compose/compose-file/index.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v18.09.local/compose/compose-file/index.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [compose/compose-file/index.md](https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#reference-and-guidelines" class="nomunge">リファレンスとガイドライン</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#compose-and-docker-compatibility-matrix" class="nomunge">Compose and Docker compatibility matrix</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#compose-file-structure-and-examples" class="nomunge">Compose file structure and examples</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#service-configuration-reference" class="nomunge">Service configuration reference</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#build" class="nomunge">build</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#context" class="nomunge">context</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#dockerfile" class="nomunge">dockerfile</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#args" class="nomunge">args</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#cache_from" class="nomunge">cache_from</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#labels" class="nomunge">labels</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#shm_size" class="nomunge">shm_size</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#target" class="nomunge">target</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#cap_add-cap_drop" class="nomunge">cap_add, cap_drop</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#cgroup_parent" class="nomunge">cgroup_parent</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#command" class="nomunge">command</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#configs" class="nomunge">configs</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#short-syntax" class="nomunge">Short syntax</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#long-syntax" class="nomunge">Long syntax</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#container_name" class="nomunge">container_name</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#credential_spec" class="nomunge">credential_spec</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#depends_on" class="nomunge">depends_on</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#deploy" class="nomunge">deploy</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#endpoint_mode" class="nomunge">endpoint_mode</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#labels-1" class="nomunge">labels</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#mode" class="nomunge">mode</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#placement" class="nomunge">placement</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#replicas" class="nomunge">replicas</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#resources" class="nomunge">resources</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#restart_policy" class="nomunge">restart_policy</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#rollback_config" class="nomunge">rollback_config</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#update_config" class="nomunge">update_config</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#not-supported-for-docker-stack-deploy" class="nomunge">Not supported for docker stack deploy</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#devices" class="nomunge">devices</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#depends_on-1" class="nomunge">depends_on</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#dns" class="nomunge">dns</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#dns_search" class="nomunge">dns_search</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#entrypoint" class="nomunge">entrypoint</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#env_file" class="nomunge">env_file</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#environment" class="nomunge">environment</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#expose" class="nomunge">expose</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#external_links" class="nomunge">external_links</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#extra_hosts" class="nomunge">extra_hosts</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#healthcheck" class="nomunge">healthcheck</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#image" class="nomunge">image</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#init" class="nomunge">init</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#isolation" class="nomunge">isolation</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#labels-2" class="nomunge">labels</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#links" class="nomunge">links</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#logging" class="nomunge">logging</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network_mode" class="nomunge">network_mode</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#networks" class="nomunge">networks</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#aliases" class="nomunge">aliases</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#ipv4_address-ipv6_address" class="nomunge">ipv4_address, ipv6_address</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#pid" class="nomunge">pid</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#ports" class="nomunge">ports</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#short-syntax-1" class="nomunge">Short syntax</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#long-syntax-1" class="nomunge">Long syntax</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#restart" class="nomunge">restart</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#secrets" class="nomunge">secrets</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#short-syntax-2" class="nomunge">Short syntax</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#long-syntax-2" class="nomunge">Long syntax</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#security_opt" class="nomunge">security_opt</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#stop_grace_period" class="nomunge">stop_grace_period</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#stop_signal" class="nomunge">stop_signal</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#sysctls" class="nomunge">sysctls</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#tmpfs" class="nomunge">tmpfs</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#ulimits" class="nomunge">ulimits</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#userns_mode" class="nomunge">userns_mode</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volumes" class="nomunge">volumes</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#short-syntax-3" class="nomunge">Short syntax</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#long-syntax-3" class="nomunge">Long syntax</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volumes-for-services-swarms-and-stack-files" class="nomunge">Volumes for services, swarms, and stack files</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#caching-options-for-volume-mounts-docker-desktop-for-mac" class="nomunge">Caching options for volume mounts (Docker Desktop for Mac)</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#domainname-hostname-ipc-mac_address-privileged-read_only-shm_size-stdin_open-tty-user-working_dir" class="nomunge">domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations" class="nomunge">Specifying durations</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#specifying-byte-values" class="nomunge">Specifying byte values</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#volume-configuration-reference" class="nomunge">Volume configuration reference</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#driver" class="nomunge">driver</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#driver_opts" class="nomunge">driver_opts</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#external" class="nomunge">external</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#labels-3" class="nomunge">labels</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#name" class="nomunge">name</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#network-configuration-reference" class="nomunge">Network configuration reference</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#driver-1" class="nomunge">driver</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#bridge" class="nomunge">bridge</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#overlay" class="nomunge">overlay</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#host-or-none" class="nomunge">host or none</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#driver_opts-1" class="nomunge">driver_opts</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#attachable" class="nomunge">attachable</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#enable_ipv6" class="nomunge">enable_ipv6</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#ipam" class="nomunge">ipam</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#internal" class="nomunge">internal</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#labels-4" class="nomunge">labels</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#external-1" class="nomunge">external</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#name-1" class="nomunge">name</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#configs-configuration-reference" class="nomunge">configs configuration reference</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#secrets-configuration-reference" class="nomunge">secrets configuration reference</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#compose-file-v35-and-above" class="nomunge">Compose File v3.5 and above</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#compose-file-v34-and-under" class="nomunge">Compose File v3.4 and under</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#variable-substitution" class="nomunge">変数の置換</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#extension-fields" class="nomunge">Extension fields</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/#compose-documentation" class="nomunge">Compose documentation</a></li>
    </ul>
  </li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-google-plus"><a href="https://plus.google.com/u/0/communities/108146856671494713993">Google</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker/docker">Github</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/compose/compose-file/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
