<!DOCTYPE html>
<!-- Page generated 2022-04-29 17:35:28 +0900-->
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ACI integration Compose features | Docker ドキュメント</title>
  <meta name="description" content="Reference list of compose ACI features" />
  <meta name="keywords" content="Docker, Azure, Integration, ACI, Compose, cli, deploy, cloud">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/cloud/aci-compose-features/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="ACI integration Compose features"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="ACI integration Compose features" />
  <meta property="og:description" content="Reference list of compose ACI features" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2022-04-29T17:35:28+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/cloud/aci-compose-features/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2022-04-29T17:35:28+09:00"/>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","headline":"ACI integration Compose features","description":"Reference list of compose ACI features","url":"https://docs.docker.com/cloud/aci-compose-features/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs ホームページ"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/get-started/overview/">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/cloud/aci-integration/">クラウドへのアプリのデプロイ</a></li><li><a href="/docs.docker.jp.onthefly/cloud/aci-compose-features/">ACI Compose features</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>ACI integration Compose features</h1><p><em class="reading-time">読む時間の目安: 9 分</em></p><h1 id="compose---azure-container-instances-mapping">Compose - Azure Container Instances mapping</h1>

<p>This document outlines the conversion of an application defined in a Compose file to ACI objects.
At a high-level, each Compose deployment is mapped to a single ACI container group.
Each service is mapped to a container in the container group. The Docker ACI integration does not allow scaling of services.</p>

<h2 id="compose-fields-mapping">Compose fields mapping</h2>

<p>The table below lists supported Compose file fields and their ACI counterparts.</p>

<p><strong>Legend:</strong></p>

<ul>
  <li><strong>✓:</strong> Implemented</li>
  <li><strong>n:</strong> Not yet implemented</li>
  <li><strong>x:</strong> Not applicable / no available conversion</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Keys</th>
      <th>Map</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Service</strong></td>
      <td>✓</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.service.build</td>
      <td>x</td>
      <td>Ignored. No image build support on ACI.</td>
    </tr>
    <tr>
      <td>service.cap_add, cap_drop</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.command</td>
      <td>✓</td>
      <td>Override container Command. On ACI, specifying <code class="highlighter-rouge">command</code> will override the image command and entrypoint, if the image has an command or entrypoint defined</td>
    </tr>
    <tr>
      <td>service.configs</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.cgroup_parent</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.container_name</td>
      <td>x</td>
      <td>Service name is used as container name on ACI.</td>
    </tr>
    <tr>
      <td>service.credential_spec</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.deploy</td>
      <td>✓</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.deploy.endpoint_mode</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.deploy.mode</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.deploy.replicas</td>
      <td>x</td>
      <td>Only one replica is started for each service.</td>
    </tr>
    <tr>
      <td>service.deploy.placement</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.deploy.update_config</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.deploy.resources</td>
      <td>✓</td>
      <td>Restriction: ACI resource limits cannot be greater than the sum of resource reservations for all containers in the container group. Using container limits that are greater than container reservations will cause containers in the same container group to compete with resources.</td>
    </tr>
    <tr>
      <td>service.deploy.restart_policy</td>
      <td>✓</td>
      <td>One of: <code class="highlighter-rouge">any</code>, <code class="highlighter-rouge">none</code>, <code class="highlighter-rouge">on-failure</code>. Restriction: All services must have the same restart policy. The entire ACI container group will be restarted if needed.</td>
    </tr>
    <tr>
      <td>service.deploy.labels</td>
      <td>x</td>
      <td>ACI does not have container-level labels.</td>
    </tr>
    <tr>
      <td>service.devices</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.depends_on</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.dns</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.dns_search</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.domainname</td>
      <td>✓</td>
      <td>Mapped to ACI DNSLabelName. Restriction: all services must specify the same <code class="highlighter-rouge">domainname</code>, if specified. <code class="highlighter-rouge">domainname</code> must be unique globally in         <region>.azurecontainer.io</region>
</td>
    </tr>
    <tr>
      <td>service.tmpfs</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.entrypoint</td>
      <td>x</td>
      <td>ACI only supports overriding the container command.</td>
    </tr>
    <tr>
      <td>service.env_file</td>
      <td>✓</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.environment</td>
      <td>✓</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.expose</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.extends</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.external_links</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.extra_hosts</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.group_add</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.healthcheck</td>
      <td>✓</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.hostname</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.image</td>
      <td>✓</td>
      <td>Private images will be accessible if the user is logged into the corresponding registry at deploy time. Users will be automatically logged in to Azure Container Registry using their Azure login if possible.</td>
    </tr>
    <tr>
      <td>service.isolation</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.labels</td>
      <td>x</td>
      <td>ACI does not have container-level labels.</td>
    </tr>
    <tr>
      <td>service.links</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.logging</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.network_mode</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.networks</td>
      <td>x</td>
      <td>Communication between services is implemented by defining mapping for each service in the shared <code class="highlighter-rouge">/etc/hosts</code> file of the container group. Each service can resolve names for other services and the resulting network calls will be redirected to <code class="highlighter-rouge">localhost</code>.</td>
    </tr>
    <tr>
      <td>service.pid</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.ports</td>
      <td>✓</td>
      <td>Only symmetrical port mapping is supported in ACI. See <a href="#exposing-ports">Exposing ports</a>.</td>
    </tr>
    <tr>
      <td>service.secrets</td>
      <td>✓</td>
      <td>See <a href="#secrets">Secrets</a>.</td>
    </tr>
    <tr>
      <td>service.security_opt</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.stop_grace_period</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.stop_signal</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.sysctls</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.ulimits</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.userns_mode</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>service.volumes</td>
      <td>✓</td>
      <td>Mapped to AZure File Shares. See <a href="#persistent-volumes">Persistent volumes</a>.</td>
    </tr>
    <tr>
      <td>service.restart</td>
      <td>x</td>
      <td>Replaced by service.deployment.restart_policy</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>Volume</strong></td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>driver</td>
      <td>✓</td>
      <td>See <a href="#persistent-volumes">Persistent volumes</a>.</td>
    </tr>
    <tr>
      <td>driver_opts</td>
      <td>✓</td>
      <td> </td>
    </tr>
    <tr>
      <td>external</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>labels</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>Secret</strong></td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>TBD</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>Config</strong></td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td>TBD</td>
      <td>x</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h2 id="logs">Logs</h2>

<p>Container logs can be obtained for each container with <code class="highlighter-rouge">docker logs &lt;CONTAINER&gt;</code>.
The Docker ACI integration does not currently support aggregated logs for containers in a Compose application, see https://github.com/docker/compose-cli/issues/803.</p>

<h2 id="exposing-ports">Exposing ports</h2>

<p>When one or more services expose ports, the entire ACI container group will be exposed and will get a public IP allocated.
As all services are mapped to containers in the same container group, only one service cannot expose a given port number.
<a href="https://feedback.azure.com/forums/602224-azure-container-instances/suggestions/34082284-support-for-port-mapping">ACI does not support port mapping</a>, so the source and target ports defined in the Compose file must be the same.</p>

<p>When exposing ports, a service can also specify the service <code class="highlighter-rouge">domainname</code> field to set a DNS hostname. <code class="highlighter-rouge">domainname</code> will be used to specify the ACI DNS Label Name, and the ACI container group will be reachable at   <domainname>.<region>.azurecontainer.io. All services specifying a `domainname` must set the same value, as it is applied to the entire container group. `domainname` must be unique globally in <region>.azurecontainer.io</region></region></domainname>
</p>

<h2 id="persistent-volumes">Persistent volumes</h2>

<p>Docker volumes are mapped to Azure file shares. Only the long Compose volume format is supported meaning that volumes must be defined in the <code class="highlighter-rouge">volume</code> section.
Volumes are defined with a name, the <code class="highlighter-rouge">driver</code> field must be set to <code class="highlighter-rouge">azure_file</code>, and <code class="highlighter-rouge">driver_options</code> must define the storage account and file share to use for the volume.
A service can then reference the volume by its name, and specify the target path to be mounted in the container.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="na">myservice</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">mydata:/mount/testvolumes</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">mydata</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">azure_file</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">share_name</span><span class="pi">:</span> <span class="s">myfileshare</span>
      <span class="na">storage_account_name</span><span class="pi">:</span> <span class="s">mystorageaccount</span>
</code></pre></div></div>

<p>The short volume syntax is not allowed for ACI volumes, as it was designed for local path bind mounting when running local containers.
A Compose file can define several volumes, with different Azure file shares or storage accounts.</p>

<p>Credentials for storage accounts will be automatically fetched at deployment time using the Azure login to retrieve the storage account key for each storage account used.</p>

<h2 id="secrets">Secrets</h2>

<p>Secrets can be defined in compose files, and will need secret files available at deploy time next to the compose file.
The content of the secret file will be made available inside selected containers, by default under <code class="highlighter-rouge">/run/secrets/&lt;SECRET_NAME&gt;</code>.
External secrets are not supported with the ACI integration.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="na">nginx</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">secrets</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">mysecret1</span>
    <span class="na">db</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>
        <span class="na">secrets</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">mysecret2</span>

<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">mysecret1</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_secret1.txt</span>
  <span class="na">mysecret2</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_secret2.txt</span>
</code></pre></div></div>

<p>The nginx container will have secret1 mounted as <code class="highlighter-rouge">/run/secrets/mysecret1</code>, the db container will have secret2 mounted as <code class="highlighter-rouge">/run/secrets/mysecret2</code></p>

<p>A target can also be specified to set the name of the mounted file or by specifying an absolute path where to mount the secret file</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="na">nginx</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">secrets</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">mysecret1</span>
            <span class="na">target</span><span class="pi">:</span> <span class="s">renamedsecret1.txt</span>
    <span class="na">db</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>
        <span class="na">secrets</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">mysecret1</span>
            <span class="na">target</span><span class="pi">:</span> <span class="s">/mnt/dbmount/mysecretonmount1.txt</span>
          <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">mysecret2</span>
            <span class="na">target</span><span class="pi">:</span> <span class="s">/mnt/dbmount/mysecretonmount2.txt</span>

<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">mysecret1</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_secret1.txt</span>
  <span class="na">mysecret2</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./my_secret2.txt</span>
</code></pre></div></div>

<p>In this example the <code class="highlighter-rouge">nginx</code> service will have its secret mounted to <code class="highlighter-rouge">/run/secrets/renamedsecret1.txt</code> and <code class="highlighter-rouge">db</code> will have 2 files (<code class="highlighter-rouge">mysecretonmount1.txt</code> and <code class="highlighter-rouge">mysecretonmount2.txt</code>).
Both of them with be mounted in the same folder (<code class="highlighter-rouge">/mnt/dbmount/</code>).</p>

<p><strong>Note:</strong> Relative file paths are not allowed in the target</p>

<p><strong>Note:</strong> Secret files cannot be mounted in a folder next to other existing files</p>

<h2 id="container-resources">Container Resources</h2>

<p>CPU and memory reservations and limits can be set in compose.
Resource limits must be greater than reservation. In ACI, setting resource limits different from resource reservation will cause containers in the same container group to compete for resources. Resource limits cannot be greater than the total resource reservation for the container group. (Therefore single containers cannot have resource limits different from resource reservations)</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">3G</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.5'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1.5G</span>
</code></pre></div></div>

<p>In this example, the db container will be allocated 2 CPUs and 2G of memory. It will be allowed to use up to 3 CPUs and 3G of memory, using some of the resources allocated to the web container.
The web container will have its limits set to the same values as reservations, by default.</p>

<h2 id="healthchecks">Healthchecks</h2>

<p>A health check can be described in the <code class="highlighter-rouge">healthcheck</code> section of each service. This is translated to a <code class="highlighter-rouge">LivenessProbe</code> in ACI. If the health check fails then the container is considered unhealthy and terminated.
In order for the container to be restarted automatically, the service needs to have a restart policy other than <code class="highlighter-rouge">none</code> to be set. Note that the default restart policy if one isn’t set is <code class="highlighter-rouge">any</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:80"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="s">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">40s</span>
</code></pre></div></div>

<p><strong>Note:</strong> that the <code class="highlighter-rouge">test</code> command can be a <code class="highlighter-rouge">string</code> or an array starting or not by <code class="highlighter-rouge">NONE</code>, <code class="highlighter-rouge">CMD</code>, <code class="highlighter-rouge">CMD-SHELL</code>. In the ACI implementation, these prefixes are ignored.</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=Docker">Docker</a>, <a href="/docs.docker.jp.onthefly/search/?q=Azure">Azure</a>, <a href="/docs.docker.jp.onthefly/search/?q=Integration">Integration</a>, <a href="/docs.docker.jp.onthefly/search/?q=ACI">ACI</a>, <a href="/docs.docker.jp.onthefly/search/?q=Compose">Compose</a>, <a href="/docs.docker.jp.onthefly/search/?q=cli">cli</a>, <a href="/docs.docker.jp.onthefly/search/?q=deploy">deploy</a>, <a href="/docs.docker.jp.onthefly/search/?q=cloud">cloud</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/cloud/aci-compose-features.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [cloud/aci-compose-features.ch](https://matsuand.github.io/docs.docker.jp.onthefly/cloud/aci-compose-features/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#compose-fields-mapping" class="nomunge">Compose fields mapping</a></li>
  <li><a href="#logs" class="nomunge">Logs</a></li>
  <li><a href="#exposing-ports" class="nomunge">Exposing ports</a></li>
  <li><a href="#persistent-volumes" class="nomunge">Persistent volumes</a></li>
  <li><a href="#secrets" class="nomunge">Secrets</a></li>
  <li><a href="#container-resources" class="nomunge">Container Resources</a></li>
  <li><a href="#healthchecks" class="nomunge">Healthchecks</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products" target="_blank" rel="noopener">製品ラインアップ</a></b></li>
                        <li><a href="https://www.docker.com/products/personal" target="_blank" rel="noopener">Docker Personal</a></li>
                        <li><a href="https://www.docker.com/products/pro" target="_blank" rel="noopener">Docker Pro</a></li>
                        <li><a href="https://www.docker.com/products/team" target="_blank" rel="noopener">Docker Team</a></li>
                        <li><a href="https://www.docker.com/products/business" target="_blank" rel="noopener">Docker Business</a></li>
                        <li><a href="https://www.docker.com/products" target="_blank" rel="noopener">サブスクリプション比較</a></li>
                        <li><b><a href="https://www.docker.com/" target="_blank" rel="noopener">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub" target="_blank" rel="noopener">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/products/secure-software-supply-chain" target="_blank" rel="noopener">セキュアなソフトウェアサプライチェーン</a></li>
                        <li><a href="https://www.docker.com/products/container-runtime" target="_blank" rel="noopener">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools" target="_blank" rel="noopener">開発ツール</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">信頼できるコンテント</a></li>
                        <li><a href="https://www.docker.com/roadmap" target="_blank" rel="noopener">Docker 製品ロードマップ</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases" target="_blank" rel="noopener">利用例</a></li>
                        <li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">はじめよう</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/docker-community" target="_blank" rel="noopener">コミュニティー</a></li>
                        <li><a href="https://www.docker.com/open-source" target="_blank" rel="noopener">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/get-involved/developer-preview" target="_blank" rel="noopener">プレビュープログラム</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq" target="_blank" rel="noopener">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs" target="_blank" rel="noopener">Docker 認定公開者向けプログラム</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">パートナー</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社概要</a></b></li>
                        <li><a href="https://www.docker.com/what-container" target="_blank" rel="noopener">コンテナーって何？</a></li>
                        <li><a href="https://www.docker.com/why-docker" target="_blank" rel="noopener">なぜ Docker？</a></li>
                        <li><a href="https://www.docker.com/events" target="_blank" rel="noopener">仮想イベント</a></li>
                        <li><a href="https://www.docker.com/swag" target="_blank" rel="noopener">Swag ストア
                        </a></li>
                        <li><a href="https://www.docker.com/company/newsroom" target="_blank" rel="noopener">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers" target="_blank" rel="noopener">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact" target="_blank" rel="noopener">連絡先</a></li>
                        <li><a href="https://www.docker.com/customers" target="_blank" rel="noopener">顧客</a></li>
                        <li><a href="https://www.docker.com/newsletter-subscription" target="_blank" rel="noopener">ニュースレター</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="https://www.docker.com/legal/docker-terms-service" target="_blank" rel="noopener">サービス契約</a></li>
                        <li><a href="https://status.docker.com/" target="_blank" rel="noopener">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal" target="_blank" rel="noopener">法的情報</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="https://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="https://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/cloud/aci-compose-features/";</script></body>
</html>
