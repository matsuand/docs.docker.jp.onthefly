<!-- Page generated 2022-02-12 10:02:02 +0900-->
<!DOCTYPE html>
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Dev 環境プレビュー | Docker ドキュメント</title>
  <meta name="description" content="Dev 環境" />
  <meta name="keywords" content="Dev Environments, share, collaborate, local">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/desktop/dev-environments/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Dev 環境プレビュー"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="Dev 環境プレビュー" />
  <meta property="og:description" content="Dev 環境" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2022-02-12T10:02:02+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/desktop/dev-environments/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2022-02-12T10:02:02+09:00"/>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","headline":"Dev 環境プレビュー","description":"Dev 環境","url":"https://docs.docker.com/desktop/dev-environments/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/desktop/">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/desktop/">Docker Desktop</a></li><li><a href="/docs.docker.jp.onthefly/desktop/dev-environments/">Dev 環境 (プレビュー)</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Dev 環境プレビュー</h1><p><em class="reading-time">読む時間の目安: 7 分</em></p><p>Dev 環境 (Dev Environments) を利用すると、開発中のコードをチームメンバー間で共有できるので、共同作業がしやすくなります。
Dev 環境を利用すれば、継続して利用する開発環境を簡単に用意できます。
そして環境の詳細な状況を、コードとともにバージョン管理できます。
また開発中のコードをチームメンバーと共有できます。
それも 1 クリックです。
Git ブランチを移動して目的のコードを取り替えたり、マージコンフリクトに悩まされるようなこともありません。</p>

<p>Dev 環境では、自分の開発環境とチームメンバーの開発環境を簡単に切り替えられます。
それも現時点での Git ブランチを移動することなく、ブランチに含まれている開発中コードの変更内容を確認することができます。</p>

<blockquote>
  <p><strong>プレビュー</strong></p>

  <p>Dev 環境機能は、現在プレビュー目的で提供されています。
この機能を本番環境において利用することはお勧めしません。</p>
</blockquote>

<p>Dev 環境にアクセスするには、Docker メニューから <strong>Dashboard</strong> &gt; <strong>Dev Environments</strong> を選びます。</p>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-create.png" alt="Dev 環境の導入" width="700px" /></p>

<h2 id="prerequisites">前提条件</h2>

<p>Dev 環境は Docker Desktop 3.5.0 リリースの一部として提供されています。
<strong>Docker Desktop 3.5.0</strong> またはそれ以降をダウンロードしてインストールしてください。</p>

<ul>
  <li><a href="/docs.docker.jp.onthefly/desktop/mac/release-notes/">Mac</a></li>
  <li><a href="/docs.docker.jp.onthefly/desktop/windows/release-notes/">Windows</a></li>
</ul>

<p>Dev 環境を使うには、以下に示すツールまたは拡張機能をインストールしておく必要があります。</p>

<ul>
  <li><a href="https://git-scm.com" target="_blank" rel="noopener" class="_">Git</a></li>
  <li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener" class="_">Visual Studio Code</a></li>
  <li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" target="_blank" rel="noopener" class="_">Visual Studio Code Remote Containers Extension</a></li>
</ul>

<p>未入手のものがあれば <strong>Install</strong> をクリックして、ダウンロードおよびインストールを行ってください。</p>

<h3 id="add-git-to-your-path-on-windows">Windows での Git のパス追加</h3>

<p>すでに Git のインストールを行ったにもかかわらず、Git が正しく認識できていない場合は、以下のコマンドを実行して、CLI または PowerShell から Git が利用できるかどうかを確認してください。</p>

<p><code class="highlighter-rouge">$ git --version</code></p>

<p>適正なコマンドとして Git が認識されない場合、Git の再インストールが必要です。
そして <strong>Adjusting your PATH environment</strong> の手順において、<strong>Git from the command line...</strong> または <strong>Use Git and optional Unix tools...</strong> を選択してください。</p>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-gitbash.png" alt="Windows 上での Git のパス追加" width="300px" /></p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>Git をインストールした後は、Docker Desktop をいったん停止して再起動する必要があります。
Docker メニューから <strong>Quit Docker Desktop</strong>（Docker Desktop の停止）を実行してから、もう一度起動してください。</p>
</blockquote>

<h2 id="start-a-single-container-dev-environment">単一コンテナーからなる Dev 環境の利用</h2>

<p>Dev 環境を利用する一番簡単な方法は、作業プロジェクトの Git リポジトリをクローンして、新たな環境を生成することです。
たとえば、GitHub リポジトリ <a href="https://github.com/dockersamples/single-dev-env" target="_blank" rel="noopener" class="_">Docker Samples</a> から単純な<code class="highlighter-rouge">single-dev-env</code>プロジェクトを使って、新たな Dev 環境を構築していくことにします。</p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>SSH を経由して Git リポジトリをクローンする場合は、ssh-agent に対して SSH 鍵を追加しておくのを忘れないでください。
これを行うには、ターミナルを開いて<code class="highlighter-rouge">ssh-add &lt;秘密鍵へのパス&gt;</code>を実行します。</p>
</blockquote>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>Docker Desktop for Windows において WSL 2 統合環境を有効にしている場合は、WSL 2 ディストリビューション内において、 SSH エージェントが稼働していることを確認してください。</p>
</blockquote>

<div class="panel panel-default">
  <div class="panel-heading collapsed" data-toggle="collapse" data-target="#collapse-wsl2-ssh" style="cursor: pointer">
WSL2 内での SSH エージェント起動方法 <em class="chevron fa fa-fw"></em>
  </div>
  <div class="collapse block" id="collapse-wsl2-ssh">
WSL 2 ディストリビューションにおいて`ssh-agent`が稼働していない場合は、以下のスクリプトを自分のプロファイル（~/.profile, ~/.zshrc, ... など）に追加してください。     <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
SSH_ENV="$HOME/.ssh/agent-environment"
function start_agent {
    echo "Initialising new SSH agent..."
    /usr/bin/ssh-agent | sed 's/^echo/#echo/' &gt; "${SSH_ENV}"
    echo succeeded
    chmod 600 "${SSH_ENV}"
    . "${SSH_ENV}" &gt; /dev/null
}
# Source SSH settings, if applicable
if [ -f "${SSH_ENV}" ]; then
    . "${SSH_ENV}" &gt; /dev/null
    ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ &gt; /dev/null || {
        start_agent;
    }
else
    start_agent;
fi
</code></pre></div>    </div>
  </div>
</div>

<ol>
  <li><strong>Create New Environment</strong> (新規環境の生成) をクリックします。
<strong>Create a Dev Environment</strong> (Dev 環境の生成) ダイアログ画面が開きます。
<code class="highlighter-rouge">https://github.com/dockersamples/single-dev-env.git</code>をコピーして、<strong>Remote Git Repository</strong> タブ内の <strong>Repository URL</strong> 欄に貼り付けます。</li>
  <li>
    <p>そして <strong>Create</strong> (生成) をクリックします。</p>

    <p>クローンされる Git コード内には、ボリュームが含まれます。
 また Dev 環境に最適なイメージが選択されます。
 そして最終的に Dev 環境コンテナー内部において VS Code が開きます。</p>
  </li>
</ol>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-container.png" alt="単一コンテナーによる Dev 環境" width="700px" /></p>

<p>上に示した例において<code class="highlighter-rouge">wizardly_ellis</code>や<code class="highlighter-rouge">relaxed_maclaren</code>はランダムに作り出された名前です。
実際に作り出した Dev 環境では、おそらく異なる名前になっているはずです。</p>

<p>コンテナーの上にマウス移動させて <strong>Open in VS Code</strong> をクリックして、いつものとおり VS Code による作業を始めます。
VS Code 内においてターミナルを開くこともできます。
そうすれば Git リポジトリに対するプッシュやプルの操作ができ、ふだん行っているようにブランチ間を切り替える操作もできるようになります。</p>

<p>アプリケーションを実行するには、VS Code のターミナル内において、コマンド<code class="highlighter-rouge">make run</code>を実行します。
これにより HTTP サーバーがポート 8080 で開きます。
ブラウザー上から <a href="http://localhost:8080">http://localhost:8080</a> にアクセスして、アプリケーションが起動していることを確認してください。</p>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-localhost.png" alt="単一コンテナーによる Dev 環境" width="700px" /></p>

<h3 id="create-a-dev-environment-from-a-specific-branch-or-tag">特定ブランチまたはタグからの Dev 環境生成</h3>

<p>Dev 環境は、特定のブランチから生成することができます （たとえばプルリクエストに対応したブランチなど）。
あるいは Git URL に対するサフィックスとして<code class="highlighter-rouge">@mybranch</code>や<code class="highlighter-rouge">@tag</code>をつけたタグからも生成することができます。</p>

<p><code class="highlighter-rouge">https://github.com/dockersamples/single-dev-env@mybranch</code></p>

<p>または</p>

<p><code class="highlighter-rouge">git@github.com:dockersamples/single-dev-env.git@mybranch</code></p>

<p>Docker はこうすることで、特定のブランチやタグからリポジトリをクローンします。</p>

<h3 id="recap">まとめ</h3>

<p>単一のコンテナーからなる Dev 環境を起動するための手順を、ここでまとめます。</p>

<ol>
  <li>はじめに Git の資格情報を利用して、コンテナー内に Git リポジトリをクローンしました。
ここにおいては、ホスト上のファイルと衝突するようなことは起こりません。</li>
  <li>このサンプルにおいて必要となる Go 言語ツールは、自動的にセットアップされています。
この際にも、ローカル環境内にあるツールとの間で衝突するような状況は起きません。</li>
  <li>最後に VS Code のターミナルを使って、アプリケーションサーバーが実行できるようになりました。
そしてホストから自動的にアクセスできるようになりました。</li>
</ol>

<h2 id="share-your-dev-environment">Dev 環境の共有</h2>

<div class="docker-upgrade-cta" role="alert">
  <div class="docker-upgrade-cta__heading">
この機能を利用するには、有償の Docker サブスクリプションが必要です。
  </div>
  <p>Docker の Pro プラン、Team プラン、Business プランのユーザーは、チームメンバー間において Dev 環境を共有できるようになりました。</p>
 <a class="btn btn-primary" role="button" href="https://www.docker.com/pricing?utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=docs_driven_upgrade" target="_blank"> 今すぐアップデート </a>
</div>

<p>環境を共有する準備が整ったら、 あとは <strong>Share</strong> (共有) ボタンをクリックして、Docker Hub の名前空間を指定するだけです。
この名前空間とは、Dev 環境をプッシュしたい対象のことです。</p>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-share.png" alt="Dev 環境の共有" width="700px" /></p>

<p>これによって Dev 環境の Docker イメージが生成されます。
そして前手順で指定した Docker Hub 名前空間内にアップロードされます。
単純な URL が提供されるので、これを使ってチームメンバーとの間で、作業環境を共有することができます。</p>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-shared.png" alt="共有された Dev 環境" width="700px" /></p>

<p>チームメンバーは <strong>Create</strong> (生成) ダイアログ画面を開きます。
<strong>Existing Dev Environment</strong> (既存の Dev 環境) タブを選び、URL を貼り付けます。
こうして起動する Dev 環境は、共有した時点での同じ環境が実現します。</p>

<p>この Dev 環境共有機能を利用すると、チームメンバーは、作業中のコード、依存パッケージ、現在の Git ブランチにアクセスすることができます。
あなたが行った変更をメンバーがレビューしたり、プルリクエスト前にフィードバックを行うこともできます。</p>

<h2 id="start-a-sample-compose-dev-environment">compose による Dev 環境例の起動</h2>

<p>Dev 環境は Docker compose を用いたプロジェクトにおいても共有利用することができます。
たとえば GitHub リポジトリ <a href="https://github.com/dockersamples/compose-dev-env" target="_blank" rel="noopener" class="_">Docker Samples</a> から<code class="highlighter-rouge">compose-dev-env</code>プロジェクトを用いることにします。</p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>SSH を経由して Git リポジトリをクローンする場合は、ssh-agent に対して SSH 鍵を追加しておくのを忘れないでください。
これを行うには、ターミナルを開いて<code class="highlighter-rouge">ssh-add &lt;秘密鍵へのパス&gt;</code>を実行します。</p>
</blockquote>

<ol>
  <li><strong>Create</strong> (生成) をクリックして <strong>Create a Dev Environment</strong> (Dev 環境の生成) ダイアログ画面を開きます。
<code class="highlighter-rouge">https://github.com/dockersamples/compose-dev-env.git</code>をコピーして、<strong>Remote</strong> タブ上の <strong>Docker image</strong> 欄に貼り付けます。</li>
  <li>
    <p><strong>Create</strong> (生成) をクリックします。
これによりプロジェクトの初期化が行われて、Git コードをクローンし、compose アプリケーションがビルドされます。
さらに以下が行われます。</p>

    <ul>
      <li>compose ファイル内に定義されているサービスのローカルイメージがビルドされます。</li>
      <li>その他のサービスに必要となるイメージがプルされます。</li>
      <li>ボリュームとネットワークが生成されます。</li>
      <li>compose スタックが起動します。</li>
    </ul>
  </li>
</ol>

<p><img src="/docs.docker.jp.onthefly/desktop/images/dev-env-compose.png" alt="compose による Dev 環境" width="700px" /></p>

<p>こうしてアプリケーションが起動しました。
ブラウザーから <a href="http://localhost:8080">http://localhost:8080</a> にアクセスして確認します。</p>

<p>compose アプリケーションの起動に要する時間は、アプリケーションの設定方法により異なります。
イメージがすでにビルドされているかどうか、サービス起動数をいくつに定義しているか、などです。</p>

<p>このときには VS Code は (単一コンテナーによる Dev 環境のときとは違って) 直接開かないことがわかるはずです。
これは複数のサービスが設定されているためです。
サービスのうちの 1 つの上にマウス移動して <strong>Open in VS Code</strong> ボタンをクリックします。
そうすると Visual Studio Code 内に指定したサービスが開きます。
この際には既存のコンテナーが停止されて、新たなコンテナーが生成されます。
このようにして VS Code 内においてサービスの開発や更新を行うことができます。</p>

<p>この後は Compose アプリケーションにおいて、サービスを更新やテストを行っていきます。</p>

<h2 id="set-up-your-own-compose-dev-environment">独自の Compose Dev 環境の設定</h2>

<p>前節では、サンプルである Compose Dev 環境の起動方法について説明しました。
独自の Compose ベースによるプロジェクトに対して Dev 環境を構築するには、追加の設定が必要になります。
Docker Desktop に対してどのようにビルドを行うのか、サービスに対してどの Dev 環境を利用するのか、といった設定です。</p>

<p>Dev 環境では、プロジェクトのルートディレクトリ配下の<code class="highlighter-rouge">.docker</code>ディレクトリに、追加の<code class="highlighter-rouge">docker-compose.yaml</code>ファイルを用意して利用します。
このファイルでは、特定サービスに必要なイメージの定義、公開するポート、今後 Dev 環境独自となる追加設定オプションを定めます。</p>

<p>ではサンプルプロジェクト <a href="https://github.com/dockersamples/compose-dev-env/blob/main/.docker/docker-compose.yaml" target="_blank" rel="noopener" class="_">compose-dev-env</a> において利用した<code class="highlighter-rouge">docker-compose.yaml</code>ファイルを見てみることにします。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">backend</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">backend</span>
      <span class="na">target</span><span class="pi">:</span> <span class="s">development</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db-password</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mariadb</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">mysqladmin"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">ping"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-h"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--silent"</span> <span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">3s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="s">5</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">30s</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db-password</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db-data:/var/lib/mysql</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MYSQL_DATABASE=example</span>
      <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD_FILE=/run/secrets/db-password</span>
    <span class="na">expose</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">3306</span>
  <span class="na">proxy</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">proxy</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">8080:80</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">db-data</span><span class="pi">:</span>
<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">db-password</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">db/password.txt</span>
</code></pre></div></div>

<p>上の yaml ファイルでは、ビルドコンテキストを<code class="highlighter-rouge">backend</code>として、コンテナーのビルドを<code class="highlighter-rouge">develoment</code>ステージを利用して行うこと (<code class="highlighter-rouge">target</code>属性による指定)、Dockerfile の配置を<code class="highlighter-rouge">backend</code>ディレクトリとすること (<code class="highlighter-rouge">context</code>属性による指定) が定義されています。</p>

<p>Dockerfile の<code class="highlighter-rouge">development</code>ステージは、以下のように定義しています。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> golang:1.16-alpine AS build</span>
<span class="k">WORKDIR</span><span class="s"> /go/src/github.com/org/repo</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">RUN </span>go build <span class="nt">-o</span> server .

<span class="k">FROM</span><span class="s"> build AS development</span>
<span class="k">RUN </span>apk update <span class="se">\
</span>    <span class="o">&amp;&amp;</span> apk add git
<span class="k">CMD</span><span class="s"> ["go", "run", "main.go"]</span>

<span class="k">FROM</span><span class="s"> alpine:3.12</span>
<span class="k">EXPOSE</span><span class="s"> 8000</span>
<span class="k">COPY</span><span class="s"> --from=build /go/src/github.com/org/repo/server /server</span>
<span class="k">CMD</span><span class="s"> ["/server"]</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">development</code>ターゲットが<code class="highlighter-rouge">golang:1.16-alpine</code>イメージを利用するので、開発に必要な依存パッケージがすべて利用できます。
VS Code からプロジェクトを直接利用でき、データベースやフロントエンドなど、他のアプリケーションやサービスと連携して作業を進められます。</p>

<p>ここに示す例では Docker Compose ファイルは同じものとします。
実際には異なる定義になっていくはずです。
またメインの Compose ファイルにて定義されたサービスが、別にビルドを行うターゲットを利用したり、別のイメージを直接参照したり、といったようにもなるでしょう。</p>

<h2 id="specify-a-dockerfile">Dockerfile の指定</h2>

<p>このプレビューでは Dev 環境を通じて、JSON ファイルを使って Dev 環境を定義する Dockerfile を指定するようにしています。
これを<code class="highlighter-rouge">.docker</code>フォルダー内に、<code class="highlighter-rouge">config.json</code>ファイルとして加える必要があります。
たとえば以下のとおりです。</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="s2">"dockerfile"</span><span class="p">:</span> <span class="s2">"Dockerfile.devenv"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>次に依存関係を含めたい場合は<code class="highlighter-rouge">Dockerfile.devenv</code>に定義しなければなりません。
そこでは以下のことが必要になります。</p>

<p>イメージや Dockerfile の中には非 root ユーザーを含むものがあるものの、多くのベースイメージや Dockerfile には含まれません。
幸いにも非 root ユーザーとして<code class="highlighter-rouge">vscode</code>というものが利用できます。
<code class="highlighter-rouge">Dockerfile.devenv</code>内に Docker ツール（たとえば<code class="highlighter-rouge">docker</code> cli, <code class="highlighter-rouge">docker compose</code>など）を含めるつもりでいた場合、<code class="highlighter-rouge">vscode</code>ユーザーは<code class="highlighter-rouge">docker</code>グループに所属させる必要が出てくるかもしれません。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>

<span class="k">FROM</span><span class="s"> &lt;your base image&gt;</span>

<span class="k">RUN </span>useradd <span class="nt">-s</span> /bin/bash <span class="nt">-m</span> vscode <span class="se">\
</span> <span class="o">&amp;&amp;</span> groupadd docker <span class="se">\
</span> <span class="o">&amp;&amp;</span> usermod <span class="nt">-aG</span> docker vscode

<span class="k">USER</span><span class="s"> vscode</span>
</code></pre></div></div>

<h2 id="specify-a-base-image">ベースイメージの指定</h2>

<p>イメージビルドをすでに行っている場合は、 それをベースイメージとして指定することで Dev 環境を定義します。
これを<code class="highlighter-rouge">.docker</code>フォルダー内に、<code class="highlighter-rouge">config.json</code>ファイルとして加える必要があります。
たとえば Jekyll ベースイメージを利用するには、以下のように追加します。</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"image"</span><span class="p">:</span> <span class="s2">"jekyll/jekyll"</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>この設定は、プレビューリリースにおいてのみ、ユーザーが利用可能なものです。
単一あるいは複数コンテナーによるアプリケーションを Compose ベースにより実現するように、この設定を将来リリースに移行する予定です。</p>

  <p>その Compose 実装に関しての議論に参加したい方は、<a href="https://dockercommunity.slack.com/messages" target="_blank" rel="noopener" class="_">Docker Community Slack</a> の <strong>#docker-dev-environments</strong> チャネルに参加してください。
または GitHub リポジトリ <a href="https://github.com/docker/dev-environments/issues" target="_blank" rel="noopener" class="_">Dev Environments</a> に issue を生成して、フードバックしてください。</p>
</blockquote>

<h2 id="start-a-dev-environment-from-a-local-folder">ローカルフォルダーからの Dev 環境の起動</h2>

<p>自分のマシン上にあるローカルコードから Dev 環境を起動することもできます。</p>

<ol>
  <li><strong>Create</strong> (生成) をクリックして <strong>Create a Dev Environment</strong> (Dev 環境の生成) ダイアログ画面を開きます。
<strong>Local Folder</strong> タブを選び、<strong>Select directory</strong> (ディレクトリの選択) をクリックします。
そして作業対象とするコードのルートディレクトリを開きます。</li>
  <li>
    <p><strong>Create</strong> (生成) をクリックします。</p>

    <p>This creates a Dev Environment using your local folder, and bind-mounts your local code in the Dev Environment. Finally, it opens VS Code inside the Dev Environment container.</p>
  </li>
</ol>

<blockquote>
  <p><strong>Note</strong></p>

  <p>When using a local folder for a Dev Environment, file changes are synchronized between your Dev Environment container and your local files. This can affect the performance inside the container, depending on the number of files in your local folder and the operations performed in the container.</p>
</blockquote>

<h2 id="known-issues">既知の問題</h2>

<p>この節では、Dev 環境プレビューにおける既知の問題とその解決方法について一覧に示します。</p>

<ol>
  <li>今のところ Dev 環境では、Compose ベースのアプリケーションを共有することはできません。
レジストリが Compose アプリケーションをサポートしていないためです。
<a href="#feedback">フィードバック</a> の節を参考にして、Compose ベースアプリケーションに関するご要望をお知らせください。</li>
  <li>Mac と Windows の間で Dev 環境を共有する場合、
VS Code のターミナルが適切に動作しないことがあります。
この問題を解消するには、Docker Dashboard において CLI オプションの Exec を利用してください。</li>
  <li>ARM64 と AMD64 のマシン間において Dev 環境を共有する場合、この環境はエミュレート処理が行われます。</li>
</ol>

<h2 id="feedback">フィードバック</h2>

<p>みなさんが Dev 環境プレビューをお使いいただければ、大変うれしく思います。
是非感想をお聞かせください。</p>

<p>GitHub リポジトリ <a href="https://github.com/docker/dev-environments/issues" target="_blank" rel="noopener" class="_">Dev Environments</a> に issue を生成していただければ、フィードバックとして確認いたします。
または <a href="https://dockercommunity.slack.com/messages" target="_blank" rel="noopener" class="_">Docker Community Slack</a> における <strong>#docker-dev-environments</strong> チャネルを通じてご連絡ください。</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=Dev Environments">Dev Environments</a>, <a href="/docs.docker.jp.onthefly/search/?q=share">share</a>, <a href="/docs.docker.jp.onthefly/search/?q=collaborate">collaborate</a>, <a href="/docs.docker.jp.onthefly/search/?q=local">local</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/desktop/dev-environments.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [desktop/dev-environments.ch](https://matsuand.github.io/docs.docker.jp.onthefly/desktop/dev-environments/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#prerequisites" class="nomunge">前提条件</a>
    <ul>
      <li><a href="#start-a-single-container-dev-environment" class="nomunge">単一コンテナーからなる Dev 環境の利用</a></li>
      <li><a href="#share-your-dev-environment" class="nomunge">Dev 環境の共有</a></li>
      <li><a href="#start-a-sample-compose-dev-environment" class="nomunge">compose による Dev 環境例の起動</a></li>
      <li><a href="#set-up-your-own-compose-dev-environment" class="nomunge">独自の Compose Dev 環境の設定</a></li>
      <li><a href="#specify-a-dockerfile" class="nomunge">Dockerfile の指定</a></li>
      <li><a href="#specify-a-base-image" class="nomunge">ベースイメージの指定</a></li>
      <li><a href="#start-a-dev-environment-from-a-local-folder" class="nomunge">ローカルフォルダーからの Dev 環境の起動</a></li>
      <li><a href="#known-issues" class="nomunge">既知の問題</a></li>
      <li><a href="#feedback" class="nomunge">フィードバック</a></li>
    </ul>
  </li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products" target="_blank" rel="noopener">製品ラインアップ</a></b></li>
                        <li><a href="https://www.docker.com/products/personal" target="_blank" rel="noopener">Docker Personal</a></li>
                        <li><a href="https://www.docker.com/products/pro" target="_blank" rel="noopener">Docker Pro</a></li>
                        <li><a href="https://www.docker.com/products/team" target="_blank" rel="noopener">Docker Team</a></li>
                        <li><a href="https://www.docker.com/products/business" target="_blank" rel="noopener">Docker Business</a></li>
                        <li><a href="https://www.docker.com/products" target="_blank" rel="noopener">サブスクリプション比較</a></li>
                        <li><b><a href="https://www.docker.com/" target="_blank" rel="noopener">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub" target="_blank" rel="noopener">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/products/secure-software-supply-chain" target="_blank" rel="noopener">セキュアなソフトウェアサプライチェーン</a></li>
                        <li><a href="https://www.docker.com/products/container-runtime" target="_blank" rel="noopener">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools" target="_blank" rel="noopener">開発ツール</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">信頼できるコンテント</a></li>
                        <li><a href="https://www.docker.com/roadmap" target="_blank" rel="noopener">Docker 製品ロードマップ</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases" target="_blank" rel="noopener">利用例</a></li>
                        <li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">はじめよう</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/docker-community" target="_blank" rel="noopener">コミュニティー</a></li>
                        <li><a href="https://www.docker.com/open-source" target="_blank" rel="noopener">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/get-involved/developer-preview" target="_blank" rel="noopener">プレビュープログラム</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq" target="_blank" rel="noopener">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs" target="_blank" rel="noopener">Docker 認定公開者向けプログラム</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">パートナー</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社概要</a></b></li>
                        <li><a href="https://www.docker.com/what-container" target="_blank" rel="noopener">コンテナーって何？</a></li>
                        <li><a href="https://www.docker.com/why-docker" target="_blank" rel="noopener">なぜ Docker？</a></li>
                        <li><a href="https://www.docker.com/events" target="_blank" rel="noopener">仮想イベント</a></li>
                        <li><a href="https://www.docker.com/swag" target="_blank" rel="noopener">Swag ストア
                        </a></li>
                        <li><a href="https://www.docker.com/company/newsroom" target="_blank" rel="noopener">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers" target="_blank" rel="noopener">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact" target="_blank" rel="noopener">連絡先</a></li>
                        <li><a href="https://www.docker.com/customers" target="_blank" rel="noopener">顧客</a></li>
                        <li><a href="https://www.docker.com/newsletter-subscription" target="_blank" rel="noopener">ニュースレター</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="https://www.docker.com/legal/docker-terms-service" target="_blank" rel="noopener">サービス契約</a></li>
                        <li><a href="https://status.docker.com/" target="_blank" rel="noopener">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal" target="_blank" rel="noopener">法的情報</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="https://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="https://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/desktop/dev-environments/";</script></body>
</html>
