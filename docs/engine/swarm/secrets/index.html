<!-- Page generated 2021-09-11 14:21:28 +0900-->
<!DOCTYPE html>
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Docker secrets を使った機密情報の管理 | Docker ドキュメント</title>
  <meta name="description" content="How to securely store, retrieve, and use sensitive data with Docker services" />
  <meta name="keywords" content="swarm, secrets, credentials, sensitive strings, sensitive data, security, encryption, encryption at rest">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/engine/swarm/secrets/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Docker secrets を使った機密情報の管理"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="Docker secrets を使った機密情報の管理" />
  <meta property="og:description" content="How to securely store, retrieve, and use sensitive data with Docker services" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-09-11T14:21:28+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/secrets/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-09-11T14:21:28+09:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Docker secrets を使った機密情報の管理","description":"How to securely store, retrieve, and use sensitive data with Docker services","url":"https://docs.docker.com/engine/swarm/secrets/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/get-started/overview/">ガイド</a></li><li><a>本番環境でのアプリ運用</a></li><li><a href="/docs.docker.jp.onthefly/config/containers/start-containers-automatically/">コンテナーの設定</a></li><li><a href="/docs.docker.jp.onthefly/engine/swarm/">アプリのスケーリング</a></li><li><a href="/docs.docker.jp.onthefly/engine/swarm/secrets/">Manage sensitive data with Docker secrets</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Docker secrets を使った機密情報の管理</h1><p><em class="reading-time">読む時間の目安: 36 分</em></p><h2 id="about-secrets">secrets について</h2>

<p>Docker Swarm サービスにおいて secret とは、パスワード、SSH 秘密鍵、SSL 証明書などのようなデータ
In terms of Docker Swarm services, a <em>secret</em> is a blob of data, such as a
password, SSH private key, SSL certificate, or another piece of data that should
not be transmitted over a network or stored unencrypted in a Dockerfile or in
your application’s source code. You can use Docker <em>secrets</em> to centrally manage
this data and securely transmit it to only those containers that need access to
it. Secrets are encrypted during transit and at rest in a Docker swarm. A given
secret is only accessible to those services which have been granted explicit
access to it, and only while those service tasks are running.</p>

<p>You can use secrets to manage any sensitive data which a container needs at
runtime but you don’t want to store in the image or in source control, such as:</p>

<ul>
  <li>Usernames and passwords</li>
  <li>TLS certificates and keys</li>
  <li>SSH keys</li>
  <li>Other important data such as the name of a database or internal server</li>
  <li>Generic strings or binary content (up to 500 kb in size)</li>
</ul>

<blockquote>
  <p><strong>Note</strong>: Docker secrets are only available to swarm services, not to
standalone containers. To use this feature, consider adapting your container
to run as a service. Stateful containers can typically run with a scale of 1
without changing the container code.</p>
</blockquote>

<p>Another use case for using secrets is to provide a layer of abstraction between
the container and a set of credentials. Consider a scenario where you have
separate development, test, and production environments for your application.
Each of these environments can have different credentials, stored in the
development, test, and production swarms with the same secret name. Your
containers only need to know the name of the secret to function in all
three environments.</p>

<p>You can also use secrets to manage non-sensitive data, such as configuration
files. However, Docker supports the use of <a href="/docs.docker.jp.onthefly/engine/swarm/configs/">configs</a>
for storing non-sensitive data. Configs are mounted into the container’s
filesystem directly, without the use of a RAM disk.</p>

<h3 id="windows-support">Windows support</h3>

<p>Docker includes support for secrets on Windows containers. Where there are
differences in the implementations, they are called out in the
examples below. Keep the following notable differences in mind:</p>

<ul>
  <li>
    <p>Microsoft Windows has no built-in driver for managing RAM disks, so within
running Windows containers, secrets <strong>are</strong> persisted in clear text to the
container’s root disk. However, the secrets are explicitly removed when a
container stops. In addition, Windows does not support persisting a running
container as an image using <code class="language-plaintext highlighter-rouge">docker commit</code> or similar commands.</p>
  </li>
  <li>
    <p>On Windows, we recommend enabling
<a href="https://technet.microsoft.com/en-us/library/cc732774(v=ws.11).aspx">BitLocker</a>
on the volume containing the Docker root directory on the host machine to
ensure that secrets for running containers are encrypted at rest.</p>
  </li>
  <li>
    <p>Secret files with custom targets are not directly bind-mounted into Windows
containers, since Windows does not support non-directory file bind-mounts.
Instead, secrets for a container are all mounted in
<code class="language-plaintext highlighter-rouge">C:\ProgramData\Docker\internal\secrets</code> (an implementation detail which
should not be relied upon by applications) within the container. Symbolic
links are used to point from there to the desired target of the secret within
the container. The default target is <code class="language-plaintext highlighter-rouge">C:\ProgramData\Docker\secrets</code>.</p>
  </li>
  <li>
    <p>When creating a service which uses Windows containers, the options to specify
UID, GID, and mode are not supported for secrets. Secrets are currently only
accessible by administrators and users with <code class="language-plaintext highlighter-rouge">system</code> access within the
container.</p>
  </li>
</ul>

<h2 id="how-docker-manages-secrets">How Docker manages secrets</h2>

<p>When you add a secret to the swarm, Docker sends the secret to the swarm manager
over a mutual TLS connection. The secret is stored in the Raft log, which is
encrypted. The entire Raft log is replicated across the other managers, ensuring
the same high availability guarantees for secrets as for the rest of the swarm
management data.</p>

<p>When you grant a newly-created or running service access to a secret, the
decrypted secret is mounted into the container in an in-memory filesystem. The
location of the mount point within the container defaults to
<code class="language-plaintext highlighter-rouge">/run/secrets/&lt;secret_name&gt;</code> in Linux containers, or
<code class="language-plaintext highlighter-rouge">C:\ProgramData\Docker\secrets</code> in Windows containers. You can also specify a
custom location.</p>

<p>You can update a service to grant it access to additional secrets or revoke its
access to a given secret at any time.</p>

<p>A node only has access to (encrypted) secrets if the node is a swarm manager or
if it is running service tasks which have been granted access to the secret.
When a container task stops running, the decrypted secrets shared to it are
unmounted from the in-memory filesystem for that container and flushed from the
node’s memory.</p>

<p>If a node loses connectivity to the swarm while it is running a task container
with access to a secret, the task container still has access to its secrets, but
cannot receive updates until the node reconnects to the swarm.</p>

<p>You can add or inspect an individual secret at any time, or list all
secrets. You cannot remove a secret that a running service is
using. See <a href="/docs.docker.jp.onthefly/engine/swarm/secrets/#example-rotate-a-secret">Rotate a secret</a> for a way to
remove a secret without disrupting running services.</p>

<p>To update or roll back secrets more easily, consider adding a version
number or date to the secret name. This is made easier by the ability to control
the mount point of the secret within a given container.</p>

<h2 id="read-more-about-docker-secret-commands">Read more about <code class="language-plaintext highlighter-rouge">docker secret</code> commands</h2>

<p>Use these links to read about specific commands, or continue to the
<a href="/docs.docker.jp.onthefly/engine/swarm/secrets/#example-use-secrets-with-a-service">example about using secrets with a service</a>.</p>

<ul>
  <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/secret_create/"><code class="language-plaintext highlighter-rouge">docker secret create</code></a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/secret_inspect/"><code class="language-plaintext highlighter-rouge">docker secret inspect</code></a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/secret_ls/"><code class="language-plaintext highlighter-rouge">docker secret ls</code></a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/secret_rm/"><code class="language-plaintext highlighter-rouge">docker secret rm</code></a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/service_create/#create-a-service-with-secrets"><code class="language-plaintext highlighter-rouge">--secret</code></a> flag for <code class="language-plaintext highlighter-rouge">docker service create</code></li>
  <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/service_update/#adding-and-removing-secrets"><code class="language-plaintext highlighter-rouge">--secret-add</code> and <code class="language-plaintext highlighter-rouge">--secret-rm</code></a> flags for <code class="language-plaintext highlighter-rouge">docker service update</code></li>
</ul>

<h2 id="examples">Examples</h2>

<p>This section includes three graduated examples which illustrate how to use
Docker secrets. The images used in these examples have been updated to make it
easier to use Docker secrets. To find out how to modify your own images in
a similar way, see
<a href="#build-support-for-docker-secrets-into-your-images">Build support for Docker Secrets into your images</a>.</p>

<blockquote>
  <p><strong>Note</strong>: These examples use a single-Engine swarm and unscaled services for
simplicity. The examples use Linux containers, but Windows containers also
support secrets. See <a href="#windows-support">Windows support</a>.</p>
</blockquote>

<h3 id="defining-and-using-secrets-in-compose-files">Defining and using secrets in compose files</h3>

<p>Both the <code class="language-plaintext highlighter-rouge">docker-compose</code> and <code class="language-plaintext highlighter-rouge">docker stack</code> commands support defining secrets
in a compose file. See
<a href="/docs.docker.jp.onthefly/compose/compose-file/compose-file-v3/#secrets">the Compose file reference</a> for details.</p>

<h3 id="simple-example-get-started-with-secrets">Simple example: Get started with secrets</h3>

<p>This simple example shows how secrets work in just a few commands. For a
real-world example, continue to
<a href="#intermediate-example-use-secrets-with-a-nginx-service">Intermediate example: Use secrets with a Nginx service</a>.</p>

<ol>
  <li>
    <p>Add a secret to Docker. The <code class="language-plaintext highlighter-rouge">docker secret create</code> command reads standard
input because the last argument, which represents the file to read the
secret from, is set to <code class="language-plaintext highlighter-rouge">-</code>.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">printf</span> <span class="s2">"This is a secret"</span> | docker secret create my_secret_data -
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a <code class="language-plaintext highlighter-rouge">redis</code> service and grant it access to the secret. By default,
the container can access the secret at <code class="language-plaintext highlighter-rouge">/run/secrets/&lt;secret_name&gt;</code>, but
you can customize the file name on the container using the <code class="language-plaintext highlighter-rouge">target</code> option.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service  create <span class="nt">--name</span> redis <span class="nt">--secret</span> my_secret_data redis:alpine
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that the task is running without issues using <code class="language-plaintext highlighter-rouge">docker service ps</code>. If
everything is working, the output looks similar to this:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service ps redis
<span class="go">
ID            NAME     IMAGE         NODE              DESIRED STATE  CURRENT STATE          ERROR  PORTS
bkna6bpn8r1a  redis.1  redis:alpine  ip-172-31-46-109  Running        Running 8 seconds ago
</span></code></pre></div>    </div>

    <p>If there were an error, and the task were failing and repeatedly restarting,
you would see something like this:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service ps redis
<span class="go">
NAME                      IMAGE         NODE  DESIRED STATE  CURRENT STATE          ERROR                      PORTS
redis.1.siftice35gla      redis:alpine  moby  Running        Running 4 seconds ago
 \_ redis.1.whum5b7gu13e  redis:alpine  moby  Shutdown       Failed 20 seconds ago      "task: non-zero exit (1)"
 \_ redis.1.2s6yorvd9zow  redis:alpine  moby  Shutdown       Failed 56 seconds ago      "task: non-zero exit (1)"
 \_ redis.1.ulfzrcyaf6pg  redis:alpine  moby  Shutdown       Failed about a minute ago  "task: non-zero exit (1)"
 \_ redis.1.wrny5v4xyps6  redis:alpine  moby  Shutdown       Failed 2 minutes ago       "task: non-zero exit (1)"
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Get the ID of the <code class="language-plaintext highlighter-rouge">redis</code> service task container using <code class="language-plaintext highlighter-rouge">docker ps</code> , so that
you can use <code class="language-plaintext highlighter-rouge">docker container exec</code> to connect to the container and read the contents
of the secret data file, which defaults to being readable by all and has the
same name as the name of the secret. The first command below illustrates
how to find the container ID, and the second and third commands use shell
completion to do this automatically.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker ps <span class="nt">--filter</span> <span class="nv">name</span><span class="o">=</span>redis <span class="nt">-q</span>
<span class="go">
5cb1c2348a59

</span><span class="gp">$</span><span class="w"> </span>docker container <span class="nb">exec</span> <span class="si">$(</span>docker ps <span class="nt">--filter</span> <span class="nv">name</span><span class="o">=</span>redis <span class="nt">-q</span><span class="si">)</span> <span class="nb">ls</span> <span class="nt">-l</span> /run/secrets
<span class="go">
total 4
-r--r--r--    1 root     root            17 Dec 13 22:48 my_secret_data

</span><span class="gp">$</span><span class="w"> </span>docker container <span class="nb">exec</span> <span class="si">$(</span>docker ps <span class="nt">--filter</span> <span class="nv">name</span><span class="o">=</span>redis <span class="nt">-q</span><span class="si">)</span> <span class="nb">cat</span> /run/secrets/my_secret_data
<span class="go">
This is a secret
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that the secret is <strong>not</strong> available if you commit the container.</p>

    <pre><code class="language-none">$ docker commit $(docker ps --filter name=redis -q) committed_redis

$ docker run --rm -it committed_redis cat /run/secrets/my_secret_data

cat: can't open '/run/secrets/my_secret_data': No such file or directory
</code></pre>
  </li>
  <li>
    <p>Try removing the secret. The removal fails because the <code class="language-plaintext highlighter-rouge">redis</code> service is
running and has access to the secret.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">ls</span>
<span class="go">
ID                          NAME                CREATED             UPDATED
wwwrxza8sxy025bas86593fqs   my_secret_data      4 hours ago         4 hours ago


</span><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">rm </span>my_secret_data
<span class="go">
Error response from daemon: rpc error: code = 3 desc = secret
'my_secret_data' is in use by the following service: redis
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Remove access to the secret from the running <code class="language-plaintext highlighter-rouge">redis</code> service by updating the
service.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service update <span class="nt">--secret-rm</span> my_secret_data redis
</code></pre></div>    </div>
  </li>
  <li>
    <p>Repeat steps 3 and 4 again, verifying that the service no longer has access
to the secret. The container ID is different, because the
<code class="language-plaintext highlighter-rouge">service update</code> command redeploys the service.</p>

    <pre><code class="language-none">$ docker container exec -it $(docker ps --filter name=redis -q) cat /run/secrets/my_secret_data

cat: can't open '/run/secrets/my_secret_data': No such file or directory
</code></pre>
  </li>
  <li>
    <p>Stop and remove the service, and remove the secret from Docker.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service <span class="nb">rm </span>redis
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">rm </span>my_secret_data
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="simple-example-use-secrets-in-a-windows-service">Simple example: Use secrets in a Windows service</h3>

<p>This is a very simple example which shows how to use secrets with a Microsoft
IIS service running on Docker for Windows running Windows containers on
Microsoft Windows 10. It is a naive example that stores the webpage in a secret.</p>

<p>This example assumes that you have PowerShell installed.</p>

<ol>
  <li>
    <p>Save the following into a new file <code class="language-plaintext highlighter-rouge">index.html</code>.</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;&lt;title&gt;</span>Hello Docker<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Hello Docker! You have deployed a HTML page.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you have not already done so, initialize or join the swarm.</p>

    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">docker</span><span class="w"> </span><span class="nx">swarm</span><span class="w"> </span><span class="nx">init</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Save the <code class="language-plaintext highlighter-rouge">index.html</code> file as a swarm secret named <code class="language-plaintext highlighter-rouge">homepage</code>.</p>

    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">docker</span><span class="w"> </span><span class="nx">secret</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">homepage</span><span class="w"> </span><span class="nx">index.html</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Create an IIS service and grant it access to the <code class="language-plaintext highlighter-rouge">homepage</code> secret.</p>

    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">docker</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="nx">create</span><span class="w">
    </span><span class="nt">--name</span><span class="w"> </span><span class="nf">my-iis</span><span class="w">
    </span><span class="nt">--publish</span><span class="w"> </span><span class="nx">published</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span><span class="nf">target</span><span class="o">=</span><span class="mi">8000</span><span class="w">
    </span><span class="nt">--secret</span><span class="w"> </span><span class="nf">src</span><span class="o">=</span><span class="nf">homepage</span><span class="p">,</span><span class="nx">target</span><span class="o">=</span><span class="s2">"\inetpub\wwwroot\index.html"</span><span class="w">
    </span><span class="nf">microsoft/iis:nanoserver</span><span class="w">
</span></code></pre></div>    </div>

    <blockquote>
      <p><strong>Note</strong>: There is technically no reason to use secrets for this
example; <a href="/docs.docker.jp.onthefly/engine/swarm/configs/">configs</a> are a better fit. This example is
for illustration only.</p>
    </blockquote>
  </li>
  <li>
    <p>Access the IIS service at <code class="language-plaintext highlighter-rouge">http://localhost:8000/</code>. It should serve
the HTML content from the first step.</p>
  </li>
  <li>
    <p>Remove the service and the secret.</p>

    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">docker</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="nx">rm</span><span class="w"> </span><span class="nx">my-iis</span><span class="w">
</span><span class="nf">docker</span><span class="w"> </span><span class="nx">secret</span><span class="w"> </span><span class="nx">rm</span><span class="w"> </span><span class="nx">homepage</span><span class="w">
</span><span class="nf">docker</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">remove</span><span class="w"> </span><span class="nx">secret-test</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ol>

<h3 id="intermediate-example-use-secrets-with-a-nginx-service">Intermediate example: Use secrets with a Nginx service</h3>

<p>This example is divided into two parts.
<a href="#generate-the-site-certificate">The first part</a> is all about generating
the site certificate and does not directly involve Docker secrets at all, but
it sets up <a href="#configure-the-nginx-container">the second part</a>, where you store
and use the site certificate and Nginx configuration as secrets.</p>

<h4 id="generate-the-site-certificate">Generate the site certificate</h4>

<p>Generate a root CA and TLS certificate and key for your site. For production
sites, you may want to use a service such as <code class="language-plaintext highlighter-rouge">Let’s Encrypt</code> to generate the
TLS certificate and key, but this example uses command-line tools. This step
is a little complicated, but is only a set-up step so that you have
something to store as a Docker secret. If you want to skip these sub-steps,
you can <a href="https://letsencrypt.org/getting-started/">use Let’s Encrypt</a> to
generate the site key and certificate, name the files <code class="language-plaintext highlighter-rouge">site.key</code> and
<code class="language-plaintext highlighter-rouge">site.crt</code>, and skip to
<a href="#configure-the-nginx-container">Configure the Nginx container</a>.</p>

<ol>
  <li>
    <p>Generate a root key.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl genrsa <span class="nt">-out</span> <span class="s2">"root-ca.key"</span> 4096
</code></pre></div>    </div>
  </li>
  <li>
    <p>Generate a CSR using the root key.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl req <span class="se">\</span>
          <span class="nt">-new</span> <span class="nt">-key</span> <span class="s2">"root-ca.key"</span> <span class="se">\</span>
          <span class="nt">-out</span> <span class="s2">"root-ca.csr"</span> <span class="nt">-sha256</span> <span class="se">\</span>
          <span class="nt">-subj</span> <span class="s1">'/C=US/ST=CA/L=San Francisco/O=Docker/CN=Swarm Secret Example CA'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configure the root CA. Edit a new file called <code class="language-plaintext highlighter-rouge">root-ca.cnf</code> and paste
the following contents into it. This constrains the root CA to signing leaf
certificates and not intermediate CAs.</p>

    <pre><code class="language-none">[root_ca]
basicConstraints = critical,CA:TRUE,pathlen:1
keyUsage = critical, nonRepudiation, cRLSign, keyCertSign
subjectKeyIdentifier=hash
</code></pre>
  </li>
  <li>
    <p>Sign the certificate.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-req</span>  <span class="nt">-days</span> 3650  <span class="nt">-in</span> <span class="s2">"root-ca.csr"</span> <span class="se">\</span>
               <span class="nt">-signkey</span> <span class="s2">"root-ca.key"</span> <span class="nt">-sha256</span> <span class="nt">-out</span> <span class="s2">"root-ca.crt"</span> <span class="se">\</span>
               <span class="nt">-extfile</span> <span class="s2">"root-ca.cnf"</span> <span class="nt">-extensions</span> <span class="se">\</span>
               root_ca
</code></pre></div>    </div>
  </li>
  <li>
    <p>Generate the site key.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl genrsa <span class="nt">-out</span> <span class="s2">"site.key"</span> 4096
</code></pre></div>    </div>
  </li>
  <li>
    <p>Generate the site certificate and sign it with the site key.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-new</span> <span class="nt">-key</span> <span class="s2">"site.key"</span> <span class="nt">-out</span> <span class="s2">"site.csr"</span> <span class="nt">-sha256</span> <span class="se">\</span>
          <span class="nt">-subj</span> <span class="s1">'/C=US/ST=CA/L=San Francisco/O=Docker/CN=localhost'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configure the site certificate. Edit a new file  called <code class="language-plaintext highlighter-rouge">site.cnf</code> and
paste the following contents into it. This constrains the site
certificate so that it can only be used to authenticate a server and
can’t be used to sign certificates.</p>

    <pre><code class="language-none">[server]
authorityKeyIdentifier=keyid,issuer
basicConstraints = critical,CA:FALSE
extendedKeyUsage=serverAuth
keyUsage = critical, digitalSignature, keyEncipherment
subjectAltName = DNS:localhost, IP:127.0.0.1
subjectKeyIdentifier=hash
</code></pre>
  </li>
  <li>
    <p>Sign the site certificate.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-req</span> <span class="nt">-days</span> 750 <span class="nt">-in</span> <span class="s2">"site.csr"</span> <span class="nt">-sha256</span> <span class="se">\</span>
    <span class="nt">-CA</span> <span class="s2">"root-ca.crt"</span> <span class="nt">-CAkey</span> <span class="s2">"root-ca.key"</span>  <span class="nt">-CAcreateserial</span> <span class="se">\</span>
    <span class="nt">-out</span> <span class="s2">"site.crt"</span> <span class="nt">-extfile</span> <span class="s2">"site.cnf"</span> <span class="nt">-extensions</span> server
</code></pre></div>    </div>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">site.csr</code> and <code class="language-plaintext highlighter-rouge">site.cnf</code> files are not needed by the Nginx service, but
you need them if you want to generate a new site certificate. Protect
the <code class="language-plaintext highlighter-rouge">root-ca.key</code> file.</p>
  </li>
</ol>

<h4 id="configure-the-nginx-container">Configure the Nginx container</h4>

<ol>
  <li>
    <p>Produce a very basic Nginx configuration that serves static files over HTTPS.
The TLS certificate and key are stored as Docker secrets so that they
can be rotated easily.</p>

    <p>In the current directory, create a new file called <code class="language-plaintext highlighter-rouge">site.conf</code> with the
following contents:</p>

    <pre><code class="language-none">server {
    listen                443 ssl;
    server_name           localhost;
    ssl_certificate       /run/secrets/site.crt;
    ssl_certificate_key   /run/secrets/site.key;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
}
</code></pre>
  </li>
  <li>
    <p>Create three secrets, representing the key, the certificate, and the
<code class="language-plaintext highlighter-rouge">site.conf</code>. You can store any file as a secret as long as it is smaller
than 500 KB. This allows you to decouple the key, certificate, and
configuration from the services that use them. In each of these
commands, the last argument represents the path to the file to read the
secret from on the host machine’s filesystem. In these examples, the secret
name and the file name are the same.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker secret create site.key site.key
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker secret create site.crt site.crt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker secret create site.conf site.conf
</code></pre></div>    </div>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">ls</span>
<span class="go">
ID                          NAME                  CREATED             UPDATED
2hvoi9mnnaof7olr3z5g3g7fp   site.key       58 seconds ago      58 seconds ago
aya1dh363719pkiuoldpter4b   site.crt       24 seconds ago      24 seconds ago
zoa5df26f7vpcoz42qf2csth8   site.conf      11 seconds ago      11 seconds ago
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Create a service that runs Nginx and has access to the three secrets. The
last part of the <code class="language-plaintext highlighter-rouge">docker service create</code> command creates a symbolic link
from the location of the <code class="language-plaintext highlighter-rouge">site.conf</code> secret to <code class="language-plaintext highlighter-rouge">/etc/nginx.conf.d/</code>, where
Nginx looks for extra configuration files. This step happens before Nginx
actually starts, so you don’t need to rebuild your image if you change the
Nginx configuration.</p>

    <blockquote>
      <p><strong>Note</strong>: Normally you would create a Dockerfile which copies the <code class="language-plaintext highlighter-rouge">site.conf</code>
into place, build the image, and run a container using your custom image.
This example does not require a custom image. It puts the <code class="language-plaintext highlighter-rouge">site.conf</code>
into place and runs the container all in one step.</p>
    </blockquote>

    <p>Secrets are located within the <code class="language-plaintext highlighter-rouge">/run/secrets/</code> directory in the container
by default, which may require extra steps in the container to make the
secret available in a different path. The example below creates a symbolic
link to the true location of the <code class="language-plaintext highlighter-rouge">site.conf</code> file so that Nginx can read it:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service create <span class="se">\</span>
     <span class="nt">--name</span> nginx <span class="se">\</span>
     <span class="nt">--secret</span> site.key <span class="se">\</span>
     <span class="nt">--secret</span> site.crt <span class="se">\</span>
     <span class="nt">--secret</span> site.conf <span class="se">\</span>
     <span class="nt">--publish</span> <span class="nv">published</span><span class="o">=</span>3000,target<span class="o">=</span>443 <span class="se">\</span>
     nginx:latest <span class="se">\</span>
     sh <span class="nt">-c</span> <span class="s2">"ln -s /run/secrets/site.conf /etc/nginx/conf.d/site.conf &amp;&amp; exec nginx -g 'daemon off;'"</span>
</code></pre></div>    </div>

    <p>Instead of creating symlinks, secrets allow you to specify a custom location
using the <code class="language-plaintext highlighter-rouge">target</code> option. The example below illustrates how the <code class="language-plaintext highlighter-rouge">site.conf</code>
secret is made available at <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/site.conf</code> inside the container
without the use of symbolic links:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service create <span class="se">\</span>
     <span class="nt">--name</span> nginx <span class="se">\</span>
     <span class="nt">--secret</span> site.key <span class="se">\</span>
     <span class="nt">--secret</span> site.crt <span class="se">\</span>
     <span class="nt">--secret</span> <span class="nb">source</span><span class="o">=</span>site.conf,target<span class="o">=</span>/etc/nginx/conf.d/site.conf <span class="se">\</span>
     <span class="nt">--publish</span> <span class="nv">published</span><span class="o">=</span>3000,target<span class="o">=</span>443 <span class="se">\</span>
     nginx:latest <span class="se">\</span>
     sh <span class="nt">-c</span> <span class="s2">"exec nginx -g 'daemon off;'"</span>
</code></pre></div>    </div>

    <p>The <code class="language-plaintext highlighter-rouge">site.key</code> and <code class="language-plaintext highlighter-rouge">site.crt</code> secrets use the short-hand syntax, without a
custom <code class="language-plaintext highlighter-rouge">target</code> location set. The short syntax mounts the secrets in `/run/secrets/
with the same name as the secret. Within the running containers, the following
three files now exist:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">/run/secrets/site.key</code></li>
      <li><code class="language-plaintext highlighter-rouge">/run/secrets/site.crt</code></li>
      <li><code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/site.conf</code></li>
    </ul>
  </li>
  <li>
    <p>Verify that the Nginx service is running.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service <span class="nb">ls</span>
<span class="go">
ID            NAME   MODE        REPLICAS  IMAGE
zeskcec62q24  nginx  replicated  1/1       nginx:latest

</span><span class="gp">$</span><span class="w"> </span>docker service ps nginx
<span class="go">
NAME                  IMAGE         NODE  DESIRED STATE  CURRENT STATE          ERROR  PORTS
nginx.1.9ls3yo9ugcls  nginx:latest  moby  Running        Running 3 minutes ago
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that the service is operational: you can reach the Nginx
server, and that the correct TLS certificate is being used.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>curl <span class="nt">--cacert</span> root-ca.crt https://localhost:3000
<span class="go">
</span><span class="gp">&lt;!DOCTYPE html&gt;</span><span class="w">
</span><span class="gp">&lt;html&gt;</span><span class="w">
</span><span class="gp">&lt;head&gt;</span><span class="w">
</span><span class="gp">&lt;title&gt;</span>Welcome to nginx!&lt;/title&gt;
<span class="gp">&lt;style&gt;</span><span class="w">
</span><span class="go">    body {
</span><span class="gp">        width: 35em;</span><span class="w">
</span><span class="gp">        margin: 0 auto;</span><span class="w">
</span><span class="gp">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><span class="w">
</span><span class="go">    }
</span><span class="gp">&lt;/style&gt;</span><span class="w">
</span><span class="gp">&lt;/head&gt;</span><span class="w">
</span><span class="gp">&lt;body&gt;</span><span class="w">
</span><span class="gp">&lt;h1&gt;</span>Welcome to nginx!&lt;/h1&gt;
<span class="gp">&lt;p&gt;</span>If you see this page, the nginx web server is successfully installed and
<span class="gp">working. Further configuration is required.&lt;/p&gt;</span><span class="w">
</span><span class="go">
</span><span class="gp">&lt;p&gt;</span>For online documentation and support. refer to
<span class="gp">&lt;a href="https://nginx.org"&gt;</span>nginx.org&lt;/a&gt;.&lt;br/&gt;
<span class="go">Commercial support is available at
</span><span class="gp">&lt;a href="https://www.nginx.com"&gt;</span>www.nginx.com&lt;/a&gt;.&lt;/p&gt;
<span class="go">
</span><span class="gp">&lt;p&gt;</span>&lt;em&gt;Thank you <span class="k">for </span>using nginx.&lt;/em&gt;&lt;/p&gt;
<span class="gp">&lt;/body&gt;</span><span class="w">
</span><span class="gp">&lt;/html&gt;</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl s_client <span class="nt">-connect</span> localhost:3000 <span class="nt">-CAfile</span> root-ca.crt
<span class="go">
CONNECTED(00000003)
depth=1 /C=US/ST=CA/L=San Francisco/O=Docker/CN=Swarm Secret Example CA
verify return:1
depth=0 /C=US/ST=CA/L=San Francisco/O=Docker/CN=localhost
verify return:1
---
Certificate chain
 0 s:/C=US/ST=CA/L=San Francisco/O=Docker/CN=localhost
   i:/C=US/ST=CA/L=San Francisco/O=Docker/CN=Swarm Secret Example CA
---
Server certificate
-----BEGIN CERTIFICATE-----
…
-----END CERTIFICATE-----
subject=/C=US/ST=CA/L=San Francisco/O=Docker/CN=localhost
issuer=/C=US/ST=CA/L=San Francisco/O=Docker/CN=Swarm Secret Example CA
---
No client certificate CA names sent
---
SSL handshake has read 1663 bytes and written 712 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 4096 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
    Session-ID: A1A8BF35549C5715648A12FD7B7E3D861539316B03440187D9DA6C2E48822853
    Session-ID-ctx:
    Master-Key: F39D1B12274BA16D3A906F390A61438221E381952E9E1E05D3DD784F0135FB81353DA38C6D5C021CB926E844DFC49FC4
    Key-Arg   : None
    Start Time: 1481685096
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>To clean up after running this example, remove the <code class="language-plaintext highlighter-rouge">nginx</code> service and the
stored secrets.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service <span class="nb">rm </span>nginx
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">rm </span>site.crt site.key site.conf
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="advanced-example-use-secrets-with-a-wordpress-service">Advanced example: Use secrets with a WordPress service</h3>

<p>In this example, you create a single-node MySQL service with a custom root
password, add the credentials as secrets, and create a single-node WordPress
service which uses these credentials to connect to MySQL. The
<a href="#example-rotate-a-secret">next example</a> builds on this one and shows you how to
rotate the MySQL password and update the services so that the WordPress service
can still connect to MySQL.</p>

<p>This example illustrates some techniques to use Docker secrets to avoid saving
sensitive credentials within your image or passing them directly on the command
line.</p>

<blockquote>
  <p><strong>Note</strong>: This example uses a single-Engine swarm for simplicity, and uses a
single-node MySQL service because a single MySQL server instance cannot be
scaled by simply using a replicated service, and setting up a MySQL cluster is
beyond the scope of this example.</p>

  <p>Also, changing a MySQL root passphrase isn’t as simple as changing
a file on disk. You must use a query or a <code class="language-plaintext highlighter-rouge">mysqladmin</code> command to change the
password in MySQL.</p>
</blockquote>

<ol>
  <li>
    <p>Generate a random alphanumeric password for MySQL and store it as a Docker
secret with the name <code class="language-plaintext highlighter-rouge">mysql_password</code> using the <code class="language-plaintext highlighter-rouge">docker secret create</code>
command. To make the password shorter or longer, adjust the last argument of
the <code class="language-plaintext highlighter-rouge">openssl</code> command. This is just one way to create a relatively random
password. You can use another command to generate the password if you
choose.</p>

    <blockquote>
      <p><strong>Note</strong>: After you create a secret, you cannot update it. You can only
remove and re-create it, and you cannot remove a secret that a service is
using. However, you can grant or revoke a running service’s access to
secrets using <code class="language-plaintext highlighter-rouge">docker service update</code>. If you need the ability to update a
secret, consider adding a version component to the secret name, so that you
can later add a new version, update the service to use it, then remove the
old version.</p>
    </blockquote>

    <p>The last argument is set to <code class="language-plaintext highlighter-rouge">-</code>, which indicates that the input is read from
standard input.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-base64</span> 20 | docker secret create mysql_password -
<span class="go">
l1vinzevzhj4goakjap5ya409
</span></code></pre></div>    </div>

    <p>The value returned is not the password, but the ID of the secret. In the
remainder of this tutorial, the ID output is omitted.</p>

    <p>Generate a second secret for the MySQL <code class="language-plaintext highlighter-rouge">root</code> user. This secret isn’t
shared with the WordPress service created later. It’s only needed to
bootstrap the <code class="language-plaintext highlighter-rouge">mysql</code> service.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-base64</span> 20 | docker secret create mysql_root_password -
</code></pre></div>    </div>

    <p>List the secrets managed by Docker using <code class="language-plaintext highlighter-rouge">docker secret ls</code>:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">ls</span>
<span class="go">
ID                          NAME                  CREATED             UPDATED
l1vinzevzhj4goakjap5ya409   mysql_password        41 seconds ago      41 seconds ago
yvsczlx9votfw3l0nz5rlidig   mysql_root_password   12 seconds ago      12 seconds ago
</span></code></pre></div>    </div>

    <p>The secrets are stored in the encrypted Raft logs for the swarm.</p>
  </li>
  <li>
    <p>Create a user-defined overlay network which is used for communication
between the MySQL and WordPress services. There is no need to expose the
MySQL service to any external host or container.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker network create <span class="nt">-d</span> overlay mysql_private
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create the MySQL service. The MySQL service has the following
characteristics:</p>

    <ul>
      <li>Because the scale is set to <code class="language-plaintext highlighter-rouge">1</code>, only a single MySQL task runs.
Load-balancing MySQL is left as an exercise to the reader and involves
more than just scaling the service.</li>
      <li>Only reachable by other containers on the <code class="language-plaintext highlighter-rouge">mysql_private</code> network.</li>
      <li>Uses the volume <code class="language-plaintext highlighter-rouge">mydata</code> to store the MySQL data, so that it persists
across restarts to the <code class="language-plaintext highlighter-rouge">mysql</code> service.</li>
      <li>The secrets are each mounted in a <code class="language-plaintext highlighter-rouge">tmpfs</code> filesystem at
<code class="language-plaintext highlighter-rouge">/run/secrets/mysql_password</code> and <code class="language-plaintext highlighter-rouge">/run/secrets/mysql_root_password</code>.
They are never exposed as environment variables, nor can they be committed
to an image if the <code class="language-plaintext highlighter-rouge">docker commit</code> command is run. The <code class="language-plaintext highlighter-rouge">mysql_password</code>
secret is the one used by the non-privileged WordPress container to
connect to MySQL.</li>
      <li>Sets the environment variables <code class="language-plaintext highlighter-rouge">MYSQL_PASSWORD_FILE</code> and
<code class="language-plaintext highlighter-rouge">MYSQL_ROOT_PASSWORD_FILE</code> to point to the
files <code class="language-plaintext highlighter-rouge">/run/secrets/mysql_password</code> and <code class="language-plaintext highlighter-rouge">/run/secrets/mysql_root_password</code>.
The <code class="language-plaintext highlighter-rouge">mysql</code> image reads the password strings from those files when
initializing the system database for the first time. Afterward, the
passwords are stored in the MySQL system database itself.</li>
      <li>
        <p>Sets environment variables <code class="language-plaintext highlighter-rouge">MYSQL_USER</code> and <code class="language-plaintext highlighter-rouge">MYSQL_DATABASE</code>. A new
database called <code class="language-plaintext highlighter-rouge">wordpress</code> is created when the container starts, and the
<code class="language-plaintext highlighter-rouge">wordpress</code> user has full permissions for this database only. This
user cannot create or drop databases or change the MySQL
configuration.</p>

        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service create <span class="se">\</span>
     <span class="nt">--name</span> mysql <span class="se">\</span>
     <span class="nt">--replicas</span> 1 <span class="se">\</span>
     <span class="nt">--network</span> mysql_private <span class="se">\</span>
     <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span>volume,source<span class="o">=</span>mydata,destination<span class="o">=</span>/var/lib/mysql <span class="se">\</span>
     <span class="nt">--secret</span> <span class="nb">source</span><span class="o">=</span>mysql_root_password,target<span class="o">=</span>mysql_root_password <span class="se">\</span>
     <span class="nt">--secret</span> <span class="nb">source</span><span class="o">=</span>mysql_password,target<span class="o">=</span>mysql_password <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD_FILE</span><span class="o">=</span><span class="s2">"/run/secrets/mysql_root_password"</span> <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">MYSQL_PASSWORD_FILE</span><span class="o">=</span><span class="s2">"/run/secrets/mysql_password"</span> <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">MYSQL_USER</span><span class="o">=</span><span class="s2">"wordpress"</span> <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">MYSQL_DATABASE</span><span class="o">=</span><span class="s2">"wordpress"</span> <span class="se">\</span>
     mysql:latest
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Verify that the <code class="language-plaintext highlighter-rouge">mysql</code> container is running using the <code class="language-plaintext highlighter-rouge">docker service ls</code> command.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service <span class="nb">ls</span>
<span class="go">
ID            NAME   MODE        REPLICAS  IMAGE
wvnh0siktqr3  mysql  replicated  1/1       mysql:latest
</span></code></pre></div>    </div>

    <p>At this point, you could actually revoke the <code class="language-plaintext highlighter-rouge">mysql</code> service’s access to the
<code class="language-plaintext highlighter-rouge">mysql_password</code> and <code class="language-plaintext highlighter-rouge">mysql_root_password</code> secrets because the passwords
have been saved in the MySQL system database. Don’t do that for now, because
we use them later to facilitate rotating the MySQL password.</p>
  </li>
  <li>
    <p>Now that MySQL is set up, create a WordPress service that connects to the
MySQL service. The WordPress service has the following characteristics:</p>

    <ul>
      <li>Because the scale is set to <code class="language-plaintext highlighter-rouge">1</code>, only a single WordPress task runs.
Load-balancing WordPress is left as an exercise to the reader, because of
limitations with storing WordPress session data on the container
filesystem.</li>
      <li>Exposes WordPress on port 30000 of the host machine, so that you can access
it from external hosts. You can expose port 80 instead if you do not have
a web server running on port 80 of the host machine.</li>
      <li>Connects to the <code class="language-plaintext highlighter-rouge">mysql_private</code> network so it can communicate with the
<code class="language-plaintext highlighter-rouge">mysql</code> container, and also publishes port 80 to port 30000 on all swarm
nodes.</li>
      <li>Has access to the <code class="language-plaintext highlighter-rouge">mysql_password</code> secret, but specifies a different
target file name within the container. The WordPress container uses
the mount point <code class="language-plaintext highlighter-rouge">/run/secrets/wp_db_password</code>. Also specifies that the
secret is not group-or-world-readable, by setting the mode to
<code class="language-plaintext highlighter-rouge">0400</code>.</li>
      <li>Sets the environment variable <code class="language-plaintext highlighter-rouge">WORDPRESS_DB_PASSWORD_FILE</code> to the file
path where the secret is mounted. The WordPress service reads the
MySQL password string from that file and add it to the <code class="language-plaintext highlighter-rouge">wp-config.php</code>
configuration file.</li>
      <li>Connects to the MySQL container using the username <code class="language-plaintext highlighter-rouge">wordpress</code> and the
password in <code class="language-plaintext highlighter-rouge">/run/secrets/wp_db_password</code> and creates the <code class="language-plaintext highlighter-rouge">wordpress</code>
database if it does not yet exist.</li>
      <li>Stores its data, such as themes and plugins, in a volume called <code class="language-plaintext highlighter-rouge">wpdata</code>
so these files  persist when the service restarts.</li>
    </ul>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service create <span class="se">\</span>
     <span class="nt">--name</span> wordpress <span class="se">\</span>
     <span class="nt">--replicas</span> 1 <span class="se">\</span>
     <span class="nt">--network</span> mysql_private <span class="se">\</span>
     <span class="nt">--publish</span> <span class="nv">published</span><span class="o">=</span>30000,target<span class="o">=</span>80 <span class="se">\</span>
     <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span>volume,source<span class="o">=</span>wpdata,destination<span class="o">=</span>/var/www/html <span class="se">\</span>
     <span class="nt">--secret</span> <span class="nb">source</span><span class="o">=</span>mysql_password,target<span class="o">=</span>wp_db_password,mode<span class="o">=</span>0400 <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">WORDPRESS_DB_USER</span><span class="o">=</span><span class="s2">"wordpress"</span> <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">WORDPRESS_DB_PASSWORD_FILE</span><span class="o">=</span><span class="s2">"/run/secrets/wp_db_password"</span> <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">WORDPRESS_DB_HOST</span><span class="o">=</span><span class="s2">"mysql:3306"</span> <span class="se">\</span>
     <span class="nt">-e</span> <span class="nv">WORDPRESS_DB_NAME</span><span class="o">=</span><span class="s2">"wordpress"</span> <span class="se">\</span>
     wordpress:latest
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify the service is running using <code class="language-plaintext highlighter-rouge">docker service ls</code> and
<code class="language-plaintext highlighter-rouge">docker service ps</code> commands.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service <span class="nb">ls</span>
<span class="go">
ID            NAME       MODE        REPLICAS  IMAGE
wvnh0siktqr3  mysql      replicated  1/1       mysql:latest
nzt5xzae4n62  wordpress  replicated  1/1       wordpress:latest
</span></code></pre></div>    </div>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service ps wordpress
<span class="go">
ID            NAME         IMAGE             NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS
aukx6hgs9gwc  wordpress.1  wordpress:latest  moby  Running        Running 52 seconds ago
</span></code></pre></div>    </div>

    <p>At this point, you could actually revoke the WordPress service’s access to
the <code class="language-plaintext highlighter-rouge">mysql_password</code> secret, because WordPress has copied the secret to its
configuration file <code class="language-plaintext highlighter-rouge">wp-config.php</code>. Don’t do that for now, because we
use it later to facilitate rotating the MySQL password.</p>
  </li>
  <li>
    <p>Access <code class="language-plaintext highlighter-rouge">http://localhost:30000/</code> from any swarm node and set up WordPress
using the web-based wizard. All of these settings are stored in the MySQL
<code class="language-plaintext highlighter-rouge">wordpress</code> database. WordPress automatically generates a password for your
WordPress user, which is completely different from the password WordPress
uses to access MySQL. Store this password securely, such as in a password
manager. You need it to log into WordPress after
<a href="#example-rotate-a-secret">rotating the secret</a>.</p>

    <p>Go ahead and write a blog post or two and install a WordPress plugin or
theme to verify that WordPress is fully operational and its state is saved
across service restarts.</p>
  </li>
  <li>
    <p>Do not clean up any services or secrets if you intend to proceed to the next
example, which demonstrates how to rotate the MySQL root password.</p>
  </li>
</ol>

<h3 id="example-rotate-a-secret">Example: Rotate a secret</h3>

<p>This example builds upon the previous one. In this scenario, you create a new
secret with a new MySQL password, update the <code class="language-plaintext highlighter-rouge">mysql</code> and <code class="language-plaintext highlighter-rouge">wordpress</code> services to
use it, then remove the old secret.</p>

<blockquote>
  <p><strong>Note</strong>: Changing the password on a MySQL database involves running extra
queries or commands, as opposed to just changing a single environment variable
or a file, since the image only sets the MySQL password if the database doesn’t
already exist, and MySQL stores the password within a MySQL database by default.
Rotating passwords or other secrets may involve additional steps outside of
Docker.</p>
</blockquote>

<ol>
  <li>
    <p>Create the new password and store it as a secret named <code class="language-plaintext highlighter-rouge">mysql_password_v2</code>.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-base64</span> 20 | docker secret create mysql_password_v2 -
</code></pre></div>    </div>
  </li>
  <li>
    <p>Update the MySQL service to give it access to both the old and new secrets.
Remember that you cannot update or rename a secret, but you can revoke a
secret and grant access to it using a new target filename.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service update <span class="se">\</span>
     <span class="nt">--secret-rm</span> mysql_password mysql
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker service update <span class="se">\</span>
     <span class="nt">--secret-add</span> <span class="nb">source</span><span class="o">=</span>mysql_password,target<span class="o">=</span>old_mysql_password <span class="se">\</span>
     <span class="nt">--secret-add</span> <span class="nb">source</span><span class="o">=</span>mysql_password_v2,target<span class="o">=</span>mysql_password <span class="se">\</span>
     mysql
</code></pre></div>    </div>

    <p>Updating a service causes it to restart, and when the MySQL service restarts
the second time, it has access to the old secret under
<code class="language-plaintext highlighter-rouge">/run/secrets/old_mysql_password</code> and the new secret under
<code class="language-plaintext highlighter-rouge">/run/secrets/mysql_password</code>.</p>

    <p>Even though the MySQL service has access to both the old and new secrets
now, the MySQL password for the WordPress user has not yet been changed.</p>

    <blockquote>
      <p><strong>Note</strong>: This example does not rotate the MySQL <code class="language-plaintext highlighter-rouge">root</code> password.</p>
    </blockquote>
  </li>
  <li>
    <p>Now, change the MySQL password for the <code class="language-plaintext highlighter-rouge">wordpress</code> user using the
<code class="language-plaintext highlighter-rouge">mysqladmin</code> CLI. This command reads the old and new password from the files
in <code class="language-plaintext highlighter-rouge">/run/secrets</code> but does not expose them on the command line or save them
in the shell history.</p>

    <p>Do this quickly and move on to the next step, because WordPress loses
the ability to connect to MySQL.</p>

    <p>First, find the ID of the <code class="language-plaintext highlighter-rouge">mysql</code> container task.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker ps <span class="nt">--filter</span> <span class="nv">name</span><span class="o">=</span>mysql <span class="nt">-q</span>
<span class="go">
c7705cf6176f
</span></code></pre></div>    </div>

    <p>Substitute the ID in the command below, or use the second variant which
uses shell expansion to do it all in a single step.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker container <span class="nb">exec</span> &lt;CONTAINER_ID&gt; <span class="se">\</span>
    bash <span class="nt">-c</span> <span class="s1">'mysqladmin --user=wordpress --password="$(&lt; /run/secrets/old_mysql_password)" password "$(&lt; /run/secrets/mysql_password)"'</span>
</code></pre></div>    </div>

    <p><strong>or</strong>:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker container <span class="nb">exec</span> <span class="si">$(</span>docker ps <span class="nt">--filter</span> <span class="nv">name</span><span class="o">=</span>mysql <span class="nt">-q</span><span class="si">)</span> <span class="se">\</span>
    bash <span class="nt">-c</span> <span class="s1">'mysqladmin --user=wordpress --password="$(&lt; /run/secrets/old_mysql_password)" password "$(&lt; /run/secrets/mysql_password)"'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Update the <code class="language-plaintext highlighter-rouge">wordpress</code> service to use the new password, keeping the target
path at <code class="language-plaintext highlighter-rouge">/run/secrets/wp_db_secret</code> and keeping the file permissions at
<code class="language-plaintext highlighter-rouge">0400</code>.  This triggers a rolling restart of the WordPress service and
the new secret is used.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service update <span class="se">\</span>
     <span class="nt">--secret-rm</span> mysql_password <span class="se">\</span>
     <span class="nt">--secret-add</span> <span class="nb">source</span><span class="o">=</span>mysql_password_v2,target<span class="o">=</span>wp_db_password,mode<span class="o">=</span>0400 <span class="se">\</span>
     wordpress
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that WordPress works by browsing to http://localhost:30000/ on any
swarm node again. Use the WordPress username and password
from when you ran through the WordPress wizard in the previous task.</p>

    <p>Verify that the blog post you wrote still exists, and if you changed any
configuration values, verify that they are still changed.</p>
  </li>
  <li>
    <p>Revoke access to the old secret from the MySQL service and
remove the old secret from Docker.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service update <span class="se">\</span>
     <span class="nt">--secret-rm</span> mysql_password <span class="se">\</span>
     mysql
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">rm </span>mysql_password
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you want to try the running all of these examples again or just want to
clean up after running through them, use these commands to remove the
WordPress service, the MySQL container, the <code class="language-plaintext highlighter-rouge">mydata</code> and <code class="language-plaintext highlighter-rouge">wpdata</code> volumes,
and the Docker secrets.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker service <span class="nb">rm </span>wordpress mysql
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker volume <span class="nb">rm </span>mydata wpdata
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>docker secret <span class="nb">rm </span>mysql_password_v2 mysql_root_password
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="build-support-for-docker-secrets-into-your-images">Build support for Docker Secrets into your images</h2>

<p>If you develop a container that can be deployed as a service and requires
sensitive data, such as a credential, as an environment variable, consider
adapting your image to take advantage of Docker secrets. One way to do this is
to ensure that each parameter you pass to the image when creating the container
can also be read from a file.</p>

<p>Many of the Docker Official Images in the
<a href="https://github.com/docker-library/">Docker library</a>, such as the
<a href="https://github.com/docker-library/wordpress/">wordpress</a>
image used in the above examples, have been updated in this way.</p>

<p>When you start a WordPress container, you provide it with the parameters it
needs by setting them as environment variables. The WordPress image has been
updated so that the environment variables which contain important data for
WordPress, such as <code class="language-plaintext highlighter-rouge">WORDPRESS_DB_PASSWORD</code>, also have variants which can read
their values from a file (<code class="language-plaintext highlighter-rouge">WORDPRESS_DB_PASSWORD_FILE</code>). This strategy ensures
that backward compatibility is preserved, while allowing your container to read
the information from a Docker-managed secret instead of being passed directly.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Docker secrets do not set environment variables directly. This was a
conscious decision, because environment variables can unintentionally be leaked
between containers (for instance, if you use <code class="language-plaintext highlighter-rouge">--link</code>).</p>
</blockquote>

<h2 id="use-secrets-in-compose">Use Secrets in Compose</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.9"</span>

<span class="na">services</span><span class="pi">:</span>
   <span class="na">db</span><span class="pi">:</span>
     <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:latest</span>
     <span class="na">volumes</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">db_data:/var/lib/mysql</span>
     <span class="na">environment</span><span class="pi">:</span>
       <span class="na">MYSQL_ROOT_PASSWORD_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/db_root_password</span>
       <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">wordpress</span>
       <span class="na">MYSQL_USER</span><span class="pi">:</span> <span class="s">wordpress</span>
       <span class="na">MYSQL_PASSWORD_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/db_password</span>
     <span class="na">secrets</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">db_root_password</span>
       <span class="pi">-</span> <span class="s">db_password</span>

   <span class="na">wordpress</span><span class="pi">:</span>
     <span class="na">depends_on</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">db</span>
     <span class="na">image</span><span class="pi">:</span> <span class="s">wordpress:latest</span>
     <span class="na">ports</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s2">"</span><span class="s">8000:80"</span>
     <span class="na">environment</span><span class="pi">:</span>
       <span class="na">WORDPRESS_DB_HOST</span><span class="pi">:</span> <span class="s">db:3306</span>
       <span class="na">WORDPRESS_DB_USER</span><span class="pi">:</span> <span class="s">wordpress</span>
       <span class="na">WORDPRESS_DB_PASSWORD_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/db_password</span>
     <span class="na">secrets</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">db_password</span>


<span class="na">secrets</span><span class="pi">:</span>
   <span class="na">db_password</span><span class="pi">:</span>
     <span class="na">file</span><span class="pi">:</span> <span class="s">db_password.txt</span>
   <span class="na">db_root_password</span><span class="pi">:</span>
     <span class="na">file</span><span class="pi">:</span> <span class="s">db_root_password.txt</span>

<span class="na">volumes</span><span class="pi">:</span>
    <span class="na">db_data</span><span class="pi">:</span>
</code></pre></div></div>

<p>This example creates a simple WordPress site using two secrets in
a compose file.</p>

<p>The keyword <code class="language-plaintext highlighter-rouge">secrets:</code> defines two secrets <code class="language-plaintext highlighter-rouge">db_password:</code> and
<code class="language-plaintext highlighter-rouge">db_root_password:</code>.</p>

<p>When deploying, Docker creates these two secrets and populates them with the
content from the file specified in the compose file.</p>

<p>The db service uses both secrets, and the wordpress is using one.</p>

<p>When you deploy, Docker mounts a file under <code class="language-plaintext highlighter-rouge">/run/secrets/&lt;secret_name&gt;</code> in the
services. These files are never persisted in disk, but are managed in memory.</p>

<p>Each service uses environment variables to specify where the service should look
for that secret data.</p>

<p>More information on short and long syntax for secrets can be found at
<a href="/docs.docker.jp.onthefly/compose/compose-file/compose-file-v3/#secrets">Compose file version 3 reference</a>.</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=swarm">swarm</a>, <a href="/docs.docker.jp.onthefly/search/?q=secrets">secrets</a>, <a href="/docs.docker.jp.onthefly/search/?q=credentials">credentials</a>, <a href="/docs.docker.jp.onthefly/search/?q=sensitive strings">sensitive strings</a>, <a href="/docs.docker.jp.onthefly/search/?q=sensitive data">sensitive data</a>, <a href="/docs.docker.jp.onthefly/search/?q=security">security</a>, <a href="/docs.docker.jp.onthefly/search/?q=encryption">encryption</a>, <a href="/docs.docker.jp.onthefly/search/?q=encryption at rest">encryption at rest</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/engine/swarm/secrets.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [engine/swarm/secrets.ch](https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/secrets/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#about-secrets" class="nomunge">secrets について</a>
    <ul>
      <li><a href="#windows-support" class="nomunge">Windows support</a></li>
    </ul>
  </li>
  <li><a href="#how-docker-manages-secrets" class="nomunge">How Docker manages secrets</a></li>
  <li><a href="#read-more-about-docker-secret-commands" class="nomunge">Read more about docker secret commands</a></li>
  <li><a href="#examples" class="nomunge">Examples</a>
    <ul>
      <li><a href="#defining-and-using-secrets-in-compose-files" class="nomunge">Defining and using secrets in compose files</a></li>
      <li><a href="#simple-example-get-started-with-secrets" class="nomunge">Simple example: Get started with secrets</a></li>
      <li><a href="#simple-example-use-secrets-in-a-windows-service" class="nomunge">Simple example: Use secrets in a Windows service</a></li>
      <li><a href="#intermediate-example-use-secrets-with-a-nginx-service" class="nomunge">Intermediate example: Use secrets with a Nginx service</a></li>
      <li><a href="#advanced-example-use-secrets-with-a-wordpress-service" class="nomunge">Advanced example: Use secrets with a WordPress service</a></li>
      <li><a href="#example-rotate-a-secret" class="nomunge">Example: Rotate a secret</a></li>
    </ul>
  </li>
  <li><a href="#build-support-for-docker-secrets-into-your-images" class="nomunge">Build support for Docker Secrets into your images</a></li>
  <li><a href="#use-secrets-in-compose" class="nomunge">Use Secrets in Compose</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">なぜ Docker なのか？</a></b></li>
                        <li><a href="https://www.docker.com/what-container">コンテナーって何？</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">製品</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker 製品ロードマップ</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">開発ツール</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">利用例</a></li>
                        <li><a href="https://www.docker.com/docker-community">コミュニティ</a></li>
                        <li><a href="https://www.docker.com/open-source">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker キャプテン</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Docker 認定公開者向けプログラム</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社</a></b></li>
                        <li><a href="https://www.docker.com/company">概要</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/customers">顧客</a></li>
                        <li><a href="https://www.docker.com/partners">パートナー</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact">連絡先</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal">法的情報</a></li>
                        <li><a href="https://www.docker.com/company/contact">連絡</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/engine/swarm/secrets/";</script></body>
</html>
