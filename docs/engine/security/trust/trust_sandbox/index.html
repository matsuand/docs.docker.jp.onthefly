<!DOCTYPE html>
<!-- Page generated 2022-04-29 17:35:28 +0900-->
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>コンテントトラストのサンドボックスで遊ぶ | Docker ドキュメント</title>
  <meta name="description" content="Play in a trust sandbox" />
  <meta name="keywords" content="trust, security, root,  keys, repository, sandbox">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/engine/security/trust/trust_sandbox/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="コンテントトラストのサンドボックスで遊ぶ"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="コンテントトラストのサンドボックスで遊ぶ" />
  <meta property="og:description" content="Play in a trust sandbox" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2022-04-29T17:35:28+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/engine/security/trust/trust_sandbox/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2022-04-29T17:35:28+09:00"/>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","headline":"コンテントトラストのサンドボックスで遊ぶ","description":"Play in a trust sandbox","url":"https://docs.docker.com/engine/security/trust/trust_sandbox/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs ホームページ"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/desktop/">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/security/">セキュリティ</a></li><li><a href="/docs.docker.jp.onthefly/engine/security/">Docker Engine セキュリティ</a></li><li><a href="/docs.docker.jp.onthefly/engine/security/trust/">信頼できるイメージの利用</a></li><li><a href="/docs.docker.jp.onthefly/engine/security/trust/trust_sandbox/">コンテントトラストのサンドボックスで遊ぶ</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>コンテントトラストのサンドボックスで遊ぶ</h1><p><em class="reading-time">読む時間の目安: 4 分</em></p><p>このページでは、コンテントトラストを試用できるサンドボックスについて、その設定と利用方法を説明します。
サンドボックスはコンテントトラストの操作を、ローカルにおいて設定し試してみることができるものです。
本番環境のイメージに影響を与えることはありません。</p>

<p>サンドボックスの作業を進める前に、<a href="/docs.docker.jp.onthefly/engine/security/trust/">コンテントトラストの概要</a> をよく読んでおいてください。</p>

<h3 id="prerequisites">前提条件</h3>

<p>ここに示す手順においては、Linux または macOS を利用しているものとします。
サンドボックスは、ローカルマシン上、仮想マシン上のいずれにおいても動作します。
そのローカルマシンあるいは仮想マシン上においては、docker コマンドの実行権限が必要です。</p>

<p>サンドボックスを利用するためには 2 つの Docker ツールが必要です。
Docker Engine 1.10.0 以上と Docker Compose 1.6.0 以上です。
Docker Engine をインストールするには <a href="/docs.docker.jp.onthefly/engine/install/">対応するプラットフォームの一覧</a> から選んでください。
Docker Compose をインストールするには <a href="/docs.docker.jp.onthefly/compose/install/">インストール手順の詳細</a> を参照してください。</p>

<h2 id="what-is-in-the-sandbox">サンドボックスの中には何があるか</h2>

<p>コンテントトラストを単にインストールしただけの状態である場合、必要なのは Docker Engine クライアントと Docker Hub へアクセスできることだけです。
サンドボックスはコンテントトラストの本番環境をまねて実現しているため、以下のようなコンポーネントを追加設定します。</p>

<table>
  <thead>
    <tr>
      <th>コンテナー</th>
      <th>内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>trustsandbox</td>
      <td>Docker Engine の最新版と設定済み証明書が含まれているコンテナー。これがサンドボックスであり、<code class="highlighter-rouge">docker</code>クライアントを使ってトラスト操作を試行するものです。</td>
    </tr>
    <tr>
      <td>レジストリサーバー</td>
      <td>ローカルのレジストリサービス。</td>
    </tr>
    <tr>
      <td>Notary サーバー</td>
      <td>トラスト管理のための重要な処理を行うサービス。</td>
    </tr>
  </tbody>
</table>

<p>上はつまり、コンテントトラスト（Notary）サーバーとレジストリサーバーは自分で起動するということです。
Docker Hub を主に利用しているのであれば、上のコンポーネントを用意する必要はありません。
Docker Hub にはすべてビルドされ含まれています。
しかしサンドボックスの場合は、本番環境に似せたものを自分でビルドして利用します。</p>

<p><code class="highlighter-rouge">trustsandbox</code>コンテナーでは、Docker Hub ではなく、ローカルのレジストリサーバーとやりとりをします。
日々使っているイメージリポジトリは、ここでは利用しないということです。
サンドボックスで遊んでいる間は、イメージリポジトリは保護されます。</p>

<p>サンドボックスで遊ぶ際には、ルート鍵とリポジトリ鍵も生成します。
サンドボックスでは、<code class="highlighter-rouge">trustsandbox</code>コンテナー内部に、鍵データやファイルは何でも保存できるように設定されています。
サンドボックス内で生成する鍵は、お遊び用なので、コンテナーを削除するときに同時に削除します。</p>

<p><code class="highlighter-rouge">trustsandbox</code>コンテナーにおいては docker-in-docker イメージを使います。
したがって、本物の Docker デーモンとの間でイメージをプッシュ、プルすることはなく、キャッシュを汚すことはありません。
イメージは、このコンテナーにアタッチされた匿名ボリュームに保存します。
そしてコンテナーを削除したときに同時に削除します。</p>

<h2 id="build-the-sandbox">サンドボックスのビルド</h2>

<p>この節では Docker Compose を使って<code class="highlighter-rouge">trustsandbox</code>コンテナー、Notary サーバー、レジストリサーバーを設定してリンクさせる方法を説明します。</p>

<ol>
  <li>
    <p>新たなディレクトリ<code class="highlighter-rouge">trustsandbox</code>を生成してそこに移動します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ mkdir trustsandbox
 $ cd trustsandbox
</code></pre></div>    </div>
  </li>
  <li>
    <p>好みのエディターを使って<code class="highlighter-rouge">docker-compose.yml</code>というファイルを生成します。
たとえば vim を利用します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ touch docker-compose.yml
 $ vim docker-compose.yml
</code></pre></div>    </div>
  </li>
  <li>
    <p>ファイルに以下の内容を追加します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> version: "2"
 services:
   notaryserver:
     image: dockersecurity/notary_autobuilds:server-v0.5.1
     volumes:
       - notarycerts:/var/lib/notary/fixtures
     networks:
       - sandbox
     environment:
       - NOTARY_SERVER_STORAGE_TYPE=memory
       - NOTARY_SERVER_TRUST_SERVICE_TYPE=local
   sandboxregistry:
     image: registry:2.4.1
     networks:
       - sandbox
     container_name: sandboxregistry
   trustsandbox:
     image: docker:dind
     networks:
       - sandbox
     volumes:
       - notarycerts:/notarycerts
     privileged: true
     container_name: trustsandbox
     entrypoint: ""
     command: |-
         sh -c '
             cp /notarycerts/root-ca.crt /usr/local/share/ca-certificates/root-ca.crt &amp;&amp;
             update-ca-certificates &amp;&amp;
             dockerd-entrypoint.sh --insecure-registry sandboxregistry:5000'
 volumes:
   notarycerts:
     external: false
 networks:
   sandbox:
     external: false
</code></pre></div>    </div>
  </li>
  <li>
    <p>ファイルを保存して閉じます。</p>
  </li>
  <li>
    <p>ローカルシステム上においてコンテナーを起動します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ docker-compose up -d
</code></pre></div>    </div>

    <p>初回起動の際には docker-in-docker、Notary サーバー、レジストリの各イメージが Docker Hub からダウンロードされます。</p>
  </li>
</ol>

<h2 id="サンドボックスで遊ぶ">サンドボックスで遊ぶ</h2>

<p>設定がすべてできたので、<code class="highlighter-rouge">trustsandbox</code>コンテナー内に入って、Docker コンテントトラストの試しに使ってみます。
ホストマシンから<code class="highlighter-rouge">trustsandbox</code>コンテナー内のシェルにアクセスします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker container exec -it trustsandbox sh
/ #
</code></pre></div></div>

<h3 id="test-some-trust-operations">コンテントトラストの操作実行</h3>

<p><code class="highlighter-rouge">trustsandbox</code>コンテナー内から、イメージをプルしてみます。</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">docker</code>イメージをダウンロードします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # docker pull docker/trusttest
 docker pull docker/trusttest
 Using default tag: latest
 latest: Pulling from docker/trusttest

 b3dbab3810fc: Pull complete
 a9539b34a6ab: Pull complete
 Digest: sha256:d149ab53f8718e987c3a3024bb8aa0e2caadf6c0328f1d9d850b2a2a67f2819a
 Status: Downloaded newer image for docker/trusttest:latest
</code></pre></div>    </div>
  </li>
  <li>
    <p>サンドボックスレジストリにそのイメージをプッシュするために、タグづけを行ないます。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # docker tag docker/trusttest sandboxregistry:5000/test/trusttest:latest
</code></pre></div>    </div>
  </li>
  <li>
    <p>コンテントトラストを有効にします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # export DOCKER_CONTENT_TRUST=1
</code></pre></div>    </div>
  </li>
  <li>
    <p>コンテントトラストサーバーを指定します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # export DOCKER_CONTENT_TRUST_SERVER=https://notaryserver:4443
</code></pre></div>    </div>

    <p>この手順は、サンドボックスが独自のサーバーを利用しているために必要となるものです。
 通常 Docker Hub を利用している場合、この手順は不要です。</p>
  </li>
  <li>
    <p>テストイメージをプルします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # docker pull sandboxregistry:5000/test/trusttest
 Using default tag: latest
 Error: remote trust data does not exist for sandboxregistry:5000/test/trusttest: notaryserver:4443 does not have trust data for sandboxregistry:5000/test/trusttest
</code></pre></div>    </div>

    <p>エラーになりました。
   そのコンテントがまだ<code class="highlighter-rouge">notaryserver</code>には存在していないからです。</p>
  </li>
  <li>
    <p>イメージをプッシュして、信頼された（trusted）イメージとしてサインします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # docker push sandboxregistry:5000/test/trusttest:latest
 The push refers to a repository [sandboxregistry:5000/test/trusttest]
 5f70bf18a086: Pushed
 c22f7bc058a9: Pushed
 latest: digest: sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926 size: 734
 Signing and pushing trust metadata
 You are about to create a new root signing key passphrase. This passphrase
 will be used to protect the most sensitive key in your signing system. Please
 choose a long, complex passphrase and be careful to keep the password and the
 key file itself secure and backed up. It is highly recommended that you use a
 password manager to generate the passphrase and keep it safe. There will be no
 way to recover this key. You can find the key in your config directory.
 Enter passphrase for new root key with ID 27ec255:
 Repeat passphrase for new root key with ID 27ec255:
 Enter passphrase for new repository key with ID 58233f9 (sandboxregistry:5000/test/trusttest):
 Repeat passphrase for new repository key with ID 58233f9 (sandboxregistry:5000/test/trusttest):
 Finished initializing "sandboxregistry:5000/test/trusttest"
 Successfully signed "sandboxregistry:5000/test/trusttest":latest
</code></pre></div>    </div>

    <p>レジストリに対してプッシュするのが初めてなので、Docker はルート鍵とリポジトリ鍵を生成します。
 ここで鍵の暗号化を行うためのパスフレーズの入力を求められます。
 これを行った後に再びプッシュすると、リポジトリに対するパスフレーズのみの入力が求められるだけです。
 これにより鍵の復号化とイメージへのサインが可能となります。</p>
  </li>
  <li>
    <p>プッシュしたばかりのイメージをプルしてみます。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> / # docker pull sandboxregistry:5000/test/trusttest
 Using default tag: latest
 Pull (1 of 1): sandboxregistry:5000/test/trusttest:latest@sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926
 sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926: Pulling from test/trusttest
 Digest: sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926
 Status: Downloaded newer image for sandboxregistry:5000/test/trusttest@sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926
 Tagging sandboxregistry:5000/test/trusttest@sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926 as sandboxregistry:5000/test/trusttest:latest
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="test-with-malicious-images">悪意あるイメージの確認</h3>

<p>コンテントトラストが有効な状態において、壊れているデータをプルしようとしたら、どうなるでしょう。
この節においては<code class="highlighter-rouge">sandboxregistry</code>にアクセスしてデータを改ざんし、その後にプルを試してみます。</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">trustsandbox</code>コンテナーとシェルアクセスをそのまま実行しておきます。</p>
  </li>
  <li>
    <p>ホストから対話を行うための端末画面を新たに開きます。
そして<code class="highlighter-rouge">sandboxregistry</code>コンテナー内のシェルにアクセスします。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker container exec -it sandboxregistry bash
root@65084fc6f047:/#
</code></pre></div>    </div>
  </li>
  <li>
    <p>プッシュした<code class="highlighter-rouge">test/trusttest</code>イメージのレイヤー一覧を表示します。</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@65084fc6f047:/#</span> <span class="nb">ls</span> <span class="nt">-l</span> /var/lib/registry/docker/registry/v2/repositories/test/trusttest/_layers/sha256
<span class="go">total 12
drwxr-xr-x 2 root root 4096 Jun 10 17:26 a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4
drwxr-xr-x 2 root root 4096 Jun 10 17:26 aac0c133338db2b18ff054943cee3267fe50c75cdee969aed88b1992539ed042
drwxr-xr-x 2 root root 4096 Jun 10 17:26 cc7629d1331a7362b5e5126beb5bf15ca0bf67eb41eab994c719a45de53255cd
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>このレイヤーの 1 つであるレジストリサーバーの保存ディレクトリに移動します。
（これは別ディレクトリにあります。）</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@65084fc6f047:/# cd /var/lib/registry/docker/registry/v2/blobs/sha256/aa/aac0c133338db2b18ff054943cee3267fe50c75cdee969aed88b1992539ed042
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">trusttest</code>レイヤーに悪意のあるデータを追加します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@65084fc6f047:/# echo "Malicious data" &gt; data
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">trustsandbox</code>端末画面に戻ります。</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">trusttest</code>イメージの一覧を表示します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ # docker image ls | grep trusttest
REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE
docker/trusttest                      latest              cc7629d1331a        11 months ago       5.025 MB
sandboxregistry:5000/test/trusttest   latest              cc7629d1331a        11 months ago       5.025 MB
sandboxregistry:5000/test/trusttest   &lt;none&gt;              cc7629d1331a        11 months ago       5.025 MB
</code></pre></div>    </div>
  </li>
  <li>
    <p>ローカルのキャッシュから<code class="highlighter-rouge">trusttest:latest</code>イメージを削除します。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ # docker image rm -f cc7629d1331a
Untagged: docker/trusttest:latest
Untagged: sandboxregistry:5000/test/trusttest:latest
Untagged: sandboxregistry:5000/test/trusttest@sha256:ebf59c538accdf160ef435f1a19938ab8c0d6bd96aef8d4ddd1b379edf15a926
Deleted: sha256:cc7629d1331a7362b5e5126beb5bf15ca0bf67eb41eab994c719a45de53255cd
Deleted: sha256:2a1f6535dc6816ffadcdbe20590045e6cbf048d63fd4cc753a684c9bc01abeea
Deleted: sha256:c22f7bc058a9a8ffeb32989b5d3338787e73855bf224af7aa162823da015d44c
</code></pre></div>    </div>

    <p>Docker は、一度キャッシュされたイメージを再ダウンロードしません。
しかしここでは Docker がダウンロード実行するようにします。
レジストリからダウンロードされるイメージは改ざんされたものであり、不正なものであることからダウンロードは拒否されます。</p>
  </li>
  <li>
    <p>イメージを再びプルします。
キャッシュが存在しないため、レジストリからイメージがダウンロードされます。</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ # docker pull sandboxregistry:5000/test/trusttest
Using default tag: latest
Pull (1 of 1): sandboxregistry:5000/test/trusttest:latest@sha256:35d5bc26fd358da8320c137784fe590d8fcf9417263ef261653e8e1c7f15672e
sha256:35d5bc26fd358da8320c137784fe590d8fcf9417263ef261653e8e1c7f15672e: Pulling from test/trusttest

aac0c133338d: Retrying in 5 seconds
a3ed95caeb02: Download complete
error pulling image configuration: unexpected EOF
</code></pre></div>    </div>

    <p>プルは正常終了しません。
  コンテントトラストシステムが、イメージ確認に失敗したからです。</p>
  </li>
</ol>

<h2 id="more-play-in-the-sandbox">サンドボックスでもっと遊ぶ</h2>

<p>ここまでに手元のローカルシステムには、Docker コンテントトラストのサンドボックスができあがっています。
あれこれと自由に遊んでみて、どんな動きになるかを確認してください。
Docker に対してセキュリティに問題があることがわかったら、気がねなく <a href="mailto:security@docker.com">security@docker.com</a> へメールしてください。</p>

<h2 id="clean-up-your-sandbox">サンドボックス環境のクリア</h2>

<p>十分確認ができたら、起動したサービス、生成された匿名ボリュームなど一切を削除します。
Docker Compose ファイルを生成したディレクトリに入って、以下のコマンドを実行します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ docker-compose down -v
</code></pre></div></div>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=trust">trust</a>, <a href="/docs.docker.jp.onthefly/search/?q=security">security</a>, <a href="/docs.docker.jp.onthefly/search/?q=root">root</a>, <a href="/docs.docker.jp.onthefly/search/?q=keys">keys</a>, <a href="/docs.docker.jp.onthefly/search/?q=repository">repository</a>, <a href="/docs.docker.jp.onthefly/search/?q=sandbox">sandbox</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/engine/security/trust/trust_sandbox.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [engine/security/trust/trust_sandbox.ch](https://matsuand.github.io/docs.docker.jp.onthefly/engine/security/trust/trust_sandbox/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#prerequisites" class="nomunge">前提条件</a></li>
  <li><a href="#what-is-in-the-sandbox" class="nomunge">サンドボックスの中には何があるか</a></li>
  <li><a href="#build-the-sandbox" class="nomunge">サンドボックスのビルド</a></li>
  <li><a href="#サンドボックスで遊ぶ" class="nomunge">サンドボックスで遊ぶ</a>
    <ul>
      <li><a href="#test-some-trust-operations" class="nomunge">コンテントトラストの操作実行</a></li>
      <li><a href="#test-with-malicious-images" class="nomunge">悪意あるイメージの確認</a></li>
    </ul>
  </li>
  <li><a href="#more-play-in-the-sandbox" class="nomunge">サンドボックスでもっと遊ぶ</a></li>
  <li><a href="#clean-up-your-sandbox" class="nomunge">サンドボックス環境のクリア</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products" target="_blank" rel="noopener">製品ラインアップ</a></b></li>
                        <li><a href="https://www.docker.com/products/personal" target="_blank" rel="noopener">Docker Personal</a></li>
                        <li><a href="https://www.docker.com/products/pro" target="_blank" rel="noopener">Docker Pro</a></li>
                        <li><a href="https://www.docker.com/products/team" target="_blank" rel="noopener">Docker Team</a></li>
                        <li><a href="https://www.docker.com/products/business" target="_blank" rel="noopener">Docker Business</a></li>
                        <li><a href="https://www.docker.com/products" target="_blank" rel="noopener">サブスクリプション比較</a></li>
                        <li><b><a href="https://www.docker.com/" target="_blank" rel="noopener">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub" target="_blank" rel="noopener">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/products/secure-software-supply-chain" target="_blank" rel="noopener">セキュアなソフトウェアサプライチェーン</a></li>
                        <li><a href="https://www.docker.com/products/container-runtime" target="_blank" rel="noopener">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools" target="_blank" rel="noopener">開発ツール</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">信頼できるコンテント</a></li>
                        <li><a href="https://www.docker.com/roadmap" target="_blank" rel="noopener">Docker 製品ロードマップ</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases" target="_blank" rel="noopener">利用例</a></li>
                        <li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">はじめよう</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/docker-community" target="_blank" rel="noopener">コミュニティー</a></li>
                        <li><a href="https://www.docker.com/open-source" target="_blank" rel="noopener">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/get-involved/developer-preview" target="_blank" rel="noopener">プレビュープログラム</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq" target="_blank" rel="noopener">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs" target="_blank" rel="noopener">Docker 認定公開者向けプログラム</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">パートナー</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社概要</a></b></li>
                        <li><a href="https://www.docker.com/what-container" target="_blank" rel="noopener">コンテナーって何？</a></li>
                        <li><a href="https://www.docker.com/why-docker" target="_blank" rel="noopener">なぜ Docker？</a></li>
                        <li><a href="https://www.docker.com/events" target="_blank" rel="noopener">仮想イベント</a></li>
                        <li><a href="https://www.docker.com/swag" target="_blank" rel="noopener">Swag ストア
                        </a></li>
                        <li><a href="https://www.docker.com/company/newsroom" target="_blank" rel="noopener">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers" target="_blank" rel="noopener">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact" target="_blank" rel="noopener">連絡先</a></li>
                        <li><a href="https://www.docker.com/customers" target="_blank" rel="noopener">顧客</a></li>
                        <li><a href="https://www.docker.com/newsletter-subscription" target="_blank" rel="noopener">ニュースレター</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="https://www.docker.com/legal/docker-terms-service" target="_blank" rel="noopener">サービス契約</a></li>
                        <li><a href="https://status.docker.com/" target="_blank" rel="noopener">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal" target="_blank" rel="noopener">法的情報</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="https://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="https://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/engine/security/trust/trust_sandbox/";</script></body>
</html>
