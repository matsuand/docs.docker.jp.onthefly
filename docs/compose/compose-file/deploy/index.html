<!DOCTYPE html>
<!-- Page generated 2022-04-29 17:35:28 +0900-->
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Compose file deploy reference | Docker ドキュメント</title>
  <meta name="description" content="Compose file deploy reference" />
  <meta name="keywords" content="fig, composition, compose, docker">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/compose/compose-file/deploy/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Compose file deploy reference"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="Compose file deploy reference" />
  <meta property="og:description" content="Compose file deploy reference" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2022-04-29T17:35:28+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/deploy/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2022-04-29T17:35:28+09:00"/>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","headline":"Compose file deploy reference","description":"Compose file deploy reference","url":"https://docs.docker.com/compose/compose-file/deploy/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs ホームページ"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/reference/">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a></li><li><a href="/docs.docker.jp.onthefly/compose/compose-file/deploy/">Compose file deploy</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Compose file deploy reference</h1><p><em class="reading-time">読む時間の目安: 9 分</em></p><p>Compose specification is a platform-neutral way to define multi-container applications. A Compose implementation supporting
deployment of application model MAY require some additional metadata as the Compose application model is way too abstract
to reflect actual infrastructure needs per service, or lifecycle constraints.</p>

<p>Compose Specification Deployment allows users to declare additional metadata on services so Compose implementations get
relevant data to allocate adequate resources on platform and configure them to match user’s needs.</p>

<h2 id="definitions">Definitions</h2>

<p>Compose Specification is extended to support an OPTIONAL <code class="highlighter-rouge">deploy</code> subsection on services. This section define runtime requirements
for a service.</p>

<h3 id="endpoint_mode">endpoint_mode</h3>

<p><code class="highlighter-rouge">endpoint_mode</code> specifies a service discovery method for external clients connecting to a service. Default and available values
are platform specific, anyway the Compose specification define two canonical values:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">endpoint_mode: vip</code>: Assigns the service a virtual IP (VIP) that acts as the front end for clients to reach the service
on a network. Platform routes requests between the client and nodes running the service, without client knowledge of how
many nodes are participating in the service or their IP addresses or ports.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">endpoint_mode: dnsrr</code>: Platform sets up DNS entries for the service such that a DNS query for the service name returns a
list of IP addresses (DNS round-robin), and the client connects directly to one of these.</p>
  </li>
</ul>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">awesome/webapp</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
      <span class="na">endpoint_mode</span><span class="pi">:</span> <span class="s">vip</span>
</code></pre></div></div>

<h3 id="labels">labels</h3>

<p><code class="highlighter-rouge">labels</code> specifies metadata for the service. These labels MUST <em>only</em> be set on the service and <em>not</em> on any containers for the service.
This assumes the platform has some native concept of “service” that can match Compose application model.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">awesome/webapp</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="s">com.example.description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">This</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">appear</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">service"</span>
</code></pre></div></div>

<h3 id="mode">mode</h3>

<p><code class="highlighter-rouge">mode</code> define the replication model used to run the service on platform. Either <code class="highlighter-rouge">global</code> (exactly one container per physical node) or <code class="highlighter-rouge">replicated</code> (a specified number of containers). The default is <code class="highlighter-rouge">replicated</code>.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">awesome/webapp</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">global</span>
</code></pre></div></div>

<h3 id="placement">placement</h3>

<p><code class="highlighter-rouge">placement</code> specifies constraints and preferences for platform to select a physical node to run service containers.</p>

<h4 id="constraints">constraints</h4>

<p><code class="highlighter-rouge">constraints</code> defines a REQUIRED property the platform’s node MUST fulfill to run service container. Can be set either
by a list or a map with string values.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">placement</span><span class="pi">:</span>
    <span class="na">constraints</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">disktype=ssd</span>
</code></pre></div></div>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">placement</span><span class="pi">:</span>
    <span class="na">constraints</span><span class="pi">:</span>
      <span class="na">disktype</span><span class="pi">:</span> <span class="s">ssd</span>
</code></pre></div></div>

<h4 id="preferences">preferences</h4>

<p><code class="highlighter-rouge">preferences</code> defines a property the platform’s node SHOULD fulfill to run service container. Can be set either
by a list or a map with string values.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">placement</span><span class="pi">:</span>
    <span class="na">preferences</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">datacenter=us-east</span>
</code></pre></div></div>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">placement</span><span class="pi">:</span>
    <span class="na">preferences</span><span class="pi">:</span>
      <span class="na">datacenter</span><span class="pi">:</span> <span class="s">us-east</span>
</code></pre></div></div>

<h3 id="replicas">replicas</h3>

<p>If the service is <code class="highlighter-rouge">replicated</code> (which is the default), <code class="highlighter-rouge">replicas</code> specifies the number of containers that SHOULD be
running at any given time.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">fronted</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">awesome/webapp</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">6</span>
</code></pre></div></div>

<h3 id="resources">resources</h3>

<p><code class="highlighter-rouge">resources</code> configures physical resource constraints for container to run on platform. Those constraints can be configured
as a:</p>

<ul>
  <li><code class="highlighter-rouge">limits</code>: The platform MUST prevent container to allocate more</li>
  <li><code class="highlighter-rouge">reservations</code>: The platform MUST guarantee container can allocate at least the configured amount</li>
</ul>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">awesome/webapp</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.50'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">50M</span>
          <span class="na">pids</span><span class="pi">:</span> <span class="s">1</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.25'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">20M</span>
</code></pre></div></div>

<h4 id="cpus">cpus</h4>

<p><code class="highlighter-rouge">cpus</code> configures a limit or reservation for how much of the available CPU resources (as number of cores) a container can use.</p>

<h4 id="memory">memory</h4>

<p><code class="highlighter-rouge">memory</code> configures a limit or reservation on the amount of memory a container
can allocate, set as a string expressing a
<a href="/docs.docker.jp.onthefly/compose/compose-file/#specifying-byte-values">byte value</a>.</p>

<h4 id="pids">pids</h4>

<p><code class="highlighter-rouge">pids</code> tunes a container’s PIDs limit, set as an integer.</p>

<h4 id="devices">devices</h4>

<p><code class="highlighter-rouge">devices</code> configures reservations of the devices a container can use. It contains a list of reservations, each set as an object with the following parameters: <code class="highlighter-rouge">capabilities</code>, <code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">count</code>, <code class="highlighter-rouge">device_ids</code> and <code class="highlighter-rouge">options</code>.</p>

<p>Devices are reserved using a list of capabilities, making <code class="highlighter-rouge">capabilities</code> the only required field. A device MUST satisfy all the requested capabilities for a successful reservation.</p>

<h5 id="capabilities">capabilities</h5>

<p><code class="highlighter-rouge">capabilities</code> are set as a list of strings, expressing both generic and driver specific capabilities.
The following generic capabilities are recognized today:</p>

<ul>
  <li><code class="highlighter-rouge">gpu</code>: Graphics accelerator</li>
  <li><code class="highlighter-rouge">tpu</code>: AI accelerator</li>
</ul>

<p>To avoid name clashes, driver specific capabilities MUST be prefixed with the driver name.
For example, reserving an nVidia CUDA-enabled accelerator might look like this:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">reservations</span><span class="pi">:</span>
      <span class="na">devices</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">nvidia-compute"</span><span class="pi">]</span>
</code></pre></div></div>

<h5 id="driver">driver</h5>

<p>A different driver for the reserved device(s) can be requested using <code class="highlighter-rouge">driver</code> field. The value is specified as a string.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">reservations</span><span class="pi">:</span>
      <span class="na">devices</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">nvidia-compute"</span><span class="pi">]</span>
          <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
</code></pre></div></div>

<h5 id="count">count</h5>

<p>If <code class="highlighter-rouge">count</code> is set to <code class="highlighter-rouge">all</code> or not specified, Compose implementations MUST reserve all devices that satisfy the requested capabilities. Otherwise, Compose implementations MUST reserve at least the number of devices specified. The value is specified as an integer.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">reservations</span><span class="pi">:</span>
      <span class="na">devices</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">tpu"</span><span class="pi">]</span>
          <span class="na">count</span><span class="pi">:</span> <span class="s">2</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">count</code> and <code class="highlighter-rouge">device_ids</code> fields are exclusive. Compose implementations MUST return an error if both are specified.</p>

<h5 id="device_ids">device_ids</h5>

<p>If <code class="highlighter-rouge">device_ids</code> is set, Compose implementations MUST reserve devices with the specified IDs providing they satisfy the requested capabilities. The value is specified as a list of strings.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">reservations</span><span class="pi">:</span>
      <span class="na">devices</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">gpu"</span><span class="pi">]</span>
          <span class="na">device_ids</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">GPU-f123d1c9-26bb-df9b-1c23-4a731f61d8c7"</span><span class="pi">]</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">count</code> and <code class="highlighter-rouge">device_ids</code> fields are exclusive. Compose implementations MUST return an error if both are specified.</p>

<h5 id="options">options</h5>

<p>Driver specific options can be set with <code class="highlighter-rouge">options</code> as key-value pairs.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">reservations</span><span class="pi">:</span>
      <span class="na">devices</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">gpu"</span><span class="pi">]</span>
          <span class="na">driver</span><span class="pi">:</span> <span class="s">gpuvendor</span>
          <span class="na">options</span><span class="pi">:</span>
            <span class="na">virtualization</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div>

<h3 id="restart_policy">restart_policy</h3>

<p><code class="highlighter-rouge">restart_policy</code> configures if and how to restart containers when they exit. If <code class="highlighter-rouge">restart_policy</code> is not set, Compose implementations MUST consider <code class="highlighter-rouge">restart</code> field set by service configuration.</p>

<ul>
  <li><code class="highlighter-rouge">condition</code>: One of <code class="highlighter-rouge">none</code>, <code class="highlighter-rouge">on-failure</code> or <code class="highlighter-rouge">any</code> (default: <code class="highlighter-rouge">any</code>).</li>
  <li><code class="highlighter-rouge">delay</code>: How long to wait between restart attempts, specified as a <a href="/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations">duration</a> (default: 0).</li>
  <li><code class="highlighter-rouge">max_attempts</code>: How many times to attempt to restart a container before giving up (default: never give up). If the restart does not
succeed within the configured <code class="highlighter-rouge">window</code>, this attempt doesn’t count toward the configured <code class="highlighter-rouge">max_attempts</code> value.
For example, if <code class="highlighter-rouge">max_attempts</code> is set to ‘2’, and the restart fails on the first attempt, more than two restarts MUST be attempted.</li>
  <li><code class="highlighter-rouge">window</code>: How long to wait before deciding if a restart has succeeded, specified as a <a href="/docs.docker.jp.onthefly/compose/compose-file/#specifying-durations">duration</a> (default:
decide immediately).</li>
</ul>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">restart_policy</span><span class="pi">:</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
    <span class="na">delay</span><span class="pi">:</span> <span class="s">5s</span>
    <span class="na">max_attempts</span><span class="pi">:</span> <span class="s">3</span>
    <span class="na">window</span><span class="pi">:</span> <span class="s">120s</span>
</code></pre></div></div>

<h3 id="rollback_config">rollback_config</h3>

<p><code class="highlighter-rouge">rollback_config</code> configures how the service should be rollbacked in case of a failing update.</p>

<ul>
  <li><code class="highlighter-rouge">parallelism</code>: The number of containers to rollback at a time. If set to 0, all containers rollback simultaneously.</li>
  <li><code class="highlighter-rouge">delay</code>: The time to wait between each container group’s rollback (default 0s).</li>
  <li><code class="highlighter-rouge">failure_action</code>: What to do if a rollback fails. One of <code class="highlighter-rouge">continue</code> or <code class="highlighter-rouge">pause</code> (default <code class="highlighter-rouge">pause</code>)</li>
  <li><code class="highlighter-rouge">monitor</code>: Duration after each task update to monitor for failure <code class="highlighter-rouge">(ns|us|ms|s|m|h)</code> (default 0s).</li>
  <li><code class="highlighter-rouge">max_failure_ratio</code>: Failure rate to tolerate during a rollback (default 0).</li>
  <li><code class="highlighter-rouge">order</code>: Order of operations during rollbacks. One of <code class="highlighter-rouge">stop-first</code> (old task is stopped before starting new one),
 or <code class="highlighter-rouge">start-first</code> (new task is started first, and the running tasks briefly overlap) (default <code class="highlighter-rouge">stop-first</code>).</li>
</ul>

<h3 id="update_config">update_config</h3>

<p><code class="highlighter-rouge">update_config</code> configures how the service should be updated. Useful for configuring rolling updates.</p>

<ul>
  <li><code class="highlighter-rouge">parallelism</code>: The number of containers to update at a time.</li>
  <li><code class="highlighter-rouge">delay</code>: The time to wait between updating a group of containers.</li>
  <li><code class="highlighter-rouge">failure_action</code>: What to do if an update fails. One of <code class="highlighter-rouge">continue</code>, <code class="highlighter-rouge">rollback</code>, or <code class="highlighter-rouge">pause</code> (default: <code class="highlighter-rouge">pause</code>).</li>
  <li><code class="highlighter-rouge">monitor</code>: Duration after each task update to monitor for failure <code class="highlighter-rouge">(ns|us|ms|s|m|h)</code> (default 0s).</li>
  <li><code class="highlighter-rouge">max_failure_ratio</code>: Failure rate to tolerate during an update.</li>
  <li><code class="highlighter-rouge">order</code>: Order of operations during updates. One of <code class="highlighter-rouge">stop-first</code> (old task is stopped before starting new one),
 or <code class="highlighter-rouge">start-first</code> (new task is started first, and the running tasks briefly overlap) (default <code class="highlighter-rouge">stop-first</code>).</li>
</ul>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">update_config</span><span class="pi">:</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">2</span>
    <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
    <span class="na">order</span><span class="pi">:</span> <span class="s">stop-first</span>
</code></pre></div></div>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=fig">fig</a>, <a href="/docs.docker.jp.onthefly/search/?q=composition">composition</a>, <a href="/docs.docker.jp.onthefly/search/?q=compose">compose</a>, <a href="/docs.docker.jp.onthefly/search/?q=docker">docker</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/compose/compose-file/deploy.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [compose/compose-file/deploy.ch](https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/deploy/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#definitions" class="nomunge">Definitions</a>
    <ul>
      <li><a href="#endpoint_mode" class="nomunge">endpoint_mode</a></li>
      <li><a href="#labels" class="nomunge">labels</a></li>
      <li><a href="#mode" class="nomunge">mode</a></li>
      <li><a href="#placement" class="nomunge">placement</a>
        <ul>
          <li><a href="#constraints" class="nomunge">constraints</a></li>
          <li><a href="#preferences" class="nomunge">preferences</a></li>
        </ul>
      </li>
      <li><a href="#replicas" class="nomunge">replicas</a></li>
      <li><a href="#resources" class="nomunge">resources</a>
        <ul>
          <li><a href="#cpus" class="nomunge">cpus</a></li>
          <li><a href="#memory" class="nomunge">memory</a></li>
          <li><a href="#pids" class="nomunge">pids</a></li>
          <li><a href="#devices" class="nomunge">devices</a></li>
        </ul>
      </li>
      <li><a href="#restart_policy" class="nomunge">restart_policy</a></li>
      <li><a href="#rollback_config" class="nomunge">rollback_config</a></li>
      <li><a href="#update_config" class="nomunge">update_config</a></li>
    </ul>
  </li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products" target="_blank" rel="noopener">製品ラインアップ</a></b></li>
                        <li><a href="https://www.docker.com/products/personal" target="_blank" rel="noopener">Docker Personal</a></li>
                        <li><a href="https://www.docker.com/products/pro" target="_blank" rel="noopener">Docker Pro</a></li>
                        <li><a href="https://www.docker.com/products/team" target="_blank" rel="noopener">Docker Team</a></li>
                        <li><a href="https://www.docker.com/products/business" target="_blank" rel="noopener">Docker Business</a></li>
                        <li><a href="https://www.docker.com/products" target="_blank" rel="noopener">サブスクリプション比較</a></li>
                        <li><b><a href="https://www.docker.com/" target="_blank" rel="noopener">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub" target="_blank" rel="noopener">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/products/secure-software-supply-chain" target="_blank" rel="noopener">セキュアなソフトウェアサプライチェーン</a></li>
                        <li><a href="https://www.docker.com/products/container-runtime" target="_blank" rel="noopener">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools" target="_blank" rel="noopener">開発ツール</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">信頼できるコンテント</a></li>
                        <li><a href="https://www.docker.com/roadmap" target="_blank" rel="noopener">Docker 製品ロードマップ</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases" target="_blank" rel="noopener">利用例</a></li>
                        <li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">はじめよう</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/docker-community" target="_blank" rel="noopener">コミュニティー</a></li>
                        <li><a href="https://www.docker.com/open-source" target="_blank" rel="noopener">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/get-involved/developer-preview" target="_blank" rel="noopener">プレビュープログラム</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq" target="_blank" rel="noopener">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs" target="_blank" rel="noopener">Docker 認定公開者向けプログラム</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">パートナー</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社概要</a></b></li>
                        <li><a href="https://www.docker.com/what-container" target="_blank" rel="noopener">コンテナーって何？</a></li>
                        <li><a href="https://www.docker.com/why-docker" target="_blank" rel="noopener">なぜ Docker？</a></li>
                        <li><a href="https://www.docker.com/events" target="_blank" rel="noopener">仮想イベント</a></li>
                        <li><a href="https://www.docker.com/swag" target="_blank" rel="noopener">Swag ストア
                        </a></li>
                        <li><a href="https://www.docker.com/company/newsroom" target="_blank" rel="noopener">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers" target="_blank" rel="noopener">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact" target="_blank" rel="noopener">連絡先</a></li>
                        <li><a href="https://www.docker.com/customers" target="_blank" rel="noopener">顧客</a></li>
                        <li><a href="https://www.docker.com/newsletter-subscription" target="_blank" rel="noopener">ニュースレター</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="https://www.docker.com/legal/docker-terms-service" target="_blank" rel="noopener">サービス契約</a></li>
                        <li><a href="https://status.docker.com/" target="_blank" rel="noopener">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal" target="_blank" rel="noopener">法的情報</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="https://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="https://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/compose/compose-file/deploy/";</script></body>
</html>
