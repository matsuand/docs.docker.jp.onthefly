<!-- Page generated 2021-09-11 14:21:28 +0900-->
<!DOCTYPE html>
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Build your Go image | Docker ドキュメント</title>
  <meta name="description" content="Learn how to build your first Docker image by writing a Dockerfile" />
  <meta name="keywords" content="containers, images, go, golang, dockerfiles, coding, build, push, run">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/language/golang/build-images/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Build your Go image"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="Build your Go image" />
  <meta property="og:description" content="Learn how to build your first Docker image by writing a Dockerfile" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-09-11T14:21:28+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/language/golang/build-images/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-09-11T14:21:28+09:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Build your Go image","description":"Learn how to build your first Docker image by writing a Dockerfile","url":"https://docs.docker.com/language/golang/build-images/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/get-started/overview/">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/language/">各種言語別ガイド (New)</a></li><li><a href="/docs.docker.jp.onthefly/language/golang/">Go 言語</a></li><li><a href="/docs.docker.jp.onthefly/language/golang/build-images/">イメージのビルド</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Build your Go image</h1><p><em class="reading-time">読む時間の目安: 17 分</em></p><ul class="pagination">
  <li class="active"><a href="/docs.docker.jp.onthefly/language/golang/build-images/">イメージのビルド</a></li>
  <li><a href="/docs.docker.jp.onthefly/language/golang/run-containers/">コンテナーとしてイメージ実行</a></li>
  <li><a href="/docs.docker.jp.onthefly/language/golang/develop/">コンテナーの開発利用</a></li>
  <li><a href="/docs.docker.jp.onthefly/language/golang/run-tests/">テストの実行</a></li>
  <li><a href="/docs.docker.jp.onthefly/language/golang/configure-ci-cd/">CI/CD の設定</a></li>
  <li><a href="/docs.docker.jp.onthefly/language/golang/deploy/">アプリのデプロイ</a></li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Some understanding of Go and its toolchain. This is not a tutorial on Go. If you are new to the language, the <a href="https://golang.org/" target="_blank" rel="noopener" class="_">Go website</a> is a good starting point, so go (pun intended) check it out.</li>
  <li>Some awareness of basic Docker concepts. If unsure, work through the orientation and setup in Get started <a href="/docs.docker.jp.onthefly/get-started/">Part 1</a>.</li>
</ul>

<h2 id="overview">Overview</h2>

<p>Now that we have a good overview of containers and the Docker platform, let’s take a look at building our first image. An image includes everything you need to run an application – the code or binary, runtime, dependencies, and any other file system objects required.</p>

<p>To complete this tutorial, you need the following:</p>

<ul>
  <li>Go version 1.16 or later. You might want to <a href="https://golang.org/dl/">download and install Go</a> first.</li>
  <li>Docker running locally. Follow the instructions to <a href="https://docs.docker.com/desktop/">download and install Docker</a>.</li>
  <li>An IDE or a text editor to edit files. We recommend using <a href="https://code.visualstudio.com/" target="_blank" rel="noopener" class="_">Visual Studio Code</a>.</li>
</ul>

<h2 id="meet-the-example-application">Meet the example application</h2>

<p>To avoid losing focus on Docker’s features, the sample application is a minimal HTTP server that has only three features:</p>

<ul>
  <li>It responds with a text message containing a heart symbol (“&lt;3”) on requests to <code class="language-plaintext highlighter-rouge">/</code>.</li>
  <li>It responds with <code class="language-plaintext highlighter-rouge">{"Status" : "OK"}</code> JSON to the health check request on requests to <code class="language-plaintext highlighter-rouge">/ping</code>.</li>
  <li>The port it listens on is configurable using the environment variable <code class="language-plaintext highlighter-rouge">HTTP_PORT</code>. The default value is <code class="language-plaintext highlighter-rouge">8080</code>.</li>
</ul>

<p>Thus, it somewhat mimics enough basic properties of a REST microservice to be useful for our learning of Docker.</p>

<p>The source code for the application is in the <a href="https://github.com/olliefr/docker-gs-ping" target="_blank" rel="noopener" class="_">olliefr/docker-gs-ping</a> GitHub repo. Please feel free to clone or fork it.</p>

<p>For our present study, we clone it to our local machine:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>git clone https://github.com/olliefr/docker-gs-ping
</code></pre></div></div>

<p>The application’s <code class="language-plaintext highlighter-rouge">main.go</code> file is fairly straightforward, if you are familiar with Go:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"net/http"</span>
	<span class="s">"os"</span>

	<span class="s">"github.com/labstack/echo/v4"</span>
	<span class="s">"github.com/labstack/echo/v4/middleware"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

	<span class="n">e</span> <span class="o">:=</span> <span class="n">echo</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>

	<span class="n">e</span><span class="o">.</span><span class="n">Use</span><span class="p">(</span><span class="n">middleware</span><span class="o">.</span><span class="n">Logger</span><span class="p">())</span>
	<span class="n">e</span><span class="o">.</span><span class="n">Use</span><span class="p">(</span><span class="n">middleware</span><span class="o">.</span><span class="n">Recover</span><span class="p">())</span>

	<span class="n">e</span><span class="o">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">c</span> <span class="n">echo</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span><span class="p">,</span> <span class="s">"Hello, Docker! &lt;3"</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="n">e</span><span class="o">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/ping"</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">c</span> <span class="n">echo</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">JSON</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span><span class="p">,</span> <span class="k">struct</span><span class="p">{</span> <span class="n">Status</span> <span class="kt">string</span> <span class="p">}{</span><span class="n">Status</span><span class="o">:</span> <span class="s">"OK"</span><span class="p">})</span>
	<span class="p">})</span>

	<span class="n">httpPort</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"HTTP_PORT"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">httpPort</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
		<span class="n">httpPort</span> <span class="o">=</span> <span class="s">"8080"</span>
	<span class="p">}</span>

	<span class="n">e</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="s">":"</span> <span class="o">+</span> <span class="n">httpPort</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="smoke-test-the-application">Smoke test the application</h2>

<p>Let’s start our application and make sure it’s running properly. Open your terminal and navigate to the directory into which you cloned the project’s repo. From now on, we’ll refer to this directory as the <strong>working directory</strong>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>go run main.go
</code></pre></div></div>

<p>This should compile and start the server as a foreground application, outputting the banner, as illustrated in the next figure.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   ____    __
  / __/___/ /  ___
 / _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.2.2
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
                                    O\
⇨ http server started on [::]:8080
</code></pre></div></div>

<p>Let’s run a quick <em>smoke test</em> on the application. <strong>In a new terminal</strong>, run a request using <code class="language-plaintext highlighter-rouge">curl</code>. Alternatively, you can use your favourite web browser as well.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>curl http://localhost:8080/
<span class="go">Hello, Docker! &lt;3
</span></code></pre></div></div>

<p>So, the application responds with a greeting, just as the first business requirement says it should. Great.</p>

<p>Having established that the server is running and is accessible, let’s proceed to “dockerizing” it.</p>

<h2 id="create-a-dockerfile-for-the-application">Create a Dockerfile for the application</h2>

<p>Dockerfile とは、 Docker イメージを取得する命令を含んだテキストファイルのことです。
Docker に対して<code class="language-plaintext highlighter-rouge">docker build</code>コマンドを実行してイメージビルドを指示すると、Docker は記述された命令を読み込んで実行し、最終的に Docker イメージを作り出します。</p>

<p>ではアプリケーション向けに Dockerfile を生成していく手順を見ていきます。
プロジェクトのルートディレクトリに<code class="language-plaintext highlighter-rouge">Dockerfile</code>という名前のファイルを生成して、テキストエディターでこれを開きます。</p>

<blockquote>
  <p><strong>Dockerfile の名前を何にするか</strong></p>

  <p>Dockerfile に対して用いられるデフォルトのファイル名は、 <code class="language-plaintext highlighter-rouge">Dockerfile</code> です (ファイル拡張子はありません)。
このデフォルトファイル名を用いておけば、<code class="language-plaintext highlighter-rouge">docker build</code>コマンドを実行する際に、コマンドラインフラグを追加して指定する必要がありません。</p>

  <p>プロジェクトによっては、特定の目的のため、Dockerfile に別名を与える場合があります。
普通行われる慣例としては、<code class="language-plaintext highlighter-rouge">Dockerfile.&lt;something&gt;</code>や<code class="language-plaintext highlighter-rouge">&lt;something&gt;.Dockerfile</code>とします。
このような Dockerfile は、<code class="language-plaintext highlighter-rouge">docker build</code>コマンドの実行にあたって、<code class="language-plaintext highlighter-rouge">--file</code>オプション (その短縮形<code class="language-plaintext highlighter-rouge">-f</code>) を用いて指定します。
<code class="language-plaintext highlighter-rouge">--file</code>オプションの利用方法については、<code class="language-plaintext highlighter-rouge">docker build</code>リファレンス内の <a href="/docs.docker.jp.onthefly/engine/reference/commandline/build/#specify-a-dockerfile--f">Dockerfile の指定</a> のセクションを参照してください。</p>

  <p>プロジェクトの主となる Dockerfile には、デフォルト名 (<code class="language-plaintext highlighter-rouge">Dockerfile</code>) を用いることをお勧めします。
本ガイドに示すほとんどの例においては、この名前を用いています。</p>
</blockquote>

<p>Docker ファイルの 1 行めに書くのは <a href="/docs.docker.jp.onthefly/engine/reference/builder/#syntax"><code class="language-plaintext highlighter-rouge"># syntax</code>パーサーディレクティブ</a> です。
これは <strong>任意の記述</strong> ではありますが、Dockerfile の解析にあたって Docker ビルダーがどの文法を採用するのかを指示します。
また古い Docker バージョンにおいて BuildKit を利用する際に、ビルド前にパーサーをアップグレードするようになります。
<a href="/docs.docker.jp.onthefly/engine/reference/builder/#parser-directives">パーサーディレクティブ</a> は Dockerfile において、いずれのコメント、空行、Dockerfile 命令よりも前に、つまり第一に記述することが必要です。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">docker/dockerfile:1</code>を用いることをお勧めします。
こうしておくと、常に文法バージョン 1 の最新リリース版を指し示すことになります。
BuildKit は、ビルド処理の前に文法に更新がないかを自動的にチェックし、最新バージョンが用いられていることを確認します。</p>

<p>Next, we need to add a line in our Dockerfile that tells Docker what base image
we would like to use for our application.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>

<span class="k">FROM</span><span class="s"> golang:1.16-alpine</span>
</code></pre></div></div>

<p>Docker images can be inherited from other images. Therefore, instead of creating our own base image, we’ll use the official Go image that already has all the tools and packages to compile and run a Go application. You can think of this in the same way you would think about class inheritance in object oriented programming or functional composition in functional programming.</p>

<p>When we have used that <code class="language-plaintext highlighter-rouge">FROM</code> command, we told Docker to include in our image all the functionality from the <code class="language-plaintext highlighter-rouge">golang:1.16-alpine</code> image. All of our consequent commands would build on top of that “base” image.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>If you want to learn more about creating your own base images, see <a href="https://docs.docker.com/develop/develop-images/baseimages/">creating base images</a> section of the guide.</p>
</blockquote>

<p>To make things easier when running the rest of our commands, let’s create a directory <em>inside</em> the image that we are building. This also instructs Docker to use this directory as the default <em>destination</em> for all subsequent commands. This way we do not have to type out full file paths but can use relative paths based on this directory.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WORKDIR</span><span class="s"> /app</span>
</code></pre></div></div>

<p>Usually the very first thing you do once you’ve downloaded a project written in Go is to install the modules necessary to compile it.</p>

<p>But before we can run <code class="language-plaintext highlighter-rouge">go mod download</code> inside our image, we need to get our <code class="language-plaintext highlighter-rouge">go.mod</code> and <code class="language-plaintext highlighter-rouge">go.sum</code> files copied into it. We use the <code class="language-plaintext highlighter-rouge">COPY</code> command to do this.</p>

<p>In its simplest form, the <code class="language-plaintext highlighter-rouge">COPY</code> command takes two parameters. The first parameter tells Docker what file you would like to copy into the image. The second parameter tells Docker where you want that file to be copied to.</p>

<p>We’ll copy the <code class="language-plaintext highlighter-rouge">go.mod</code> and <code class="language-plaintext highlighter-rouge">go.sum</code> file into our working directory <code class="language-plaintext highlighter-rouge">/app</code> which, owing to our use of <code class="language-plaintext highlighter-rouge">WORKDIR</code>, is the current directory (<code class="language-plaintext highlighter-rouge">.</code>) inside the image.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span><span class="s"> go.mod ./</span>
<span class="k">COPY</span><span class="s"> go.sum ./</span>
</code></pre></div></div>

<p>Now that we have the module files inside the Docker image that we are building, we can use the <code class="language-plaintext highlighter-rouge">RUN</code> command to execute the command <code class="language-plaintext highlighter-rouge">go mod download</code> there as well. This works exactly the same as if we were running <code class="language-plaintext highlighter-rouge">go</code> locally on our machine, but this time these Go modules will be installed into the app directory inside our image.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">RUN </span>go mod download
</code></pre></div></div>

<p>At this point, we have an image that is based on Go environment version 1.16 (or a later minor version, since we had specified <code class="language-plaintext highlighter-rouge">1.16</code> as our tag in the <code class="language-plaintext highlighter-rouge">FROM</code> command) and we have installed our dependencies.</p>

<p>The next thing we need to do is to copy our source code into the image. We’ll use the <code class="language-plaintext highlighter-rouge">COPY</code> command just like we did with our module files before.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span><span class="s"> *.go ./</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">COPY</code> command uses a wildcard to copy all files with <code class="language-plaintext highlighter-rouge">.go</code> extension located in the current directory on the host (the directory where the <code class="language-plaintext highlighter-rouge">Dockerfile</code> is located) into the current directory inside the image.</p>

<p>Now, we would like to compile our application. To that end, we use the familiar <code class="language-plaintext highlighter-rouge">RUN</code> command:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">RUN </span>go build <span class="nt">-o</span> /docker-gs-ping
</code></pre></div></div>

<p>This should be familiar. The result of that command will be a static application binary named <code class="language-plaintext highlighter-rouge">docker-gs-ping</code> and located in the root of the filesystem of the image that we are building. We could have put the binary into any other place we desire inside that image, the root directory has no special meaning in this regard. It’s just convenient to use it to keep the file paths short for improved readability.</p>

<p>Now, all that is left to do is to tell Docker what command to execute when our image is used to start a container.</p>

<p>We do this with the <code class="language-plaintext highlighter-rouge">CMD</code> command:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CMD</span><span class="s"> [ "/docker-gs-ping" ]</span>
</code></pre></div></div>

<p>Here’s the complete <code class="language-plaintext highlighter-rouge">Dockerfile</code>:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>

<span class="k">FROM</span><span class="s"> golang:1.16-alpine</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> go.mod ./</span>
<span class="k">COPY</span><span class="s"> go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> *.go ./</span>

<span class="k">RUN </span>go build <span class="nt">-o</span> /docker-gs-ping

<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">CMD</span><span class="s"> [ "/docker-gs-ping" ]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Dockerfile</code> may also contain <em>comments</em>. They always begin with a <code class="language-plaintext highlighter-rouge">#</code> symbol and make no difference to Docker. The comments are there for the convenience of humans tasked to maintain the <code class="language-plaintext highlighter-rouge">Dockerfile</code>:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>

<span class="c"># Alpine is chosen for its small footprint</span>
<span class="c"># compared to Ubuntu</span>
<span class="k">FROM</span><span class="s"> golang:1.16-alpine</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Download necessary Go modules</span>
<span class="k">COPY</span><span class="s"> go.mod ./</span>
<span class="k">COPY</span><span class="s"> go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="c"># ... the rest of the Dockerfile is ...</span>
<span class="c"># ...   omitted from this example   ...</span>
</code></pre></div></div>

<h2 id="build-the-image">Build the image</h2>

<p>Now that we’ve created our <code class="language-plaintext highlighter-rouge">Dockerfile</code>, let’s build an image from it. The <code class="language-plaintext highlighter-rouge">docker build</code> command creates Docker images from the <code class="language-plaintext highlighter-rouge">Dockerfile</code> and a “context”. A build <em>context</em> is the set of files located in the specified path or URL. The Docker build process can access any of the files located in the context.</p>

<p>The build command optionally takes a <code class="language-plaintext highlighter-rouge">--tag</code> flag. This flag is used to label the image with a string value, which is easy for humans to read and recognise. If you do not pass a <code class="language-plaintext highlighter-rouge">--tag</code>, Docker will use <code class="language-plaintext highlighter-rouge">latest</code> as the default value.</p>

<p>Let’s build our first Docker image!</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">--tag</span> docker-gs-ping <span class="nb">.</span>
<span class="go">
[+] Building 3.6s (12/12) FINISHED
</span><span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load build definition from Dockerfile                                      0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> transferring dockerfile: 38B                                                       0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load .dockerignore                                                         0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> transferring context: 2B                                                           0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load metadata <span class="k">for </span>docker.io/library/golang:1.16-alpine                     3.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>1/7] FROM docker.io/library/golang:1.16-alpine@sha256:49c07aa83790aca732250c2258b59  0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> resolve docker.io/library/golang:1.16-alpine@sha256:49c07aa83790aca732250c2258b59  0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load build context                                                         0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> transferring context: 114B                                                         0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>2/7] WORKDIR /app                                                             0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>3/7] COPY go.mod <span class="nb">.</span>                                                            0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>4/7] COPY go.sum <span class="nb">.</span>                                                            0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>5/7] RUN go mod download                                                      0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>6/7] COPY <span class="k">*</span>.go <span class="nb">.</span>                                                              0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>7/7] RUN go build <span class="nt">-o</span> /docker-gs-ping                                          0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>exporting to image                                                                    0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> exporting layers                                                                   0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> writing image sha256:336a3f164d0f079f2e42cd1d38f24ab9110d47d481f1db7f2a0b0d2859ec  0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> naming to docker.io/library/docker-gs-ping                                         0.0s
<span class="go">
Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them
</span></code></pre></div></div>

<p>Your exact output will vary, but provided there aren’t any errors, you should see the <code class="language-plaintext highlighter-rouge">FINISHED</code> line in the build output. This means Docker has successfully built our image and assigned a <code class="language-plaintext highlighter-rouge">docker-gs-ping</code> tag to it.</p>

<h2 id="view-local-images">View local images</h2>

<p>To see the list of images we have on our local machine, we have two options. One is to use the CLI and the other is to use <a href="/docs.docker.jp.onthefly/desktop/">Docker Desktop</a>. Since we are currently working in the terminal, let’s take a look at listing images with the CLI.</p>

<p>To list images, simply run the <code class="language-plaintext highlighter-rouge">images</code> command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker images
<span class="go">
REPOSITORY       TAG       IMAGE ID       CREATED          SIZE
docker-gs-ping   latest    336a3f164d0f   39 minutes ago   540MB
postgres         13.2      c5ec7353d87d   7 weeks ago      314MB
</span></code></pre></div></div>

<p>Your exact output may vary, but you should see <code class="language-plaintext highlighter-rouge">docker-gs-ping</code> image with the <code class="language-plaintext highlighter-rouge">latest</code> tag.</p>

<h2 id="tag-images">Tag images</h2>

<p>An image name is made up of slash-separated name components. Name components may contain lowercase letters, digits and separators. A separator is defined as a period, one or two underscores, or one or more dashes. A name component may not start or end with a separator.</p>

<p>An image is made up of a manifest and a list of layers. In simple terms, a “tag” points to a combination of these artifacts. You can have multiple tags for the image and, in fact, most images have multiple tags. Let’s create a second tag for the image we had built and take a look at its layers.</p>

<p>To create a new tag for our image, run the following command.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker tag docker-gs-ping:latest docker-gs-ping:v1.0
</code></pre></div></div>

<p>The Docker <code class="language-plaintext highlighter-rouge">tag</code> command creates a new tag for the image. It does not create a new image. The tag points to the same image and is just another way to reference the image.</p>

<p>Now run the <code class="language-plaintext highlighter-rouge">docker images</code> command to see the updated list of local images:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker images
<span class="go">
REPOSITORY       TAG       IMAGE ID       CREATED          SIZE
docker-gs-ping   latest    336a3f164d0f   43 minutes ago   540MB
docker-gs-ping   v1.0      336a3f164d0f   43 minutes ago   540MB
postgres         13.2      c5ec7353d87d   7 weeks ago      314MB
</span></code></pre></div></div>

<p>You can see that we have two images that start with <code class="language-plaintext highlighter-rouge">docker-gs-ping</code>. We know they are the same image because if you look at the <code class="language-plaintext highlighter-rouge">IMAGE ID</code> column, you can see that the values are the same for the two images. This value is a unique identifier Docker uses internally to identify the image.</p>

<p>Let’s remove the tag that we had just created. To do this, we’ll use the <code class="language-plaintext highlighter-rouge">rmi</code> command, which stands for “remove image”:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker rmi docker-gs-ping:v1.0
<span class="go">Untagged: docker-gs-ping:v1.0
</span></code></pre></div></div>

<p>Notice that the response from Docker tells us that the image has not been removed but only “untagged”. Verify this by running the images command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker images
<span class="go">
REPOSITORY       TAG       IMAGE ID       CREATED          SIZE
docker-gs-ping   latest    336a3f164d0f   45 minutes ago   540MB
postgres         13.2      c5ec7353d87d   7 weeks ago      314MB
</span></code></pre></div></div>

<p>The tag <code class="language-plaintext highlighter-rouge">v1.0</code> has been removed but we still have the <code class="language-plaintext highlighter-rouge">docker-gs-ping:latest</code> tag available on our machine, so the image is there.</p>

<h2 id="multi-stage-builds">Multi-stage builds</h2>

<p>You may have noticed that our <code class="language-plaintext highlighter-rouge">docker-gs-ping</code> image stands at 540MB, which you may think is a lot. You may also be wondering whether our dockerized application still needs the full suite of Go tools, including the compiler, after the application binary had been compiled.</p>

<p>These are legit concerns. Both can be solved by using <em>multi-stage builds</em>. The following example is provided with little explanation because this would derail us from our current concerns, but please feel free to explore on your own later. The main idea is that we use one image to produce some artefacts, which are then placed into another, much smaller image, containing only the parts necessary for running the artefacts that we’d built.</p>

<p>The <code class="language-plaintext highlighter-rouge">Dockerfile.multistage</code> in the sample application’s repo has the following content:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>

<span class="c">##</span>
<span class="c">## Build</span>
<span class="c">##</span>
<span class="k">FROM</span><span class="s"> golang:1.16-buster AS build</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> go.mod ./</span>
<span class="k">COPY</span><span class="s"> go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> *.go ./</span>

<span class="k">RUN </span>go build <span class="nt">-o</span> /docker-gs-ping

<span class="c">##</span>
<span class="c">## Deploy</span>
<span class="c">##</span>
<span class="k">FROM</span><span class="s"> gcr.io/distroless/base-debian10</span>

<span class="k">WORKDIR</span><span class="s"> /</span>

<span class="k">COPY</span><span class="s"> --from=build /docker-gs-ping /docker-gs-ping</span>

<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">USER</span><span class="s"> nonroot:nonroot</span>

<span class="k">ENTRYPOINT</span><span class="s"> ["/docker-gs-ping"]</span>
</code></pre></div></div>

<p>Since we have two dockerfiles now, we have to tell Docker that we want to build using our new Dockerfile. We also tag the new image with <code class="language-plaintext highlighter-rouge">multistage</code> but this word has no special meaning, we only do so that we could compare this new image to the one we’ve built previously, that is the one we tagged with <code class="language-plaintext highlighter-rouge">latest</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">-t</span> docker-gs-ping:multistage <span class="nt">-f</span> Dockerfile.multistage <span class="nb">.</span>
</code></pre></div></div>

<p>Comparing the sizes of <code class="language-plaintext highlighter-rouge">docker-gs-ping:multistage</code> and <code class="language-plaintext highlighter-rouge">docker-gs-ping:latest</code> we see an order-of-magnitude difference!</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker images
<span class="go">
REPOSITORY       TAG          IMAGE ID       CREATED              SIZE
docker-gs-ping   multistage   e3fdde09f172   About a minute ago   27.1MB
docker-gs-ping   latest       336a3f164d0f   About an hour ago    540MB
</span></code></pre></div></div>

<p>This is due to the fact that the <a href="https://github.com/GoogleContainerTools/distroless">“distroless” base image</a> that we have used to deploy our Go application is very barebones and is meant for lean deployments of static binaries.</p>

<p>For more information on multi-stage builds, please feel free to check out <a href="/docs.docker.jp.onthefly/develop/develop-images/multistage-build/">other parts</a> of Docker documentation. This is, however, not essential for our progress here, so we’ll leave it at that.</p>

<h2 id="next-steps">Next steps</h2>

<p>In this module, we took a look at setting up our example Go application that we will use for much of the rest of the tutorial. We also created a <code class="language-plaintext highlighter-rouge">Dockerfile</code> that we used to build our Docker image. Then, we took a look at tagging our images and removing images and tags. In the next module, we’ll take a look at how to:</p>

<p><a href="/docs.docker.jp.onthefly/language/golang/run-containers/" class="button outline-btn">Run your image as a container</a></p>

<h2 id="feedback">Feedback</h2>

<p>Help us improve this topic by providing your feedback. Let us know what you think by creating an issue in the <a href="https://github.com/docker/docker.github.io/issues/new?title=[Golang%20docs%20feedback]" target="_blank" rel="noopener" class="_">Docker Docs </a> GitHub repository. Alternatively, <a href="https://github.com/docker/docker.github.io/pulls" target="_blank" rel="noopener" class="_">create a PR</a> to suggest updates.</p>

<p><br /></p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=containers">containers</a>, <a href="/docs.docker.jp.onthefly/search/?q=images">images</a>, <a href="/docs.docker.jp.onthefly/search/?q=go">go</a>, <a href="/docs.docker.jp.onthefly/search/?q=golang">golang</a>, <a href="/docs.docker.jp.onthefly/search/?q=dockerfiles">dockerfiles</a>, <a href="/docs.docker.jp.onthefly/search/?q=coding">coding</a>, <a href="/docs.docker.jp.onthefly/search/?q=build">build</a>, <a href="/docs.docker.jp.onthefly/search/?q=push">push</a>, <a href="/docs.docker.jp.onthefly/search/?q=run">run</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/language/golang/build-images.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [language/golang/build-images.ch](https://matsuand.github.io/docs.docker.jp.onthefly/language/golang/build-images/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#prerequisites" class="nomunge">Prerequisites</a></li>
  <li><a href="#overview" class="nomunge">Overview</a></li>
  <li><a href="#meet-the-example-application" class="nomunge">Meet the example application</a></li>
  <li><a href="#smoke-test-the-application" class="nomunge">Smoke test the application</a></li>
  <li><a href="#create-a-dockerfile-for-the-application" class="nomunge">Create a Dockerfile for the application</a></li>
  <li><a href="#build-the-image" class="nomunge">Build the image</a></li>
  <li><a href="#view-local-images" class="nomunge">View local images</a></li>
  <li><a href="#tag-images" class="nomunge">Tag images</a></li>
  <li><a href="#multi-stage-builds" class="nomunge">Multi-stage builds</a></li>
  <li><a href="#next-steps" class="nomunge">Next steps</a></li>
  <li><a href="#feedback" class="nomunge">Feedback</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">なぜ Docker なのか？</a></b></li>
                        <li><a href="https://www.docker.com/what-container">コンテナーって何？</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">製品</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker 製品ロードマップ</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">開発ツール</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">利用例</a></li>
                        <li><a href="https://www.docker.com/docker-community">コミュニティ</a></li>
                        <li><a href="https://www.docker.com/open-source">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker キャプテン</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Docker 認定公開者向けプログラム</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社</a></b></li>
                        <li><a href="https://www.docker.com/company">概要</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/customers">顧客</a></li>
                        <li><a href="https://www.docker.com/partners">パートナー</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact">連絡先</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal">法的情報</a></li>
                        <li><a href="https://www.docker.com/company/contact">連絡</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/language/golang/build-images/";</script></body>
</html>
