<!-- Page generated 2021-07-21 08:26:35 +0900-->
<!DOCTYPE html>
<html lang="ja"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ログとトラブルシューティング | Docker ドキュメント</title>
  <meta name="description" content="Troubleshooting, logs, and known issues" />
  <meta name="keywords" content="windows, troubleshooting, logs, issues">
  <link rel="canonical" href="https://localhost:4000{{ site.baseurl }}/docker-for-windows/troubleshoot/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"><script defer src="/docs.docker.jp.onthefly/js/theme-switcher.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/jquery.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
  <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script><script defer src="/docs.docker.jp.onthefly/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/docs.docker.jp.onthefly/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="ログとトラブルシューティング"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="matsuand.github.io"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker ドキュメント"/>
  <meta property="og:title" content="ログとトラブルシューティング" />
  <meta property="og:description" content="Troubleshooting, logs, and known issues" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-07-21T08:26:35+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-windows/troubleshoot/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-07-21T08:26:35+09:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"ログとトラブルシューティング","description":"Troubleshooting, logs, and known issues","url":"https://docs.docker.com/docker-for-windows/troubleshoot/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/">
                <img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/docs.docker.jp.onthefly/">
        <img src="/docs.docker.jp.onthefly/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/docs.docker.jp.onthefly/search/" method="get">
        <label for="st-search-input" class="sr-only">検索</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div id="tabs">
        <ul class="tabs jsTOCHorizontal"><li><a href="/docs.docker.jp.onthefly/" id="home">ホーム</a></li><li><a href="/docs.docker.jp.onthefly/get-started/overview/" id="guides">ガイド</a></li><li><a href="/docs.docker.jp.onthefly/desktop/" id="manuals">製品マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/reference/" id="reference">リファレンス</a></li><li><a href="/docs.docker.jp.onthefly/samples/" id="samples">サンプル</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="現在ページのメニュートグル"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/docs.docker.jp.onthefly/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/docs.docker.jp.onthefly/desktop/">製品マニュアル</a></li><li><a href="/docs.docker.jp.onthefly/desktop/">Docker Desktop</a></li><li><a href="/docs.docker.jp.onthefly/docker-for-windows/install/">Windows</a></li><li><a href="/docs.docker.jp.onthefly/docker-for-windows/troubleshoot/">ログとトラブルシューティング</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>ログとトラブルシューティング</h1><p><em class="reading-time">読む時間の目安: 11 分</em></p><div class="docker-upgrade-cta" role="alert">
  <div class="docker-upgrade-cta__heading"></div>
  <p>Docker Desktop では、プロプランやチームプランを購入している開発者に向けてのサポートを提供しているのをご存知ですか？ Docker サポートを得るには既存プランを更新してください。詳しくは <a href="#support">こちら</a> を参照のこと。</p>
 <a class="btn btn-primary" role="button" href="https://www.docker.com/pricing?utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=docs_driven_upgrade_desktop_support" target="_blank"> プランをアップデート </a>
</div>

<p>本ページでは Docker Desktop において問題が発生した際の分析方法や解決方法について示します。
Docker Desktop サポートへの要求を行ったり（プロプランやチームプランのユーザーのみ）、Docker Desktop チームへログ送付してやりとりを行ったり、フォーラムや Success Center を活用したりしてください。
GitHub 上での issue の確認や情報収集を行って、既知の問題であればその回避策を探してください。</p>

<h2 id="troubleshoot">トラブルシューティング</h2>

<p>メニューバーにある <img src="/docs.docker.jp.onthefly/docker-for-windows/images/whale-x.png" alt="クジラメニュー" class="inline" /> &gt; <strong>Troubleshoot</strong> からトラブルシューティングのオプションを確認してください。</p>

<p><img src="/docs.docker.jp.onthefly/docker-for-windows/images/troubleshoot.png" alt="Docker Desktop のトラブルシューティング" width="600px" /></p>

<p>トラブルシューティングページには以下のオプションがあります。</p>

<ul>
  <li>
    <p><strong>Restart Docker Desktop</strong>（Docker Desktop の再起動）: Docker Desktop を再起動する場合に実行します。</p>
  </li>
  <li>
    <p><strong>Support</strong>（サポート）: プロプランおよびチームプランの開発者は、このオプションを利用してサポートリクエストを送信することができます。
それ以外のユーザーはこのオプションによって Docker Desktop の issue 診断を行うことができます。
詳しくは <a href="#diagnose-and-feedback">診断とフィードバック</a> あるいは <a href="#support">サポート</a> を参照してください。</p>
  </li>
  <li>
    <p><strong>Reset Kubernetes cluster</strong>（Kubernetes クラスターのリセット）: このオプションを選択すると、全スタックや Kubernetes リソースを削除します。
詳しくは <a href="/docs.docker.jp.onthefly/docker-for-windows/#kubernetes">Kubernetes</a> を参照してください。</p>
  </li>
  <li>
    <p><strong>Clean / Purge data</strong>（）: コンテナーとイメージデータを削除するときにこのオプションを実行します。
削除するデータが Hyper-V、WSL 2、Windows コンテナーのものかどうかを選び、<strong>Delete</strong> をクリックして確認します。</p>
  </li>
  <li>
    <p><strong>Reset to factory defaults</strong>（インストール時のデフォルトにリセット）: Docker Desktop におけるオプションをすべて初期状態にリセットするときに、このオプションを実行します。
これにより Docker Desktop はインストール直後の状態と同じになります。</p>
  </li>
</ul>

<h2 id="diagnose-and-feedback">診断、フィードバック送信</h2>

<h3 id="アプリ内の診断">アプリ内の診断</h3>

<p>何か問題が発生したとして、その解決方法が本書ではわからなかったとします。
<a href="https://github.com/docker/for-win/issues">GitHub 上の Docker Desktop for Windows に対する issues</a> や <a href="https://forums.docker.com/c/docker-for-windows">Docker Desktop for Windows フォーラム</a> を見ても解決できなかったら、ログデータの解析をお手伝いします。
issue を報告する際には、本ページに示す情報をよく読んで、よく知られている問題に関して確認の上、報告することをお願いします。</p>

<ol>
  <li>メニューから <img src="/docs.docker.jp.onthefly/docker-for-windows/images/whale-x.png" alt="クジラメニュー" class="inline" /> &gt; <strong>Troubleshoot</strong> を実行します。</li>
  <li>Docker Desktop にサインインします。
さらに <a href="https://hub.docker.com/" target="_blank" rel="noopener" class="_">Docker アカウント</a> にもサインインしていることを確認してください。</li>
  <li><strong>Get Support</strong> をクリックします。
ここからアプリ内の <strong>Support</strong>（サポート）ページが開いて、診断情報の収集が始まります。
 <img src="/docs.docker.jp.onthefly/docker-for-windows/images/diagnose-support.png" alt="診断とサポート" width="600px" /></li>
  <li>診断情報の収集処理が終了したら <strong>Upload to get a Diagnostic ID</strong>（アップロードと診断 ID の取得）をクリックします。</li>
  <li>診断情報がアップロードされると Docker Desktop は診断 ID（Diagnostic ID）を出力するので、これをコピーします。</li>
  <li>プロプランまたはチームプランを購入している場合は <strong>Contact support</strong>（サポートへの問い合わせ）をクリックします。
ここから <a href="https://hub.docker.com/support/desktop/" target="_blank" rel="noopener" class="_">Docker Desktop サポート</a> 画面が開きます。
必要な情報を入力し、上でコピーした ID を診断 ID 欄に入力します。
そして <strong>Submit</strong> をクリックして Docker Desktop サポートへ送信します。
    <blockquote>
      <p><strong>メモ</strong></p>

      <p>サポート画面にアクセスするためには、プロプランやチームプランの資格情報を利用して Docker Desktop にサインインしておく必要があります。Docker Desktop サポートに関する情報は <a href="#support">サポート</a> を参照してください。</p>
    </blockquote>
  </li>
  <li>プロプランやチームプランを購入していない場合は、<strong>Upgrade to benefit from Docker Support</strong>（アップグレードと Docker サポート取得）をクリックして既存のアカウントをアップグレードしてください。
 こうすることとは別に <strong>Report a Bug</strong>（バグ報告）をクリックして GitHub 上に Docker Desktop の issue を開くこともできます。
 この場合には、ウェブブラウザー上に GitHub の Docker Desktop <a href="https://github.com/docker/for-win/issues/">for Windows</a> に関する新たな issue のテンプレートが開きます。
 必要な情報を書き入れた上で、上でコピーした診断 ID も忘れずに記入してください。
 <strong>submit new issue</strong> をクリックして新たな issue を登録します。</li>
</ol>

<h3 id="diagnosing-from-the-terminal">ターミナルからの診断操作</h3>

<p>診断処理は、自分で実行した方がよい場合があります。
たとえば Docker Desktop for Windows が起動できないときなどです。</p>

<p>まず<code class="language-plaintext highlighter-rouge">com.docker.diagnose</code>を探し出します。
おそらく<code class="language-plaintext highlighter-rouge">C:\Program Files\Docker\Docker\resources\com.docker.diagnose.exe</code>にあるはずです。</p>

<p>PowerShell において、以下のように診断情報の生成と <strong>アップロード</strong> を行います。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="nf">PS</span><span class="w"> </span><span class="nx">C:\</span><span class="err">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">"C:\Program Files\Docker\Docker\resources\com.docker.diagnose.exe"</span><span class="w"> </span><span class="nx">gather</span><span class="w"> </span><span class="nt">-upload</span><span class="w">
</span></code></pre></div></div>

<p>診断処理が終了すると、以下のような出力が得られます。
そこに診断 ID（Diagnostics ID）が示されます。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Diagnostics Bundle: C:<span class="se">\U</span>sers<span class="se">\U</span>ser<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\T</span>emp<span class="se">\C</span>D6CF862-9CBD-4007-9C2F-5FBE0572BBC2<span class="se">\2</span>0180720152545.zip
Diagnostics ID:     CD6CF862-9CBD-4007-9C2F-5FBE0572BBC2/20180720152545 <span class="o">(</span>uploaded<span class="o">)</span>
</code></pre></div></div>

<h2 id="troubleshooting-topics">トラブルシューティングのトピック</h2>

<h3 id="make-sure-certificates-are-set-up-correctly">証明書の適切な設定確認</h3>

<p>Docker Desktop では安全でないレジストリの証明書は無視します。
そういったレジストリに対しては、クライアント証明書を送信しません。
そのような場合、<code class="language-plaintext highlighter-rouge">docker run</code>のようなコマンドを使ってレジストリからプルを行おうとしても、コマンドライン上には以下のようなエラーメッセージが表示されます。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error response from daemon: Get http://192.168.203.139:5858/v2/: malformed HTTP response "\x15\x03\x01\x00\x02\x02"
</code></pre></div></div>

<p>レジストリ側においても同じようにエラーになっています。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017/06/20 18:15:30 http: TLS handshake error from 192.168.203.139:52882: tls: client didn't provide a certificate
2017/06/20 18:15:30 http: TLS handshake error from 192.168.203.139:52883: tls: first record does not look like a TLS handshake
</code></pre></div></div>

<p>クライアントやサーバーそれぞれの証明書の利用に関しては、導入ガイドのトピック、<a href="/docs.docker.jp.onthefly/docker-for-windows/#how-do-i-add-custom-ca-certificates">どうやって独自の CA 証明書を追加するか</a> や <a href="/docs.docker.jp.onthefly/docker-for-windows/#how-do-i-add-client-certificates">どうやってクライアント証明書を追加するか</a> を参照してください。</p>

<h3 id="volumes">ボリューム</h3>

<h4 id="permissions-errors-on-data-directories-for-shared-volumes">共有ボリューム上のデータディレクトリに対するパーミッションエラー</h4>

<p>Windows からファイル共有を行う際、Docker Desktop は <a href="/docs.docker.jp.onthefly/docker-for-windows/#file-sharing">共有ボリューム</a> に対して、デフォルトとして <a href="http://permissions-calculator.org/decode/0777/">0777</a>（<code class="language-plaintext highlighter-rouge">user</code>と<code class="language-plaintext highlighter-rouge">group</code>に対して<code class="language-plaintext highlighter-rouge">read</code>、<code class="language-plaintext highlighter-rouge">write</code>、<code class="language-plaintext highlighter-rouge">execute</code>）のパーミッションを設定します。</p>

<p>共有ボリュームにおけるこのデフォルトのパーミッションは、設定変更することができません。
共有ボリュームのデフォルト設定とは異なるパーミッションを必要とするアプリケーションを稼動させている場合は、ホストにマウントされていないボリュームを利用するか、デフォルトのパーミッションでも動作するようにアプリケーションの変更を行うしかありません。</p>

<p>FAQ にある <a href="/docs.docker.jp.onthefly/desktop/faqs/#can-i-change-permissions-on-shared-volumes-for-container-specific-deployment-requirements">コンテナー固有のデプロイ要件に従って共有ボリュームのパーミッションは変更できますか？</a> も参考にしてください。</p>

<h4 id="volume-mounting-requires-shared-folders-for-linux-containers">ボリュームマウントには Linux コンテナーに対する共有フォルダーが必要</h4>

<p>ボリュームのマウントを利用しているときに、実行時エラーが発生したとします。
たとえば <a href="/docs.docker.jp.onthefly/compose/gettingstarted/">Docker Compose</a> 利用時において、アプリケーションがファイルを見つけられない、ボリュームマウントに対してのアクセスが拒否される、サービスが起動しない、といったものです。
この場合は <a href="/docs.docker.jp.onthefly/docker-for-windows/#file-sharing">共有フォルダー</a> を有効にすることが必要かもしれません。</p>

<p>Hyper-V バックエンドを利用して Windows からファイルをマウントする場合には、Linux コンテナーに対しての共有フォルダーが必要になります。
<img src="/docs.docker.jp.onthefly/docker-for-windows/images/whale-x.png" alt="クジラメニュー" class="inline" /> をクリックして <strong>Settings</strong> &gt; <strong>Shared Folders</strong> を実行し、Dockerfile やボリュームを含むフォルダーを共有してください。</p>

<h4 id="support-for-symlinks">シンボリックリンクのサポート</h4>

<p>コンテナー内やコンテナー間ではシンボリックリンクが活用できます。
詳しくは FAQ 内にある <a href="/docs.docker.jp.onthefly/desktop/faqs/#how-do-symlinks-work-on-windows">Windows においてシンボリックリンクはどうやって動作するのか？</a> を参照してください。</p>

<h4 id="avoid-unexpected-syntax-errors-use-unix-style-line-endings-for-files-in-containers">予期しない文法エラー回避のためコンテナー向けファイルの改行文字を Unix 風に</h4>

<p>コンテナー内での動作に利用するファイルは、改行文字を Unix スタイルの <code class="language-plaintext highlighter-rouge">\n</code> にする必要があります。
これを行うべきファイルとして、ビルド時にコマンドラインから参照されるファイルや、Dockerfile 内の RUN コマンドにおいて参照されるファイルなどがあります。</p>

<p>Docker コンテナーや<code class="language-plaintext highlighter-rouge">docker build</code>コマンドは Unix 環境において動作しています。
したがってコンテナー内のファイルは Unix 風に行末を<code class="language-plaintext highlighter-rouge">\n</code>にする必要があります。
Windows スタイルの<code class="language-plaintext highlighter-rouge">\r\n</code>としてはなりません。
ファイルを生成する際には十分に注意しておくことが必要です。
シェルスクリプトなどを生成するにあたって Windows ツールを使っていると、デフォルトで行末が Windows スタイルになってしまうことがあります。
そのようにして記述されたコマンドは、Unix ベースのコンテナー内において、最終的には Unix コマンドに受け渡されます。
（たとえばシェルスクリプトが<code class="language-plaintext highlighter-rouge">/bin/sh</code>に受け渡されます。）
その際に Windows スタイルの改行文字を利用していると、<code class="language-plaintext highlighter-rouge">docker run</code>では文法エラーが発生します。</p>

<p>この問題の利用例とその解決については、GitHub issue にある <a href="https://github.com/moby/moby/issues/24388">Docker RUN fails to execute shell script</a> を参照してください。</p>

<h3 id="virtualization">仮想化機能</h3>

<p>Docker Desktop を正しく機能させるためには、マシンには以下の機能がなければなりません。</p>

<h4 id="wsl-2-と-windows-home">WSL 2 と Windows Home</h4>

<ol>
  <li>仮想マシンプラットフォーム。</li>
  <li><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" target="_blank" rel="noopener" class="_">Windows Subsystem for Linux</a>。</li>
  <li>BIOS 内での仮想技術有効化。</li>
  <li>Windows 起動時のハイパーバイザー有効化。</li>
</ol>

<p><img src="/docs.docker.jp.onthefly/docker-for-windows/images/wsl2-enabled.png" alt="WSL 2 enabled" width="600px" /></p>

<h4 id="hyper-v">Hyper-V</h4>

<p>Windows 10 Pro または Enterprise の場合は、以下の機能を有効にした上で Hyper-V を利用することもできます。</p>

<ol>
  <li><a href="https://docs.microsoft.com/en-us/windows-server/virtualization/hyper-v/hyper-v-technology-overview" target="_blank" rel="noopener" class="_">Hyper-V</a> がインストールされ動作していること。</li>
  <li>BIOS 設定において仮想化機能（virtualization）が有効に設定されていること。</li>
  <li>Windows 起動時にハイパーバイザーが有効であること。</li>
</ol>

<p><img src="/docs.docker.jp.onthefly/docker-for-windows/images/hyperv-enabled.png" alt="Windows の Hyper-V 機能" width="600px" /></p>

<p>Docker Desktop では Hyper-V が必要です。
また Windows Powershell における Hyper-V モジュールがインストールされ有効であることも必要です。
Docker Desktop のインストーラーの操作時に、これらが有効になります。</p>

<p>Docker Desktop ではさらに、Hyper-V を利用するため、2 つの CPU ハードウェア機能も必要です。
仮想化機能（virtualization）と第 2 レベルアドレス変換機能（Second Level Address Translation; SLAT）です。
後者は RVI（Rapid Virtualization Indexing）とも呼ばれます。
システムによっては、仮想化機能は BIOS から設定しなければならないものがあります。
その設定手順はベンダー固有のものになります。
ただし通常、BIOS の設定オプションは<code class="language-plaintext highlighter-rouge">仮想化技術</code>（Virtualization Technology; VTx）やこれに似た用語で示されています。
<code class="language-plaintext highlighter-rouge">systeminfo</code>コマンドを実行して、必要となる Hyper-V 機能を確認してください。
詳しくは <a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/reference/hyper-v-requirements">Pre-requisites for Hyper-V on Windows 10</a>（Windows 10 における Hyper-V の前提条件）を参照してください。</p>

<p>Hyper-V を手動でインストールする場合は <a href="https://msdn.microsoft.com/en-us/virtualization/hyperv_on_windows/quick_start/walkthrough_install">Install Hyper-V on Windows 10</a>（Windows 10 における Hyper-V のインストール）を参照してください。
インストール後には再起動が <strong>必要です</strong>。
Hyper-V のインストール後に再起動を行わないままでいると、Docker Desktop は正常に動作しません。</p>

<p>スタートメニューから <strong>Turn Windows features on or off</strong> と入力して ENTER キーを押してください。
表示される画面から Hyper-V が有効であることを確認してください。</p>

<h4 id="virtualization-must-be-enabled">仮想化技術の有効化</h4>

<p><a href="#hyper-v">Hyper-V</a> や <a href="/docs.docker.jp.onthefly/docker-for-windows/wsl/">WSL 2</a> とともに、仮想化技術も有効でなければなりません。
タスクマネージャーのパフォーマンスタブを確認してください。</p>

<p><img src="/docs.docker.jp.onthefly/docker-for-windows/images/virtualization-enabled.png" alt="タスクマネージャー" width="700px" /></p>

<p>Hyper-V や WSL 2 を手動でアンインストールしたり、仮想化機能を無効にしていたりすると、Docker Desktop は起動しません。
<a href="https://github.com/docker/for-win/issues/74">Unable to run Docker for Windows on Windows 10 Enterprise</a>（Windows 10 エンタープライズにおいて Docker for Windows が起動しない）を参照してください。</p>

<h4 id="hypervisor-enabled-at-windows-startup">Windows 起動時のハイパーバイザーの有効化</h4>

<p>ここまで説明している手順に従っているにも関わらず、Docker Desktop の起動に問題がある場合は、ハイパーバイザーがインストールされているものの、Windows 起動時にそれが起動されていないのかもしれません。
所定のツール（Virtual Box の旧バージョンなど）やビデオゲームのインストーラーの中には、ハイパーバイザーを起動時に無効化してしまうものがあります。
もう一度有効化するためには以下を行います。</p>

<ol>
  <li>管理コンソールプロンプトを開きます。</li>
  <li><code class="language-plaintext highlighter-rouge">bcdedit /set hypervisorlaunchtype auto</code>を実行します。</li>
  <li>Windows を再起動します。</li>
</ol>

<p>コードフローガード（Code flow guard; CFG）の設定に関しては <a href="https://social.technet.microsoft.com/Forums/en-US/ee5b1d6b-09e2-49f3-a52c-820aafc316f9/hyperv-doesnt-work-after-upgrade-to-windows-10-1809?forum=win10itprovirt" target="_blank" rel="noopener" class="_">Microsoft TechNet article</a> も参照してください。</p>

<h3 id="windows-containers-and-windows-server">Windows コンテナーと Windows Server</h3>

<p>Docker Desktop は Windows Server をサポートしていません。
Windows 10 上における Windows コンテナーの起動方法がわからない場合は、<a href="/docs.docker.jp.onthefly/docker-for-windows/#switch-between-windows-and-linux-containers">Windows と Linux の各コンテナー間の切り替え</a> を参照してください。</p>

<p><a href="https://github.com/docker/labs">docker/labs</a> にある <a href="https://github.com/docker/labs/blob/master/windows/windows-containers/README.md">Getting Started with Windows Containers</a>（Windows コンテナーをはじめよう）では、充実したチュートリアルが示されています。</p>

<p>Windows のネイティブなバイナリをインストールすることもできます。
これを使うと Docker Desktop を用いずに、Windows コンテナーの開発と起動が可能になります。
ただしこれを使って Docker をインストールした場合、Linux コンテナーの開発と起動ができなくなります。
Windows にネイティブな Docker デーモン上において Linux コンテナーを起動すると、以下のようなエラーが発生します。</p>

<pre><code class="language-none">C:\Program Files\Docker\docker.exe:
 image operating system "linux" cannot be used on this platform.
 See 'C:\Program Files\Docker\docker.exe run --help'.
</code></pre>

<h3 id="running-docker-desktop-in-nested-virtualization-scenarios">ネストした仮想環境での Docker Desktop 実行</h3>

<p>Docker Desktop は VM 環境内でも動作します。
たとえば Mac 上の Parallels や VMware Fusion といったアプリ内に、Windows 10 の VM 環境を構築して、適切な設定を行えばそこで Docker Desktop を動作させることができます。
ただしそういったアプリによるハードウェア仮想化の方式が原因で、支障が出たり断続的な障害が引き起こされる場合があります。
こういった理由から、<strong>Docker Desktop ではネスト化された仮想環境をサポートしません</strong>。
動く場合もあれば動かない場合もあるという状況です。</p>

<p>最適な答えは、ネイティブな Docker Desktop を動作させることです。
Docker Desktop on Windows であれば Windows コンテナーと Linux コンテナーを利用できます。
あるい Docker Desktop on Mac であれば Linux コンテナーを利用できます。</p>

<h4 id="if-you-still-want-to-use-nested-virtualization">それでもネスト化仮想環境を利用したい場合</h4>

<ul>
  <li>
    <p>Make sure nested virtualization support is enabled in VMWare or Parallels.
Check the settings in <strong>Hardware &gt; CPU &amp; Memory &gt; Advanced Options &gt; Enable
nested virtualization</strong> (the exact menu sequence might vary slightly).</p>
  </li>
  <li>
    <p>Configure your VM with at least 2 CPUs and sufficient memory to run your
workloads.</p>
  </li>
  <li>
    <p>システムに多少でも余裕があることを確認します。</p>
  </li>
  <li>
    <p>Windows OS が最新であることを確認します。
インサイダービルド（Insider Build）では問題が発生する場合があります。</p>
  </li>
  <li>
    <p>利用するプロセッサーも重要かもしれません。
たとえば Westmere ベースの Mac Pro には Nehalem ベースの Mac Pro に比べて、ハードウェア仮想機能が追加されています。
したがって、より最新に近い世代のインテルプロセッサーを利用してください。</p>
  </li>
</ul>

<h4 id="typical-failures-we-see-with-nested-virtualization">Typical failures we see with nested virtualization</h4>

<ul>
  <li>
    <p>Slow boot time of the Linux VM. If you look in the logs and find some entries
prefixed with <code class="language-plaintext highlighter-rouge">Moby</code>. On real hardware, it takes 5-10 seconds to boot the
Linux VM; roughly the time between the <code class="language-plaintext highlighter-rouge">Connected</code> log entry and the <code class="language-plaintext highlighter-rouge">*
Starting Docker ... [ ok ]</code> log entry. If you boot the Linux VM inside a
Windows VM, this may take considerably longer. We have a timeout of 60s or so.
If the VM hasn’t started by that time, we retry. If the retry fails we print
an error. You can sometimes work around this by providing more resources to
the Windows VM.</p>
  </li>
  <li>
    <p>Sometimes the VM fails to boot when Linux tries to calibrate the time stamp
counter (TSC). This process is quite timing sensitive and may fail when
executed inside a VM which itself runs inside a VM. CPU utilization is also
likely to be higher.</p>
  </li>
  <li>
    <p>Ensure “PMU Virtualization” is turned off in Parallels on Macs. Check the
settings in <strong>Hardware &gt; CPU &amp; Memory &gt; Advanced Settings &gt; PMU
Virtualization</strong>.</p>
  </li>
</ul>

<h3 id="networking-issues">ネットワークの問題</h3>

<p>Docker Desktop では IPv6 は（まだ）サポートされていません。</p>

<h2 id="workarounds">回避策</h2>

<h3 id="reboot">再起動</h3>

<p>Restart your PC to stop / discard any vestige of the daemon running from the
previously installed version.</p>

<h3 id="変数docker_hostの設定解除">変数<code class="language-plaintext highlighter-rouge">DOCKER_HOST</code>の設定解除</h3>

<p>The <code class="language-plaintext highlighter-rouge">DOCKER_HOST</code> environmental variable does not need to be set.  If you use
bash, use the command <code class="language-plaintext highlighter-rouge">unset ${!DOCKER_*}</code> to unset it.  For other shells,
consult the shell’s documentation.</p>

<h3 id="make-sure-docker-is-running-for-webserver-examples">Make sure Docker is running for webserver examples</h3>

<p>For the <code class="language-plaintext highlighter-rouge">hello-world-nginx</code> example and others, Docker Desktop must be
running to get to the webserver on <code class="language-plaintext highlighter-rouge">http://localhost/</code>. Make sure that the
Docker whale is showing in the menu bar, and that you run the Docker commands in
a shell that is connected to the Docker Desktop Engine. Otherwise, you might start the webserver container but get a “web page
not available” error when you go to <code class="language-plaintext highlighter-rouge">docker</code>.</p>

<h3 id="how-to-solve-port-already-allocated-errors">How to solve <code class="language-plaintext highlighter-rouge">port already allocated</code> errors</h3>

<p>If you see errors like <code class="language-plaintext highlighter-rouge">Bind for 0.0.0.0:8080 failed: port is already allocated</code>
or <code class="language-plaintext highlighter-rouge">listen tcp:0.0.0.0:8080: bind: address is already in use</code> ...</p>

<p>These errors are often caused by some other software on Windows using those
ports. To discover the identity of this software, either use the <code class="language-plaintext highlighter-rouge">resmon.exe</code>
GUI and click “Network” and then “Listening Ports” or in a Powershell use
<code class="language-plaintext highlighter-rouge">netstat -aon | find /i "listening "</code> to discover the PID of the process
currently using the port (the PID is the number in the rightmost column). Decide
whether to shut the other process down, or to use a different port in your
docker app.</p>

<h3 id="docker-desktop-fails-to-start-when-anti-virus-software-is-installed">アンチウィルスソフトのインストール時における Docker Desktop 起動の失敗</h3>

<p>Some anti-virus software may be incompatible with Hyper-V and Microsoft
Windows 10 builds. The conflict
typically occurs after a Windows update and
manifests as an error response from the Docker daemon and a Docker Desktop start failure.</p>

<p>For a temporary workaround, uninstall the anti-virus software, or
explore other workarounds suggested on Docker Desktop forums.</p>

<h2 id="support">サポート</h2>

<p>This section contains instructions on how to get support, and covers the scope of Docker Desktop support.</p>

<div class="docker-upgrade-cta" role="alert">
  <div class="docker-upgrade-cta__heading">
この機能を利用するには Pro プランまたは Team プランが必要です。
  </div>
  <p>Docker Desktop offers support for developers subscribed to a Pro or a Team plan. Upgrade your existing plan to benefit from Docker Support.</p>
 <a class="btn btn-primary" role="button" href="https://www.docker.com/pricing?utm_source=docker&amp;utm_medium=webreferral&amp;utm_campaign=docs_driven_upgrade_desktop_support" target="_blank"> プランをアップデート </a>
</div>

<h3 id="how-do-i-get-docker-desktop-support">How do I get Docker Desktop support?</h3>

<p>If you have subscribed to a Pro and Team account, please raise a ticket through <a href="https://hub.docker.com/support/desktop/" target="_blank" rel="noopener" class="_">Docker Desktop support</a>.</p>

<p>Docker Community users can get support through our Github repos for-win and for-mac, where we respond on a best-effort basis.</p>

<h3 id="what-support-can-i-get">What support can I get?</h3>

<p>If you are a Pro or a Team user, you can request for support on the following types of issues:</p>

<ul>
  <li>Desktop upgrade issues</li>
  <li>Desktop installation issues
    <ul>
      <li>Enabling virtualization in BIOS</li>
      <li>Enabling Windows features</li>
      <li>Installation crashes</li>
      <li>Failure to launch Docker Desktop on first run</li>
    </ul>
  </li>
  <li>Usage issues
    <ul>
      <li>Crash closing software</li>
      <li>Docker Desktop not behaving as expected</li>
    </ul>
  </li>
  <li>Configuration issues</li>
  <li>Basic product ‘how to’ questions such as ‘how to work efficiently on WSL 2’</li>
</ul>

<h3 id="what-is-not-supported">What is not supported?</h3>

<p>Docker Desktop excludes support for the following types of issues:</p>

<ul>
  <li>Use on or in conjunction with hardware or software other than that specified in the applicable documentation</li>
  <li>Running on unsupported operating systems, including beta/preview versions of operating systems</li>
  <li>Running containers of a different architecture using emulation</li>
  <li>Support for the Docker engine, Docker CLI, or other bundled Linux components</li>
  <li>Support for Kubernetes</li>
  <li>Features labeled as experimental</li>
  <li>System/Server administration activities</li>
  <li>Supporting Desktop as a production runtime</li>
  <li>Scale deployment/multi-machine installation of Desktop</li>
  <li>Routine product maintenance (data backup, cleaning disk space and configuring log rotation)</li>
  <li>Third-party applications not provided by Docker</li>
  <li>Altered or modified Docker software</li>
  <li>Defects in the Docker software due to hardware malfunction, abuse, or improper use</li>
  <li>Any version of the Docker software other than the latest version</li>
  <li>Reimbursing and expenses spent for third-party services not provided by Docker</li>
  <li>Docker Support excludes training, customization, and integration</li>
</ul>

<h3 id="what-versions-are-supported">What versions are supported?</h3>

<p>We currently only offer support for the latest version of Docker Desktop. If you are running an older version, you may be asked to upgrade before we investigate your support request.</p>

<h3 id="how-many-machines-can-i-get-support-for-docker-desktop-on">How many machines can I get support for Docker Desktop on?</h3>

<p>As a Pro user you can get support for Docker Desktop on a single machine.
As a Team, you can get support for Docker Desktop for the number of machines equal to the number of seats as part of your plan.</p>

<h3 id="what-oss-are-supported">What OS’s are supported?</h3>

<p>Docker Desktop is available for Mac and Windows. The supported version information can be found on the following pages:</p>

<ul>
  <li><a href="/docs.docker.jp.onthefly/docker-for-windows/install/#system-requirements">Windows system requirements</a></li>
  <li><a href="/docs.docker.jp.onthefly/docker-for-mac/install/#system-requirements">Mac system requirements</a></li>
</ul>

<h3 id="can-i-run-docker-desktop-on-virtualized-hardware">Can I run Docker Desktop on Virtualized hardware?</h3>

<p>No, currently this is unsupported and against the terms of use.</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/docs.docker.jp.onthefly/search/?q=windows">windows</a>, <a href="/docs.docker.jp.onthefly/search/?q=troubleshooting">troubleshooting</a>, <a href="/docs.docker.jp.onthefly/search/?q=logs">logs</a>, <a href="/docs.docker.jp.onthefly/search/?q=issues">issues</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav jsTOCHorizontal hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/edit/master/src/docker-for-windows/troubleshoot.ch"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 本ページの編集</a></li><li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [docker-for-windows/troubleshoot.ch](https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-windows/troubleshoot/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 変更リクエスト</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">本ページ内:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#troubleshoot" class="nomunge">トラブルシューティング</a></li>
  <li><a href="#diagnose-and-feedback" class="nomunge">診断、フィードバック送信</a></li>
  <li><a href="#troubleshooting-topics" class="nomunge">トラブルシューティングのトピック</a></li>
  <li><a href="#workarounds" class="nomunge">回避策</a></li>
  <li><a href="#support" class="nomunge">サポート</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">なぜ Docker なのか？</a></b></li>
                        <li><a href="https://www.docker.com/what-container">コンテナーって何？</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">製品</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker 製品ロードマップ</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">機能</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">コンテナーランタイム</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">開発ツール</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">開発者</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">利用例</a></li>
                        <li><a href="https://www.docker.com/docker-community">コミュニティ</a></li>
                        <li><a href="https://www.docker.com/open-source">オープンソース</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker キャプテン</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">価格体系</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Verified Publisher Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">会社</a></b></li>
                        <li><a href="https://www.docker.com/company">概要</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">ブログ</a></li>
                        <li><a href="https://www.docker.com/customers">顧客</a></li>
                        <li><a href="https://www.docker.com/partners">パートナー</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">ニュースルーム</a></li>
                        <li><a href="https://www.docker.com/careers">採用情報</a></li>
                        <li><a href="https://www.docker.com/company/contact">連絡先</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">ステータス</a></li>
                        <li><a href="https://www.docker.com/legal">法的情報</a></li>
                        <li><a href="https://www.docker.com/company/contact">連絡</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/docker-for-windows/troubleshoot/";</script></body>
</html>
